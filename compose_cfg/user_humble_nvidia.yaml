services:
  my-postgres:
    image: postgres:latest
    container_name: universe_db
    environment:
      POSTGRES_DB: academy_db 
      POSTGRES_USER: user-dev 
      POSTGRES_PASSWORD: bt-studio-dev
    ports:
      - "5432:5432"
    volumes:
      - ./RoboticsInfrastructure/database/universes.sql:/docker-entrypoint-initdb.d/1.sql
      - ./backend/django_auth.sql:/docker-entrypoint-initdb.d/2.sql
    healthcheck:
      test: pg_isready -U user-dev -d academy_db
      interval: 3s
      timeout: 1s
      retries: 20

  bt-studio:
    image: jderobot/bt-studio:latest
    container_name: developer-container
    command:  "--bt"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    ports:
      - "7164:7164"
      - "7163:7163"
      - "6080:6080"
      - "1108:1108"
    tty: true
    stdin_open: true
    depends_on: 
      my-postgres:
        condition: service_healthy
