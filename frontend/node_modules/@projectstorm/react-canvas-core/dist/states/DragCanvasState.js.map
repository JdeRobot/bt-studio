{"version":3,"file":"DragCanvasState.js","sourceRoot":"","sources":["../../src/states/DragCanvasState.ts"],"names":[],"mappings":";;;;;;;;;AACA,OAAO,EAAE,yBAAyB,EAAkC,MAAM,yCAAyC,CAAC;AAUpH,MAAM,OAAO,eAAuD,SAAQ,yBAA4B;IAMvG,YAAY,UAAkC,EAAE;QAC/C,KAAK,CAAC;YACL,IAAI,EAAE,aAAa;SACnB,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,mBACV,SAAS,EAAE,IAAI,IACZ,OAAO,CACV,CAAC;IACH,CAAC;IAEK,SAAS,CAAC,IAAI;;;;;YACnB,OAAM,SAAS,YAAC,IAAI,EAAE;YACtB,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,cAAc,EAAE,CAAC;YACxC,MAAM,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YAEtC,4EAA4E;YAC5E,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,SAAS,EAAE,EAAE;gBACrD,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;aAC1B;YAED,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,UAAU,EAAE,CAAC;YAC1D,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,UAAU,EAAE,CAAC;QAC3D,CAAC;KAAA;IAED,WAAW,CAAC,IAAW;QACtB,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACxB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,SAAS,EAAE,EAAE;YACrD,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;SACzB;IACF,CAAC;IAED,cAAc,CAAC,KAAqC;QACnD,IAAI,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE;YAC1B,IAAI,CAAC,MAAM;iBACT,QAAQ,EAAE;iBACV,SAAS,CAAC,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC,aAAa,EAAE,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC,aAAa,CAAC,CAAC;YAClG,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;SAC5B;IACF,CAAC;CACD","sourcesContent":["import { CanvasEngine } from '../CanvasEngine';\nimport { AbstractDisplacementState, AbstractDisplacementStateEvent } from '../core-state/AbstractDisplacementState';\nimport { State } from '../core-state/State';\n\nexport interface DragCanvasStateOptions {\n\t/**\n\t * If enabled, the canvas is available to drag\n\t */\n\tallowDrag?: boolean;\n}\n\nexport class DragCanvasState<E extends CanvasEngine = CanvasEngine> extends AbstractDisplacementState<E> {\n\t// store this as we drag the canvas\n\tinitialCanvasX: number;\n\tinitialCanvasY: number;\n\tconfig: DragCanvasStateOptions;\n\n\tconstructor(options: DragCanvasStateOptions = {}) {\n\t\tsuper({\n\t\t\tname: 'drag-canvas'\n\t\t});\n\t\tthis.config = {\n\t\t\tallowDrag: true,\n\t\t\t...options\n\t\t};\n\t}\n\n\tasync activated(prev) {\n\t\tsuper.activated(prev);\n\t\tthis.engine.getModel().clearSelection();\n\t\tawait this.engine.repaintCanvas(true);\n\n\t\t// we can block layer rendering because we are only targeting the transforms\n\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\tlayer.allowRepaint(false);\n\t\t}\n\n\t\tthis.initialCanvasX = this.engine.getModel().getOffsetX();\n\t\tthis.initialCanvasY = this.engine.getModel().getOffsetY();\n\t}\n\n\tdeactivated(next: State) {\n\t\tsuper.deactivated(next);\n\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\tlayer.allowRepaint(true);\n\t\t}\n\t}\n\n\tfireMouseMoved(event: AbstractDisplacementStateEvent) {\n\t\tif (this.config.allowDrag) {\n\t\t\tthis.engine\n\t\t\t\t.getModel()\n\t\t\t\t.setOffset(this.initialCanvasX + event.displacementX, this.initialCanvasY + event.displacementY);\n\t\t\tthis.engine.repaintCanvas();\n\t\t}\n\t}\n}\n"]}