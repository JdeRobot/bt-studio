{"version":3,"file":"index.umd.js","mappings":"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","sources":["webpack://projectstorm/react-canvas-core/webpack/universalModuleDefinition","webpack://projectstorm/react-canvas-core/webpack/bootstrap","webpack://projectstorm/react-canvas-core/webpack/runtime/compat get default export","webpack://projectstorm/react-canvas-core/webpack/runtime/define property getters","webpack://projectstorm/react-canvas-core/webpack/runtime/hasOwnProperty shorthand","webpack://projectstorm/react-canvas-core/webpack/runtime/make namespace object","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/debounce\"","webpack://projectstorm/react-canvas-core/./src/Toolkit.ts","webpack://projectstorm/react-canvas-core/./src/core/BaseObserver.ts","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/values\"","webpack://projectstorm/react-canvas-core/./src/core/FactoryBank.ts","webpack://projectstorm/react-canvas-core/external commonjs \"@projectstorm/geometry\"","webpack://projectstorm/react-canvas-core/./src/core-actions/Action.ts","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/filter\"","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/keys\"","webpack://projectstorm/react-canvas-core/./src/core-actions/ActionEventBus.ts","webpack://projectstorm/react-canvas-core/./src/actions/PanAndZoomCanvasAction.ts","webpack://projectstorm/react-canvas-core/./src/actions/ZoomCanvasAction.ts","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/forEach\"","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/isEqual\"","webpack://projectstorm/react-canvas-core/./src/actions/DeleteItemsAction.ts","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/last\"","webpack://projectstorm/react-canvas-core/./src/core-state/StateMachine.ts","webpack://projectstorm/react-canvas-core/./src/CanvasEngine.ts","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/flatMap\"","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/map\"","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/cloneDeep\"","webpack://projectstorm/react-canvas-core/./src/core-models/BaseEntity.ts","webpack://projectstorm/react-canvas-core/./src/entities/canvas/CanvasModel.ts","webpack://projectstorm/react-canvas-core/./src/core/AbstractFactory.ts","webpack://projectstorm/react-canvas-core/./src/core/AbstractModelFactory.ts","webpack://projectstorm/react-canvas-core/./src/core/AbstractReactFactory.tsx","webpack://projectstorm/react-canvas-core/./src/core-models/BaseModel.ts","webpack://projectstorm/react-canvas-core/./src/core-models/BasePositionModel.ts","webpack://projectstorm/react-canvas-core/external commonjs \"react\"","webpack://projectstorm/react-canvas-core/external commonjs \"@emotion/styled\"","webpack://projectstorm/react-canvas-core/external commonjs \"@emotion/react\"","webpack://projectstorm/react-canvas-core/./src/entities/layer/TransformLayerWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/canvas/CanvasWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/layer/SmartLayerWidget.tsx","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/mapValues\"","webpack://projectstorm/react-canvas-core/./src/entities/selection/SelectionBoxWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/layer/LayerModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/selection/SelectionLayerModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/selection/SelectionBoxLayerFactory.tsx","webpack://projectstorm/react-canvas-core/./src/widgets/PeformanceWidget.tsx","webpack://projectstorm/react-canvas-core/external commonjs \"lodash/intersection\"","webpack://projectstorm/react-canvas-core/./src/core-state/State.ts","webpack://projectstorm/react-canvas-core/./src/core-state/AbstractDisplacementState.ts","webpack://projectstorm/react-canvas-core/./src/states/DragCanvasState.ts","webpack://projectstorm/react-canvas-core/./src/states/SelectionBoxState.ts","webpack://projectstorm/react-canvas-core/./src/states/SelectingState.ts","webpack://projectstorm/react-canvas-core/./src/states/MoveItemsState.ts","webpack://projectstorm/react-canvas-core/./src/states/DefaultState.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"projectstorm/react-canvas-core\"] = factory();\n\telse\n\t\troot[\"projectstorm/react-canvas-core\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/debounce\");","export class Toolkit {\n\tstatic TESTING: boolean = false;\n\tstatic TESTING_UID = 0;\n\n\t/**\n\t * Generats a unique ID (thanks Stack overflow :3)\n\t * @returns {String}\n\t */\n\tpublic static UID(): string {\n\t\tif (Toolkit.TESTING) {\n\t\t\tToolkit.TESTING_UID++;\n\t\t\treturn `${Toolkit.TESTING_UID}`;\n\t\t}\n\t\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n\t\t\tconst r = (Math.random() * 16) | 0;\n\t\t\tconst v = c === 'x' ? r : (r & 0x3) | 0x8;\n\t\t\treturn v.toString(16);\n\t\t});\n\t}\n\n\tpublic static closest(element: Element, selector: string) {\n\t\tif (!Element.prototype.closest) {\n\t\t\tElement.prototype.closest = function (s) {\n\t\t\t\tvar el = this;\n\n\t\t\t\tdo {\n\t\t\t\t\tif (Element.prototype.matches.call(el, s)) return el;\n\t\t\t\t\tel = el.parentElement || el.parentNode;\n\t\t\t\t} while (el !== null && el.nodeType === 1);\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\t\treturn element.closest(selector);\n\t}\n}\n","import { Toolkit } from '../Toolkit';\n\nexport interface BaseEvent {\n\tfiring: boolean;\n\tstopPropagation: () => any;\n}\n\nexport interface BaseEventProxy extends BaseEvent {\n\tfunction: string;\n}\n\n/**\n * Listeners are always in the form of an object that contains methods that take events\n */\nexport type BaseListener = {\n\t/**\n\t * Generic event that fires before a specific event was fired\n\t */\n\teventWillFire?: (event: BaseEvent & { function: string }) => void;\n\n\t/**\n\t * Generic event that fires after a specific event was fired (even if it was consumed)\n\t */\n\teventDidFire?: (event: BaseEvent & { function: string }) => void;\n} & {\n\t/**\n\t * Type for other events that will fire\n\t */\n\t[key: string]: (event: BaseEvent) => any;\n};\n\nexport interface ListenerHandle {\n\t/**\n\t * Used to degister the listener\n\t */\n\tderegister: () => any;\n\t/**\n\t * Original ID of the listener\n\t */\n\tid: string;\n\n\t/**\n\t * Original Listener\n\t */\n\tlistener: BaseListener;\n}\n\n/**\n * Base observer pattern class for working with listeners\n */\nexport class BaseObserver<L extends BaseListener = BaseListener> {\n\tprotected listeners: { [id: string]: L };\n\n\tconstructor() {\n\t\tthis.listeners = {};\n\t}\n\n\tprivate fireEventInternal(fire: boolean, k: keyof L, event: BaseEvent) {\n\t\tthis.iterateListeners((listener) => {\n\t\t\t// returning false here will instruct itteration to stop\n\t\t\tif (!fire && !event.firing) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// fire selected listener\n\t\t\tif (listener[k]) {\n\t\t\t\tlistener[k](event as BaseEvent);\n\t\t\t}\n\t\t});\n\t}\n\n\tfireEvent<K extends keyof L>(event: Partial<Parameters<L[K]>[0]>, k: keyof L) {\n\t\tevent = {\n\t\t\tfiring: true,\n\t\t\tstopPropagation: () => {\n\t\t\t\tevent.firing = false;\n\t\t\t},\n\t\t\t...event\n\t\t};\n\n\t\t// fire pre\n\t\tthis.fireEventInternal(true, 'eventWillFire', {\n\t\t\t...event,\n\t\t\tfunction: k\n\t\t} as BaseEventProxy);\n\n\t\t// fire main event\n\t\tthis.fireEventInternal(false, k, event as BaseEvent);\n\n\t\t// fire post\n\t\tthis.fireEventInternal(true, 'eventDidFire', {\n\t\t\t...event,\n\t\t\tfunction: k\n\t\t} as BaseEventProxy);\n\t}\n\n\titerateListeners(cb: (listener: L) => any) {\n\t\tfor (let id in this.listeners) {\n\t\t\tconst res = cb(this.listeners[id]);\n\t\t\t// cancel itteration on false\n\t\t\tif (res === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetListenerHandle(listener: L): ListenerHandle {\n\t\tfor (let id in this.listeners) {\n\t\t\tif (this.listeners[id] === listener) {\n\t\t\t\treturn {\n\t\t\t\t\tid: id,\n\t\t\t\t\tlistener: listener,\n\t\t\t\t\tderegister: () => {\n\t\t\t\t\t\tdelete this.listeners[id];\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tregisterListener(listener: L): ListenerHandle {\n\t\tconst id = Toolkit.UID();\n\t\tthis.listeners[id] = listener;\n\t\treturn {\n\t\t\tid: id,\n\t\t\tlistener: listener,\n\t\t\tderegister: () => {\n\t\t\t\tdelete this.listeners[id];\n\t\t\t}\n\t\t};\n\t}\n\n\tderegisterListener(listener: L | ListenerHandle) {\n\t\tif (typeof listener === 'object') {\n\t\t\t(listener as ListenerHandle).deregister();\n\t\t\treturn true;\n\t\t}\n\t\tconst handle = this.getListenerHandle(listener);\n\t\tif (handle) {\n\t\t\thandle.deregister();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/values\");","import { BaseEvent, BaseListener, BaseObserver } from './BaseObserver';\nimport { AbstractFactory } from './AbstractFactory';\nimport _values from 'lodash/values';\n\nexport interface FactoryBankListener<F extends AbstractFactory = AbstractFactory> extends BaseListener {\n\t/**\n\t * Factory as added to rhe bank\n\t */\n\tfactoryAdded?: (event: BaseEvent & { factory: F }) => any;\n\n\t/**\n\t * Factory was removed from the bank\n\t */\n\tfactoryRemoved?: (event: BaseEvent & { factory: F }) => any;\n}\n\n/**\n * Store and managed Factories that extend from Abstractfactory\n */\nexport class FactoryBank<\n\tF extends AbstractFactory = AbstractFactory,\n\tL extends FactoryBankListener<F> = FactoryBankListener<F>\n> extends BaseObserver<L> {\n\tprotected factories: { [type: string]: F };\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.factories = {};\n\t}\n\n\tgetFactories(): F[] {\n\t\treturn _values(this.factories);\n\t}\n\n\tclearFactories() {\n\t\tfor (let factory in this.factories) {\n\t\t\tthis.deregisterFactory(factory);\n\t\t}\n\t}\n\n\tgetFactory<T extends F = F>(type: string): T {\n\t\tif (!this.factories[type]) {\n\t\t\tthrow new Error(`Cannot find factory with type [${type}]`);\n\t\t}\n\t\treturn this.factories[type] as T;\n\t}\n\n\tregisterFactory(factory: F) {\n\t\tfactory.setFactoryBank(this);\n\t\tthis.factories[factory.getType()] = factory;\n\t\t// todo fixme\n\t\tthis.fireEvent<'factoryAdded'>({ factory } as any, 'factoryAdded');\n\t}\n\n\tderegisterFactory(type: string) {\n\t\tconst factory = this.factories[type];\n\t\tfactory.setFactoryBank(null);\n\t\tdelete this.factories[type];\n\t\t// todo fixme\n\t\tthis.fireEvent<'factoryRemoved'>({ factory } as any, 'factoryRemoved');\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@projectstorm/geometry\");","import { MouseEvent, KeyboardEvent, WheelEvent, TouchEvent, SyntheticEvent } from 'react';\nimport { Toolkit } from '../Toolkit';\nimport { CanvasEngine } from '../CanvasEngine';\nimport { BaseModel } from '../core-models/BaseModel';\n\nexport enum InputType {\n\tMOUSE_DOWN = 'mouse-down',\n\tMOUSE_UP = 'mouse-up',\n\tMOUSE_MOVE = 'mouse-move',\n\tMOUSE_WHEEL = 'mouse-wheel',\n\tKEY_DOWN = 'key-down',\n\tKEY_UP = 'key-up',\n\tTOUCH_START = 'touch-start',\n\tTOUCH_END = 'touch-end',\n\tTOUCH_MOVE = 'touch-move'\n}\n\nexport interface Mapping {\n\t[InputType.MOUSE_DOWN]: MouseEvent;\n\t[InputType.MOUSE_UP]: MouseEvent;\n\t[InputType.MOUSE_MOVE]: MouseEvent;\n\t[InputType.MOUSE_WHEEL]: WheelEvent;\n\t[InputType.KEY_DOWN]: KeyboardEvent;\n\t[InputType.KEY_UP]: KeyboardEvent;\n\t[InputType.TOUCH_START]: TouchEvent;\n\t[InputType.TOUCH_END]: TouchEvent;\n\t[InputType.TOUCH_MOVE]: TouchEvent;\n}\n\nexport interface ActionEvent<Event extends SyntheticEvent = SyntheticEvent, Model extends BaseModel = BaseModel> {\n\tevent: Event;\n\tmodel?: Model;\n}\n\nexport interface ActionOptions {\n\ttype: InputType;\n\tfire: (event: ActionEvent<Mapping[this['type']]>) => void;\n}\n\nexport class Action<T extends CanvasEngine = CanvasEngine> {\n\toptions: ActionOptions;\n\tid: string;\n\tengine: T;\n\n\tconstructor(options: ActionOptions) {\n\t\tthis.options = options;\n\t\tthis.id = Toolkit.UID();\n\t}\n\n\tsetEngine(engine: T) {\n\t\tthis.engine = engine;\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/filter\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/keys\");","import { Action, ActionEvent, InputType } from './Action';\nimport { KeyboardEvent, MouseEvent } from 'react';\nimport _filter from 'lodash/filter';\nimport _keys from 'lodash/keys';\nimport { CanvasEngine } from '../CanvasEngine';\nimport { BaseModel } from '../core-models/BaseModel';\n\nexport class ActionEventBus {\n\tprotected actions: { [id: string]: Action };\n\tprotected engine: CanvasEngine;\n\tprotected keys: { [key: string]: boolean };\n\n\tconstructor(engine: CanvasEngine) {\n\t\tthis.actions = {};\n\t\tthis.engine = engine;\n\t\tthis.keys = {};\n\t}\n\n\tgetKeys(): string[] {\n\t\treturn _keys(this.keys);\n\t}\n\n\tregisterAction(action: Action): () => void {\n\t\taction.setEngine(this.engine);\n\t\tthis.actions[action.id] = action;\n\t\treturn () => {\n\t\t\tthis.deregisterAction(action);\n\t\t};\n\t}\n\n\tderegisterAction(action: Action) {\n\t\taction.setEngine(null);\n\t\tdelete this.actions[action.id];\n\t}\n\n\tgetActionsForType(type: InputType): Action[] {\n\t\treturn _filter(this.actions, (action) => {\n\t\t\treturn action.options.type === type;\n\t\t});\n\t}\n\n\tgetModelForEvent(actionEvent: ActionEvent<MouseEvent>): BaseModel {\n\t\tif (actionEvent.model) {\n\t\t\treturn actionEvent.model;\n\t\t}\n\t\treturn this.engine.getMouseElement(actionEvent.event);\n\t}\n\n\tgetActionsForEvent(actionEvent: ActionEvent): Action[] {\n\t\tconst { event } = actionEvent;\n\t\tif (event.type === 'mousedown') {\n\t\t\treturn this.getActionsForType(InputType.MOUSE_DOWN);\n\t\t} else if (event.type === 'mouseup') {\n\t\t\treturn this.getActionsForType(InputType.MOUSE_UP);\n\t\t} else if (event.type === 'keydown') {\n\t\t\t// store the recorded key\n\t\t\tthis.keys[(event as KeyboardEvent).key.toLowerCase()] = true;\n\t\t\treturn this.getActionsForType(InputType.KEY_DOWN);\n\t\t} else if (event.type === 'keyup') {\n\t\t\t// delete the recorded key\n\t\t\tdelete this.keys[(event as KeyboardEvent).key.toLowerCase()];\n\t\t\treturn this.getActionsForType(InputType.KEY_UP);\n\t\t} else if (event.type === 'mousemove') {\n\t\t\treturn this.getActionsForType(InputType.MOUSE_MOVE);\n\t\t} else if (event.type === 'wheel') {\n\t\t\treturn this.getActionsForType(InputType.MOUSE_WHEEL);\n\t\t} else if (event.type === 'touchstart') {\n\t\t\treturn this.getActionsForType(InputType.TOUCH_START);\n\t\t} else if (event.type === 'touchend') {\n\t\t\treturn this.getActionsForType(InputType.TOUCH_END);\n\t\t} else if (event.type === 'touchmove') {\n\t\t\treturn this.getActionsForType(InputType.TOUCH_MOVE);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tfireAction(actionEvent: ActionEvent) {\n\t\tconst actions = this.getActionsForEvent(actionEvent);\n\t\tfor (let action of actions) {\n\t\t\taction.options.fire(actionEvent as any);\n\t\t}\n\t}\n}\n","import { WheelEvent } from 'react';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\n\nexport interface PanAndZoomCanvasActionOptions {\n\tinverseZoom?: boolean;\n}\n\nexport class PanAndZoomCanvasAction extends Action {\n\tconstructor(options: PanAndZoomCanvasActionOptions = {}) {\n\t\tsuper({\n\t\t\ttype: InputType.MOUSE_WHEEL,\n\t\t\tfire: (actionEvent: ActionEvent<WheelEvent>) => {\n\t\t\t\tconst { event } = actionEvent;\n\t\t\t\t// we can block layer rendering because we are only targeting the transforms\n\t\t\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\t\t\tlayer.allowRepaint(false);\n\t\t\t\t}\n\n\t\t\t\tconst model = this.engine.getModel();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tif (event.ctrlKey) {\n\t\t\t\t\t// Pinch and zoom gesture\n\t\t\t\t\tconst oldZoomFactor = this.engine.getModel().getZoomLevel() / 100;\n\n\t\t\t\t\tlet scrollDelta = options.inverseZoom ? event.deltaY : -event.deltaY;\n\t\t\t\t\tscrollDelta /= 3;\n\n\t\t\t\t\tif (model.getZoomLevel() + scrollDelta > 10) {\n\t\t\t\t\t\tmodel.setZoomLevel(model.getZoomLevel() + scrollDelta);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst zoomFactor = model.getZoomLevel() / 100;\n\n\t\t\t\t\tconst boundingRect = event.currentTarget.getBoundingClientRect();\n\t\t\t\t\tconst clientWidth = boundingRect.width;\n\t\t\t\t\tconst clientHeight = boundingRect.height;\n\t\t\t\t\t// compute difference between rect before and after scroll\n\t\t\t\t\tconst widthDiff = clientWidth * zoomFactor - clientWidth * oldZoomFactor;\n\t\t\t\t\tconst heightDiff = clientHeight * zoomFactor - clientHeight * oldZoomFactor;\n\t\t\t\t\t// compute mouse coords relative to canvas\n\t\t\t\t\tconst clientX = event.clientX - boundingRect.left;\n\t\t\t\t\tconst clientY = event.clientY - boundingRect.top;\n\n\t\t\t\t\t// compute width and height increment factor\n\t\t\t\t\tconst xFactor = (clientX - model.getOffsetX()) / oldZoomFactor / clientWidth;\n\t\t\t\t\tconst yFactor = (clientY - model.getOffsetY()) / oldZoomFactor / clientHeight;\n\n\t\t\t\t\tmodel.setOffset(model.getOffsetX() - widthDiff * xFactor, model.getOffsetY() - heightDiff * yFactor);\n\t\t\t\t} else {\n\t\t\t\t\t// Pan gesture\n\t\t\t\t\tlet yDelta = options.inverseZoom ? -event.deltaY : event.deltaY;\n\t\t\t\t\tlet xDelta = options.inverseZoom ? -event.deltaX : event.deltaX;\n\t\t\t\t\tmodel.setOffset(model.getOffsetX() - xDelta, model.getOffsetY() - yDelta);\n\t\t\t\t}\n\t\t\t\tthis.engine.repaintCanvas();\n\n\t\t\t\t// re-enable rendering\n\t\t\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\t\t\tlayer.allowRepaint(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","import { WheelEvent } from 'react';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\n\nexport interface ZoomCanvasActionOptions {\n\tinverseZoom?: boolean;\n}\n\nexport class ZoomCanvasAction extends Action {\n\tconstructor(options: ZoomCanvasActionOptions = {}) {\n\t\tsuper({\n\t\t\ttype: InputType.MOUSE_WHEEL,\n\t\t\tfire: (actionEvent: ActionEvent<WheelEvent>) => {\n\t\t\t\tconst { event } = actionEvent;\n\t\t\t\t// we can block layer rendering because we are only targeting the transforms\n\t\t\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\t\t\tlayer.allowRepaint(false);\n\t\t\t\t}\n\n\t\t\t\tconst model = this.engine.getModel();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tconst oldZoomFactor = this.engine.getModel().getZoomLevel() / 100;\n\t\t\t\tlet scrollDelta = options.inverseZoom ? -event.deltaY : event.deltaY;\n\t\t\t\t//check if it is pinch gesture\n\t\t\t\tif (event.ctrlKey && scrollDelta % 1 !== 0) {\n\t\t\t\t\t/*\n\t\t\t\t\t\tChrome and Firefox sends wheel event with deltaY that\n\t\t\t\t\t\thave fractional part, also `ctrlKey` prop of the event is true\n\t\t\t\t\t\tthough ctrl isn't pressed\n\t\t\t\t\t*/\n\t\t\t\t\tscrollDelta /= 3;\n\t\t\t\t} else {\n\t\t\t\t\tscrollDelta /= 60;\n\t\t\t\t}\n\t\t\t\tif (model.getZoomLevel() + scrollDelta > 10) {\n\t\t\t\t\tmodel.setZoomLevel(model.getZoomLevel() + scrollDelta);\n\t\t\t\t}\n\n\t\t\t\tconst zoomFactor = model.getZoomLevel() / 100;\n\n\t\t\t\tconst boundingRect = event.currentTarget.getBoundingClientRect();\n\t\t\t\tconst clientWidth = boundingRect.width;\n\t\t\t\tconst clientHeight = boundingRect.height;\n\t\t\t\t// compute difference between rect before and after scroll\n\t\t\t\tconst widthDiff = clientWidth * zoomFactor - clientWidth * oldZoomFactor;\n\t\t\t\tconst heightDiff = clientHeight * zoomFactor - clientHeight * oldZoomFactor;\n\t\t\t\t// compute mouse coords relative to canvas\n\t\t\t\tconst clientX = event.clientX - boundingRect.left;\n\t\t\t\tconst clientY = event.clientY - boundingRect.top;\n\n\t\t\t\t// compute width and height increment factor\n\t\t\t\tconst xFactor = (clientX - model.getOffsetX()) / oldZoomFactor / clientWidth;\n\t\t\t\tconst yFactor = (clientY - model.getOffsetY()) / oldZoomFactor / clientHeight;\n\n\t\t\t\tmodel.setOffset(model.getOffsetX() - widthDiff * xFactor, model.getOffsetY() - heightDiff * yFactor);\n\t\t\t\tthis.engine.repaintCanvas();\n\n\t\t\t\t// re-enable rendering\n\t\t\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\t\t\tlayer.allowRepaint(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/forEach\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/isEqual\");","import { Action, ActionEvent, InputType } from '../core-actions/Action';\nimport { KeyboardEvent } from 'react';\nimport _forEach from 'lodash/forEach';\nimport _isEqual from 'lodash/isEqual';\n\nexport interface DeleteItemsActionOptions {\n\tkeyCodes?: number[];\n\tmodifiers?: {\n\t\tctrlKey?: boolean;\n\t\tshiftKey?: boolean;\n\t\taltKey?: boolean;\n\t\tmetaKey?: boolean;\n\t};\n}\n\n/**\n * Deletes all selected items\n */\nexport class DeleteItemsAction extends Action {\n\tconstructor(options: DeleteItemsActionOptions = {}) {\n\t\tconst keyCodes = options.keyCodes || [46, 8];\n\t\tconst modifiers = {\n\t\t\tctrlKey: false,\n\t\t\tshiftKey: false,\n\t\t\taltKey: false,\n\t\t\tmetaKey: false,\n\t\t\t...options.modifiers\n\t\t};\n\n\t\tsuper({\n\t\t\ttype: InputType.KEY_DOWN,\n\t\t\tfire: (event: ActionEvent<KeyboardEvent>) => {\n\t\t\t\tconst { keyCode, ctrlKey, shiftKey, altKey, metaKey } = event.event;\n\n\t\t\t\tif (keyCodes.indexOf(keyCode) !== -1 && _isEqual({ ctrlKey, shiftKey, altKey, metaKey }, modifiers)) {\n\t\t\t\t\t_forEach(this.engine.getModel().getSelectedEntities(), (model) => {\n\t\t\t\t\t\t// only delete items which are not locked\n\t\t\t\t\t\tif (!model.isLocked()) {\n\t\t\t\t\t\t\tmodel.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/last\");","import { State } from './State';\nimport _last from 'lodash/last';\nimport { CanvasEngine } from '../CanvasEngine';\nimport { BaseEvent, BaseListener, BaseObserver } from '../core/BaseObserver';\n\nexport interface StateMachineListener extends BaseListener {\n\tstateChanged?: (event: BaseEvent & { newState: State }) => any;\n}\n\nexport class StateMachine extends BaseObserver<StateMachineListener> {\n\tprotected currentState: State;\n\tprotected stateStack: State[];\n\tprotected engine: CanvasEngine;\n\n\tconstructor(engine: CanvasEngine) {\n\t\tsuper();\n\t\tthis.engine = engine;\n\t\tthis.stateStack = [];\n\t}\n\n\tgetCurrentState() {\n\t\treturn this.currentState;\n\t}\n\n\tpushState(state: State) {\n\t\tthis.stateStack.push(state);\n\t\tthis.setState(state);\n\t}\n\n\tpopState() {\n\t\tthis.stateStack.pop();\n\t\tthis.setState(_last(this.stateStack));\n\t}\n\n\tsetState(state: State) {\n\t\tstate.setEngine(this.engine);\n\n\t\t// if no state object, get the initial state\n\t\tif (this.currentState) {\n\t\t\tthis.currentState.deactivated(state);\n\t\t}\n\t\tconst old = this.currentState;\n\t\tthis.currentState = state;\n\t\tif (this.currentState) {\n\t\t\tthis.currentState.activated(old);\n\t\t\tthis.fireEvent<'stateChanged'>(\n\t\t\t\t{\n\t\t\t\t\tnewState: state\n\t\t\t\t},\n\t\t\t\t'stateChanged'\n\t\t\t);\n\t\t}\n\t}\n}\n","import _debounce from 'lodash/debounce';\nimport { CanvasModel } from './entities/canvas/CanvasModel';\nimport { FactoryBank } from './core/FactoryBank';\nimport { AbstractReactFactory } from './core/AbstractReactFactory';\nimport { LayerModel } from './entities/layer/LayerModel';\nimport { BaseListener, BaseObserver } from './core/BaseObserver';\nimport { MouseEvent } from 'react';\nimport { BaseModel } from './core-models/BaseModel';\nimport { Point } from '@projectstorm/geometry';\nimport { ActionEventBus } from './core-actions/ActionEventBus';\nimport { PanAndZoomCanvasAction } from './actions/PanAndZoomCanvasAction';\nimport { ZoomCanvasAction } from './actions/ZoomCanvasAction';\nimport { DeleteItemsAction } from './actions/DeleteItemsAction';\nimport { StateMachine } from './core-state/StateMachine';\n\nexport interface CanvasEngineListener extends BaseListener {\n\tcanvasReady?(): void;\n\n\trepaintCanvas?(): void;\n\n\trendered?(): void;\n}\n\n/**\n * Defines the CanvasEngine options\n */\nexport interface CanvasEngineOptions {\n\tregisterDefaultDeleteItemsAction?: boolean;\n\tregisterDefaultPanAndZoomCanvasAction?: boolean;\n\tregisterDefaultZoomCanvasAction?: boolean;\n\t/**\n\t * Defines the debounce wait time in milliseconds if > 0\n\t */\n\trepaintDebounceMs?: number;\n}\n\nexport class CanvasEngine<\n\tL extends CanvasEngineListener = CanvasEngineListener,\n\tM extends CanvasModel = CanvasModel\n> extends BaseObserver<L> {\n\tprotected model: M;\n\tprotected layerFactories: FactoryBank<AbstractReactFactory<LayerModel>>;\n\tprotected canvas: HTMLDivElement;\n\tprotected eventBus: ActionEventBus;\n\tprotected stateMachine: StateMachine;\n\tprotected options: CanvasEngineOptions;\n\n\tconstructor(options: CanvasEngineOptions = {}) {\n\t\tsuper();\n\t\tthis.model = null;\n\t\tthis.eventBus = new ActionEventBus(this);\n\t\tthis.stateMachine = new StateMachine(this);\n\t\tthis.layerFactories = new FactoryBank();\n\t\tthis.registerFactoryBank(this.layerFactories);\n\n\t\t/**\n\t\t * Overrides the standard options with the possible given options\n\t\t */\n\t\tthis.options = {\n\t\t\tregisterDefaultDeleteItemsAction: true,\n\t\t\tregisterDefaultZoomCanvasAction: true,\n\t\t\trepaintDebounceMs: 0,\n\t\t\t...options\n\t\t};\n\t\tif (this.options.registerDefaultZoomCanvasAction === true) {\n\t\t\tthis.eventBus.registerAction(new ZoomCanvasAction());\n\t\t} else if (this.options.registerDefaultPanAndZoomCanvasAction === true) {\n\t\t\tthis.eventBus.registerAction(new PanAndZoomCanvasAction());\n\t\t}\n\t\tif (this.options.registerDefaultDeleteItemsAction === true) {\n\t\t\tthis.eventBus.registerAction(new DeleteItemsAction());\n\t\t}\n\t}\n\n\tgetStateMachine() {\n\t\treturn this.stateMachine;\n\t}\n\n\tgetRelativeMousePoint(event: { clientX: number; clientY: number }): Point {\n\t\tconst point = this.getRelativePoint(event.clientX, event.clientY);\n\t\treturn new Point(\n\t\t\t(point.x - this.model.getOffsetX()) / (this.model.getZoomLevel() / 100.0),\n\t\t\t(point.y - this.model.getOffsetY()) / (this.model.getZoomLevel() / 100.0)\n\t\t);\n\t}\n\n\tgetRelativePoint(x, y): Point {\n\t\tconst canvasRect = this.canvas.getBoundingClientRect();\n\t\treturn new Point(x - canvasRect.left, y - canvasRect.top);\n\t}\n\n\tregisterFactoryBank(factory: FactoryBank) {\n\t\tfactory.registerListener({\n\t\t\tfactoryAdded: (event) => {\n\t\t\t\tevent.factory.setDiagramEngine(this);\n\t\t\t},\n\t\t\tfactoryRemoved: (event) => {\n\t\t\t\tevent.factory.setDiagramEngine(null);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetActionEventBus() {\n\t\treturn this.eventBus;\n\t}\n\n\tgetLayerFactories() {\n\t\treturn this.layerFactories;\n\t}\n\n\tgetFactoryForLayer<F extends AbstractReactFactory<LayerModel>>(layer: LayerModel | string) {\n\t\tif (typeof layer === 'string') {\n\t\t\treturn this.layerFactories.getFactory(layer);\n\t\t}\n\t\treturn this.layerFactories.getFactory(layer.getType());\n\t}\n\n\tsetModel(model: M) {\n\t\tthis.model = model;\n\t\tif (this.canvas) {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.repaintCanvas();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetModel(): M {\n\t\treturn this.model;\n\t}\n\n\trepaintCanvas(promise: true): Promise<any>;\n\trepaintCanvas(): void;\n\trepaintCanvas(promise?): Promise<any> | void {\n\t\tconst { repaintDebounceMs } = this.options;\n\n\t\t/**\n\t\t * The actual repaint function\n\t\t */\n\t\tconst repaint = () => {\n\t\t\tthis.iterateListeners((listener) => {\n\t\t\t\tif (listener.repaintCanvas) {\n\t\t\t\t\tlistener.repaintCanvas();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t// if the `repaintDebounceMs` option is > 0, then apply the debounce\n\t\tlet repaintFn = repaint;\n\n\t\tif (repaintDebounceMs > 0) {\n\t\t\trepaintFn = _debounce(repaint, repaintDebounceMs);\n\t\t}\n\n\t\tif (promise) {\n\t\t\treturn new Promise<void>((resolve) => {\n\t\t\t\tconst l = this.registerListener({\n\t\t\t\t\trendered: () => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t\tl.deregister();\n\t\t\t\t\t}\n\t\t\t\t} as L);\n\t\t\t\trepaintFn();\n\t\t\t});\n\t\t}\n\n\t\trepaintFn();\n\t}\n\n\tsetCanvas(canvas?: HTMLDivElement) {\n\t\tif (this.canvas !== canvas) {\n\t\t\tthis.canvas = canvas;\n\t\t\tif (canvas) {\n\t\t\t\tthis.fireEvent({}, 'canvasReady');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCanvas() {\n\t\treturn this.canvas;\n\t}\n\n\tgetMouseElement(event: MouseEvent): BaseModel {\n\t\treturn null;\n\t}\n\n\tzoomToFit() {\n\t\tconst xFactor = this.canvas.clientWidth / this.canvas.scrollWidth;\n\t\tconst yFactor = this.canvas.clientHeight / this.canvas.scrollHeight;\n\t\tconst zoomFactor = xFactor < yFactor ? xFactor : yFactor;\n\n\t\tthis.model.setZoomLevel(this.model.getZoomLevel() * zoomFactor);\n\t\tthis.model.setOffset(0, 0);\n\t\tthis.repaintCanvas();\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/flatMap\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/map\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/cloneDeep\");","import { Toolkit } from '../Toolkit';\nimport _cloneDeep from 'lodash/cloneDeep';\nimport { CanvasEngine } from '../CanvasEngine';\nimport { BaseEvent, BaseListener, BaseObserver } from '../core/BaseObserver';\nimport { BaseModel } from './BaseModel';\n\nexport interface BaseEntityEvent<T extends BaseEntity = BaseEntity> extends BaseEvent {\n\tentity: T;\n}\n\nexport interface BaseEntityListener<T extends BaseEntity = BaseEntity> extends BaseListener {\n\tlockChanged?(event: BaseEntityEvent<T> & { locked: boolean }): void;\n}\n\n/**\n * @TODO move to enums\n */\nexport type BaseEntityType = 'node' | 'link' | 'port' | 'point';\n\nexport interface BaseEntityOptions {\n\tid?: string;\n\tlocked?: boolean;\n}\n\nexport type BaseEntityGenerics = {\n\tLISTENER: BaseEntityListener;\n\tOPTIONS: BaseEntityOptions;\n};\n\nexport interface DeserializeEvent<T extends BaseEntity = BaseEntity> {\n\tengine: CanvasEngine;\n\tdata: ReturnType<T['serialize']>;\n\tregisterModel(model: BaseModel);\n\tgetModel<T extends BaseModel>(id: string): Promise<T>;\n}\n\nexport class BaseEntity<T extends BaseEntityGenerics = BaseEntityGenerics> extends BaseObserver<T['LISTENER']> {\n\tprotected options: T['OPTIONS'];\n\n\tconstructor(options: T['OPTIONS'] = {}) {\n\t\tsuper();\n\t\tthis.options = {\n\t\t\tid: Toolkit.UID(),\n\t\t\t...options\n\t\t};\n\t}\n\n\tgetOptions() {\n\t\treturn this.options;\n\t}\n\n\tgetID() {\n\t\treturn this.options.id;\n\t}\n\n\tdoClone(lookupTable: { [s: string]: any } = {}, clone: any) {\n\t\t/*noop*/\n\t}\n\n\tclone(lookupTable: { [s: string]: any } = {}) {\n\t\t// try and use an existing clone first\n\t\tif (lookupTable[this.options.id]) {\n\t\t\treturn lookupTable[this.options.id];\n\t\t}\n\t\tlet clone = _cloneDeep(this);\n\t\tclone.options = {\n\t\t\t...this.options,\n\t\t\tid: Toolkit.UID()\n\t\t};\n\t\tclone.clearListeners();\n\t\tlookupTable[this.options.id] = clone;\n\n\t\tthis.doClone(lookupTable, clone);\n\t\treturn clone;\n\t}\n\n\tclearListeners() {\n\t\tthis.listeners = {};\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tthis.options.id = event.data.id;\n\t\tthis.options.locked = event.data.locked;\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\tid: this.options.id,\n\t\t\tlocked: this.options.locked\n\t\t};\n\t}\n\n\tfireEvent<L extends Partial<BaseEntityEvent> & object>(event: L, k: keyof T['LISTENER']) {\n\t\tsuper.fireEvent(\n\t\t\t{\n\t\t\t\tentity: this,\n\t\t\t\t...event\n\t\t\t},\n\t\t\tk\n\t\t);\n\t}\n\n\tpublic isLocked(): boolean {\n\t\treturn this.options.locked;\n\t}\n\n\tpublic setLocked(locked: boolean = true) {\n\t\tthis.options.locked = locked;\n\t\tthis.fireEvent(\n\t\t\t{\n\t\t\t\tlocked: locked\n\t\t\t},\n\t\t\t'lockChanged'\n\t\t);\n\t}\n}\n","import _filter from 'lodash/filter';\nimport _flatMap from 'lodash/flatMap';\nimport _forEach from 'lodash/forEach';\nimport _map from 'lodash/map';\nimport _values from 'lodash/values';\nimport {\n\tBaseEntity,\n\tBaseEntityEvent,\n\tBaseEntityGenerics,\n\tBaseEntityListener,\n\tBaseEntityOptions,\n\tDeserializeEvent\n} from '../../core-models/BaseEntity';\nimport { LayerModel } from '../layer/LayerModel';\nimport { BaseModel } from '../../core-models/BaseModel';\nimport { CanvasEngine } from '../../CanvasEngine';\n\nexport interface CanvasModelListener extends BaseEntityListener {\n\toffsetUpdated?(event: BaseEntityEvent<CanvasModel> & { offsetX: number; offsetY: number }): void;\n\n\tzoomUpdated?(event: BaseEntityEvent<CanvasModel> & { zoom: number }): void;\n\n\tgridUpdated?(event: BaseEntityEvent<CanvasModel> & { size: number }): void;\n}\n\nexport interface CanvasModelOptions extends BaseEntityOptions {\n\toffsetX?: number;\n\toffsetY?: number;\n\tzoom?: number;\n\tgridSize?: number;\n}\n\nexport interface CanvasModelGenerics extends BaseEntityGenerics {\n\tLISTENER: CanvasModelListener;\n\tOPTIONS: CanvasModelOptions;\n\tLAYER: LayerModel;\n}\n\nexport class CanvasModel<G extends CanvasModelGenerics = CanvasModelGenerics> extends BaseEntity<G> {\n\tprotected layers: G['LAYER'][];\n\n\tconstructor(options: G['OPTIONS'] = {}) {\n\t\tsuper({\n\t\t\tzoom: 100,\n\t\t\tgridSize: 0,\n\t\t\toffsetX: 0,\n\t\t\toffsetY: 0,\n\t\t\t...options\n\t\t});\n\t\tthis.layers = [];\n\t}\n\n\tgetSelectionEntities(): BaseModel[] {\n\t\treturn _flatMap(this.layers, (layer) => {\n\t\t\treturn layer.getSelectionEntities();\n\t\t});\n\t}\n\n\tgetSelectedEntities(): BaseModel[] {\n\t\treturn _filter(this.getSelectionEntities(), (ob) => {\n\t\t\treturn ob.isSelected();\n\t\t});\n\t}\n\n\tclearSelection() {\n\t\t_forEach(this.getSelectedEntities(), (element) => {\n\t\t\telement.setSelected(false);\n\t\t});\n\t}\n\n\tgetModels(): BaseModel[] {\n\t\treturn _flatMap(this.layers, (layer) => {\n\t\t\treturn _values(layer.getModels());\n\t\t});\n\t}\n\n\taddLayer(layer: LayerModel) {\n\t\tlayer.setParent(this);\n\t\tlayer.registerListener({\n\t\t\tentityRemoved: (event: BaseEntityEvent<BaseModel>): void => {}\n\t\t});\n\t\tthis.layers.push(layer);\n\t}\n\n\tremoveLayer(layer: LayerModel) {\n\t\tconst index = this.layers.indexOf(layer);\n\t\tif (index !== -1) {\n\t\t\tthis.layers.splice(index, 1);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetLayers() {\n\t\treturn this.layers;\n\t}\n\n\tsetGridSize(size: number = 0) {\n\t\tthis.options.gridSize = size;\n\t\tthis.fireEvent({ size: size }, 'gridUpdated');\n\t}\n\n\tgetGridPosition(pos: number) {\n\t\tif (this.options.gridSize === 0) {\n\t\t\treturn pos;\n\t\t}\n\t\treturn this.options.gridSize * Math.floor((pos + this.options.gridSize / 2) / this.options.gridSize);\n\t}\n\n\tdeserializeModel(data: ReturnType<this['serialize']>, engine: CanvasEngine) {\n\t\tconst models: {\n\t\t\t[id: string]: BaseModel;\n\t\t} = {};\n\t\tconst promises: {\n\t\t\t[id: string]: Promise<BaseModel>;\n\t\t} = {};\n\t\tconst resolvers: {\n\t\t\t[id: string]: (model: BaseModel) => any;\n\t\t} = {};\n\n\t\tconst event: DeserializeEvent = {\n\t\t\tdata: data,\n\t\t\tengine: engine,\n\t\t\tregisterModel: (model: BaseModel) => {\n\t\t\t\tmodels[model.getID()] = model;\n\t\t\t\tif (resolvers[model.getID()]) {\n\t\t\t\t\tresolvers[model.getID()](model);\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetModel<T extends BaseModel>(id: string): Promise<T> {\n\t\t\t\tif (models[id]) {\n\t\t\t\t\treturn Promise.resolve(models[id]) as Promise<T>;\n\t\t\t\t}\n\t\t\t\tif (!promises[id]) {\n\t\t\t\t\tpromises[id] = new Promise((resolve) => {\n\t\t\t\t\t\tresolvers[id] = resolve;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn promises[id] as Promise<T>;\n\t\t\t}\n\t\t};\n\t\tthis.deserialize(event);\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.options.offsetX = event.data.offsetX;\n\t\tthis.options.offsetY = event.data.offsetY;\n\t\tthis.options.zoom = event.data.zoom;\n\t\tthis.options.gridSize = event.data.gridSize;\n\t\t_forEach(event.data.layers, (layer) => {\n\t\t\tconst layerOb = event.engine.getFactoryForLayer(layer.type).generateModel({\n\t\t\t\tinitialConfig: layer\n\t\t\t});\n\t\t\tlayerOb.deserialize({\n\t\t\t\t...event,\n\t\t\t\tdata: layer\n\t\t\t});\n\t\t\tthis.addLayer(layerOb);\n\t\t});\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\toffsetX: this.options.offsetX,\n\t\t\toffsetY: this.options.offsetY,\n\t\t\tzoom: this.options.zoom,\n\t\t\tgridSize: this.options.gridSize,\n\t\t\tlayers: _map(this.layers, (layer) => {\n\t\t\t\treturn layer.serialize();\n\t\t\t})\n\t\t};\n\t}\n\n\tsetZoomLevel(zoom: number) {\n\t\tthis.options.zoom = zoom;\n\t\tthis.fireEvent({ zoom }, 'zoomUpdated');\n\t}\n\n\tsetOffset(offsetX: number, offsetY: number) {\n\t\tthis.options.offsetX = offsetX;\n\t\tthis.options.offsetY = offsetY;\n\t\tthis.fireEvent({ offsetX, offsetY }, 'offsetUpdated');\n\t}\n\n\tsetOffsetX(offsetX: number) {\n\t\tthis.setOffset(offsetX, this.options.offsetY);\n\t}\n\n\tsetOffsetY(offsetY: number) {\n\t\tthis.setOffset(this.options.offsetX, offsetY);\n\t}\n\n\tgetOffsetY() {\n\t\treturn this.options.offsetY;\n\t}\n\n\tgetOffsetX() {\n\t\treturn this.options.offsetX;\n\t}\n\n\tgetZoomLevel() {\n\t\treturn this.options.zoom;\n\t}\n}\n","import { CanvasEngine } from '../CanvasEngine';\nimport { FactoryBank } from './FactoryBank';\n\n/**\n * Base factory for all the different types of entities.\n * Gets registered with the engine, and is used to generate models\n */\nexport abstract class AbstractFactory<E extends CanvasEngine = CanvasEngine> {\n\t/**\n\t * Couples the factory with the models it generates\n\t */\n\tprotected type: string;\n\t/**\n\t * The engine gets injected when the factory is registered\n\t */\n\tprotected engine: E;\n\tprotected bank: FactoryBank;\n\n\tconstructor(type: string) {\n\t\tthis.type = type;\n\t}\n\n\tsetDiagramEngine(engine: E) {\n\t\tthis.engine = engine;\n\t}\n\n\tsetFactoryBank(bank: FactoryBank) {\n\t\tthis.bank = bank;\n\t}\n\n\tgetType(): string {\n\t\treturn this.type;\n\t}\n}\n","import { AbstractFactory } from './AbstractFactory';\nimport { BaseModel } from '../core-models/BaseModel';\nimport { CanvasEngine } from '../CanvasEngine';\n\nexport interface GenerateModelEvent {\n\tinitialConfig?: any;\n}\n\nexport abstract class AbstractModelFactory<\n\tT extends BaseModel = BaseModel,\n\tE extends CanvasEngine = CanvasEngine\n> extends AbstractFactory<E> {\n\t/**\n\t * Generates new models (the core factory pattern)\n\t */\n\tabstract generateModel(event: GenerateModelEvent): T;\n}\n","import { BaseModel } from '../core-models/BaseModel';\nimport { AbstractModelFactory } from './AbstractModelFactory';\nimport { CanvasEngine } from '../CanvasEngine';\n\nexport interface GenerateWidgetEvent<T extends BaseModel> {\n\tmodel: T;\n}\n\n/**\n * Further extends the AbstractFactory to add widget generation capability.\n */\nexport abstract class AbstractReactFactory<\n\tT extends BaseModel = BaseModel,\n\tE extends CanvasEngine = CanvasEngine\n> extends AbstractModelFactory<T, E> {\n\t/**\n\t * Generates React widgets from the model contained in the event object\n\t */\n\tabstract generateReactWidget(event: GenerateWidgetEvent<T>): JSX.Element;\n}\n","import {\n\tBaseEntity,\n\tBaseEntityEvent,\n\tBaseEntityGenerics,\n\tBaseEntityListener,\n\tBaseEntityOptions,\n\tDeserializeEvent\n} from './BaseEntity';\nimport { CanvasModel } from '../entities/canvas/CanvasModel';\n\nexport interface BaseModelListener extends BaseEntityListener {\n\tselectionChanged?(event: BaseEntityEvent<BaseModel> & { isSelected: boolean }): void;\n\n\tentityRemoved?(event: BaseEntityEvent<BaseModel>): void;\n}\n\nexport interface BaseModelOptions extends BaseEntityOptions {\n\ttype?: string;\n\tselected?: boolean;\n\textras?: any;\n}\n\nexport interface BaseModelGenerics extends BaseEntityGenerics {\n\tLISTENER: BaseModelListener;\n\tPARENT: BaseEntity;\n\tOPTIONS: BaseModelOptions;\n}\n\nexport class BaseModel<G extends BaseModelGenerics = BaseModelGenerics> extends BaseEntity<G> {\n\tprotected parent: G['PARENT'];\n\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper(options);\n\t}\n\n\tperformanceTune() {\n\t\treturn true;\n\t}\n\n\tgetParentCanvasModel(): CanvasModel {\n\t\tif (!this.parent) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this.parent instanceof CanvasModel) {\n\t\t\treturn this.parent;\n\t\t} else if (this.parent instanceof BaseModel) {\n\t\t\treturn this.parent.getParentCanvasModel();\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetParent(): G['PARENT'] {\n\t\treturn this.parent;\n\t}\n\n\tsetParent(parent: G['PARENT']) {\n\t\tthis.parent = parent;\n\t}\n\n\tgetSelectionEntities(): Array<BaseModel> {\n\t\treturn [this];\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\ttype: this.options.type,\n\t\t\tselected: this.options.selected,\n\t\t\textras: this.options.extras\n\t\t};\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.options.extras = event.data.extras;\n\t\tthis.options.selected = event.data.selected;\n\t}\n\n\tgetType(): string {\n\t\treturn this.options.type;\n\t}\n\n\tisSelected(): boolean {\n\t\treturn this.options.selected;\n\t}\n\n\tisLocked(): boolean {\n\t\tconst locked = super.isLocked();\n\t\tif (locked) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// delegate this call up to the parent\n\t\tif (this.parent) {\n\t\t\treturn this.parent.isLocked();\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetSelected(selected: boolean = true) {\n\t\tif (this.options.selected !== selected) {\n\t\t\tthis.options.selected = selected;\n\n\t\t\tthis.fireEvent(\n\t\t\t\t{\n\t\t\t\t\tisSelected: selected\n\t\t\t\t},\n\t\t\t\t'selectionChanged'\n\t\t\t);\n\t\t}\n\t}\n\n\tremove() {\n\t\tthis.fireEvent({}, 'entityRemoved');\n\t}\n}\n","import { BaseModel, BaseModelGenerics, BaseModelListener, BaseModelOptions } from './BaseModel';\nimport { BaseEntityEvent, DeserializeEvent } from './BaseEntity';\nimport { Point, Rectangle } from '@projectstorm/geometry';\nimport { ModelGeometryInterface } from '../core/ModelGeometryInterface';\n\nexport interface BasePositionModelListener extends BaseModelListener {\n\tpositionChanged?(event: BaseEntityEvent<BasePositionModel>): void;\n}\n\nexport interface BasePositionModelOptions extends BaseModelOptions {\n\tposition?: Point;\n}\n\nexport interface BasePositionModelGenerics extends BaseModelGenerics {\n\tLISTENER: BasePositionModelListener;\n\tOPTIONS: BasePositionModelOptions;\n}\n\nexport class BasePositionModel<G extends BasePositionModelGenerics = BasePositionModelGenerics>\n\textends BaseModel<G>\n\timplements ModelGeometryInterface\n{\n\tprotected position: Point;\n\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper(options);\n\t\tthis.position = options.position || new Point(0, 0);\n\t}\n\n\tsetPosition(point: Point): void;\n\tsetPosition(x: number, y: number): void;\n\tsetPosition(x: number | Point, y?: number): void {\n\t\tif (x instanceof Point) {\n\t\t\tthis.position = x;\n\t\t} else {\n\t\t\tthis.position = new Point(x, y);\n\t\t}\n\t\tthis.fireEvent({}, 'positionChanged');\n\t}\n\n\tgetBoundingBox(): Rectangle {\n\t\treturn Rectangle.fromPointAndSize(this.position, 0, 0);\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.position = new Point(event.data.x, event.data.y);\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\tx: this.position.x,\n\t\t\ty: this.position.y\n\t\t};\n\t}\n\n\tgetPosition(): Point {\n\t\treturn this.position;\n\t}\n\n\tgetX() {\n\t\treturn this.position.x;\n\t}\n\n\tgetY() {\n\t\treturn this.position.y;\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"react\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@emotion/styled\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@emotion/react\");","import * as React from 'react';\nimport styled from '@emotion/styled';\nimport { CSSProperties } from 'react';\nimport { LayerModel } from './LayerModel';\nimport { css } from '@emotion/react';\n\nexport interface TransformLayerWidgetProps {\n\tlayer: LayerModel;\n}\n\nnamespace S {\n\tconst shared = css`\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tposition: absolute;\n\t\tpointer-events: none;\n\t\ttransform-origin: 0 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\toverflow: visible;\n\t`;\n\n\texport const DivLayer = styled.div`\n\t\t${shared}\n\t`;\n\n\texport const SvgLayer = styled.svg`\n\t\t${shared}\n\t`;\n}\n\nexport class TransformLayerWidget extends React.Component<React.PropsWithChildren<TransformLayerWidgetProps>> {\n\tconstructor(props: TransformLayerWidgetProps) {\n\t\tsuper(props);\n\t\tthis.state = {};\n\t}\n\n\tgetTransform() {\n\t\tconst model = this.props.layer.getParent();\n\t\treturn `\n\t\t\ttranslate(\n\t\t\t\t${model.getOffsetX()}px,\n\t\t\t\t${model.getOffsetY()}px)\n\t\t\tscale(\n\t\t\t\t${model.getZoomLevel() / 100.0}\n\t\t\t)\n  \t`;\n\t}\n\n\tgetTransformStyle(): CSSProperties {\n\t\tif (this.props.layer.getOptions().transformed) {\n\t\t\treturn {\n\t\t\t\ttransform: this.getTransform()\n\t\t\t};\n\t\t}\n\t\treturn {};\n\t}\n\n\trender() {\n\t\tif (this.props.layer.getOptions().isSvg) {\n\t\t\treturn <S.SvgLayer style={this.getTransformStyle()}>{this.props.children}</S.SvgLayer>;\n\t\t}\n\t\treturn <S.DivLayer style={this.getTransformStyle()}>{this.props.children}</S.DivLayer>;\n\t}\n}\n","import * as React from 'react';\nimport { CanvasEngine } from '../../CanvasEngine';\nimport { TransformLayerWidget } from '../layer/TransformLayerWidget';\nimport styled from '@emotion/styled';\nimport { SmartLayerWidget } from '../layer/SmartLayerWidget';\n\nexport interface DiagramProps {\n\tengine: CanvasEngine;\n\tclassName?: string;\n}\n\nnamespace S {\n\texport const Canvas = styled.div`\n\t\tposition: relative;\n\t\tcursor: move;\n\t\toverflow: hidden;\n\t`;\n}\n\nexport class CanvasWidget extends React.Component<DiagramProps> {\n\tref: React.RefObject<HTMLDivElement>;\n\tkeyUp: any;\n\tkeyDown: any;\n\tcanvasListener: any;\n\n\tconstructor(props: DiagramProps) {\n\t\tsuper(props);\n\n\t\tthis.ref = React.createRef();\n\t\tthis.state = {\n\t\t\taction: null,\n\t\t\tdiagramEngineListener: null\n\t\t};\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.props.engine.deregisterListener(this.canvasListener);\n\t\tthis.props.engine.setCanvas(null);\n\n\t\tdocument.removeEventListener('keyup', this.keyUp);\n\t\tdocument.removeEventListener('keydown', this.keyDown);\n\t}\n\n\tregisterCanvas() {\n\t\tthis.props.engine.setCanvas(this.ref.current);\n\t\tthis.props.engine.iterateListeners((list) => {\n\t\t\tlist.rendered && list.rendered();\n\t\t});\n\t}\n\n\tcomponentDidUpdate() {\n\t\tthis.registerCanvas();\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.canvasListener = this.props.engine.registerListener({\n\t\t\trepaintCanvas: () => {\n\t\t\t\tthis.forceUpdate();\n\t\t\t}\n\t\t});\n\n\t\tthis.keyDown = (event) => {\n\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t};\n\t\tthis.keyUp = (event) => {\n\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t};\n\n\t\tdocument.addEventListener('keyup', this.keyUp);\n\t\tdocument.addEventListener('keydown', this.keyDown);\n\t\tthis.registerCanvas();\n\t}\n\n\trender() {\n\t\tconst engine = this.props.engine;\n\t\tconst model = engine.getModel();\n\n\t\treturn (\n\t\t\t<S.Canvas\n\t\t\t\tclassName={this.props.className}\n\t\t\t\tref={this.ref}\n\t\t\t\tonWheel={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t\tonMouseDown={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t\tonMouseUp={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t\tonMouseMove={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t\tonTouchStart={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t\tonTouchEnd={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t\tonTouchMove={(event) => {\n\t\t\t\t\tthis.props.engine.getActionEventBus().fireAction({ event });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{model.getLayers().map((layer) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<TransformLayerWidget layer={layer} key={layer.getID()}>\n\t\t\t\t\t\t\t<SmartLayerWidget layer={layer} engine={this.props.engine} key={layer.getID()} />\n\t\t\t\t\t\t</TransformLayerWidget>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</S.Canvas>\n\t\t);\n\t}\n}\n","import * as React from 'react';\nimport { LayerModel } from './LayerModel';\nimport { CanvasEngine } from '../../CanvasEngine';\n\nexport interface SmartLayerWidgetProps {\n\tlayer: LayerModel;\n\tengine: CanvasEngine;\n}\n\nexport class SmartLayerWidget extends React.Component<SmartLayerWidgetProps> {\n\tshouldComponentUpdate(): boolean {\n\t\treturn this.props.layer.isRepaintEnabled();\n\t}\n\n\trender() {\n\t\treturn this.props.engine.getFactoryForLayer(this.props.layer).generateReactWidget({ model: this.props.layer });\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/mapValues\");","import * as React from 'react';\nimport styled from '@emotion/styled';\nimport { SimpleClientRect } from '../../states/SelectionBoxState';\n\nexport interface SelectionBoxWidgetProps {\n\trect: SimpleClientRect;\n}\n\nnamespace S {\n\texport const Container = styled.div`\n\t\tposition: absolute;\n\t\tbackground-color: rgba(0, 192, 255, 0.2);\n\t\tborder: solid 2px rgb(0, 192, 255);\n\t`;\n}\n\nexport class SelectionBoxWidget extends React.Component<SelectionBoxWidgetProps> {\n\trender() {\n\t\tconst { rect } = this.props;\n\n\t\tif (!rect) return null;\n\n\t\treturn (\n\t\t\t<S.Container\n\t\t\t\tstyle={{\n\t\t\t\t\ttop: rect.top,\n\t\t\t\t\tleft: rect.left,\n\t\t\t\t\twidth: rect.width,\n\t\t\t\t\theight: rect.height\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n}\n","import { BaseModel, BaseModelGenerics, BaseModelOptions } from '../../core-models/BaseModel';\nimport { CanvasModel } from '../canvas/CanvasModel';\nimport _flatMap from 'lodash/flatMap';\nimport _forEach from 'lodash/forEach';\nimport _mapValues from 'lodash/mapValues';\nimport { CanvasEngine } from '../../CanvasEngine';\nimport { FactoryBank } from '../../core/FactoryBank';\nimport { AbstractModelFactory } from '../../core/AbstractModelFactory';\nimport { DeserializeEvent } from '../../core-models/BaseEntity';\n\nexport interface LayerModelOptions extends BaseModelOptions {\n\tisSvg?: boolean;\n\ttransformed?: boolean;\n}\n\nexport interface LayerModelGenerics extends BaseModelGenerics {\n\tOPTIONS: LayerModelOptions;\n\tPARENT: CanvasModel;\n\tCHILDREN: BaseModel;\n\tENGINE: CanvasEngine;\n}\n\nexport abstract class LayerModel<G extends LayerModelGenerics = LayerModelGenerics> extends BaseModel<G> {\n\tprotected models: { [id: string]: G['CHILDREN'] };\n\tprotected repaintEnabled: boolean;\n\n\tconstructor(options: G['OPTIONS'] = {}) {\n\t\tsuper(options);\n\t\tthis.models = {};\n\t\tthis.repaintEnabled = true;\n\t}\n\n\t/**\n\t * This is used for deserialization\n\t */\n\tabstract getChildModelFactoryBank(engine: G['ENGINE']): FactoryBank<AbstractModelFactory<BaseModel>>;\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.options.isSvg = !!event.data.isSvg;\n\t\tthis.options.transformed = !!event.data.transformed;\n\t\t_forEach(event.data.models, (model) => {\n\t\t\tconst modelOb = this.getChildModelFactoryBank(event.engine).getFactory(model.type).generateModel({\n\t\t\t\tinitialConfig: model\n\t\t\t});\n\t\t\tmodelOb.deserialize({\n\t\t\t\t...event,\n\t\t\t\tdata: model\n\t\t\t});\n\t\t\tthis.addModel(modelOb);\n\t\t});\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\tisSvg: this.options.isSvg,\n\t\t\ttransformed: this.options.transformed,\n\t\t\tmodels: _mapValues(this.models, (model) => {\n\t\t\t\treturn model.serialize();\n\t\t\t})\n\t\t};\n\t}\n\n\tisRepaintEnabled() {\n\t\treturn this.repaintEnabled;\n\t}\n\n\tallowRepaint(allow: boolean = true) {\n\t\tthis.repaintEnabled = allow;\n\t}\n\n\tremove() {\n\t\tif (this.parent) {\n\t\t\tthis.parent.removeLayer(this);\n\t\t}\n\t\tsuper.remove();\n\t}\n\n\taddModel(model: G['CHILDREN']) {\n\t\tmodel.setParent(this);\n\t\tthis.models[model.getID()] = model;\n\t}\n\n\tgetSelectionEntities(): Array<BaseModel> {\n\t\treturn _flatMap(this.models, (model) => {\n\t\t\treturn model.getSelectionEntities();\n\t\t});\n\t}\n\n\tgetModels() {\n\t\treturn this.models;\n\t}\n\n\tgetModel(id: string) {\n\t\treturn this.models[id];\n\t}\n\n\tremoveModel(id: string | G['CHILDREN']): boolean {\n\t\tconst _id = typeof id === 'string' ? id : id.getID();\n\t\tif (this.models[_id]) {\n\t\t\tdelete this.models[_id];\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n","import { LayerModel } from '../layer/LayerModel';\nimport { FactoryBank } from '../../core/FactoryBank';\nimport { AbstractModelFactory } from '../../core/AbstractModelFactory';\nimport { BaseModel } from '../../core-models/BaseModel';\nimport { SimpleClientRect } from '../../states/SelectionBoxState';\n\nexport class SelectionLayerModel extends LayerModel {\n\tbox: SimpleClientRect;\n\n\tconstructor() {\n\t\tsuper({\n\t\t\ttransformed: false,\n\t\t\tisSvg: false,\n\t\t\ttype: 'selection'\n\t\t});\n\t}\n\n\tsetBox(rect: SimpleClientRect) {\n\t\tthis.box = rect;\n\t}\n\n\tgetChildModelFactoryBank(): FactoryBank<AbstractModelFactory<BaseModel>> {\n\t\t// is not used as it doesnt serialize\n\t\treturn null;\n\t}\n}\n","import * as React from 'react';\nimport { AbstractReactFactory, GenerateWidgetEvent } from '../../core/AbstractReactFactory';\nimport { SelectionLayerModel } from './SelectionLayerModel';\nimport { GenerateModelEvent } from '../../core/AbstractModelFactory';\nimport { SelectionBoxWidget } from './SelectionBoxWidget';\n\nexport class SelectionBoxLayerFactory extends AbstractReactFactory<SelectionLayerModel> {\n\tconstructor() {\n\t\tsuper('selection');\n\t}\n\n\tgenerateModel(event: GenerateModelEvent): SelectionLayerModel {\n\t\treturn new SelectionLayerModel();\n\t}\n\n\tgenerateReactWidget(event: GenerateWidgetEvent<SelectionLayerModel>): JSX.Element {\n\t\treturn <SelectionBoxWidget rect={event.model.box} />;\n\t}\n}\n","import * as React from 'react';\nimport _isEqual from 'lodash/isEqual';\nimport { BaseModel } from '../core-models/BaseModel';\n\nexport interface PeformanceWidgetProps {\n\tchildren: () => JSX.Element;\n\tserialized: object;\n\tmodel: BaseModel;\n}\n\nexport interface PeformanceWidgetState {}\n\nexport class PeformanceWidget extends React.Component<PeformanceWidgetProps, PeformanceWidgetState> {\n\tshouldComponentUpdate(\n\t\tnextProps: Readonly<PeformanceWidgetProps>,\n\t\tnextState: Readonly<PeformanceWidgetState>,\n\t\tnextContext: any\n\t): boolean {\n\t\tif (!this.props.model.performanceTune()) {\n\t\t\treturn true;\n\t\t}\n\t\t// deserialization event\n\t\tif (this.props.model !== nextProps.model) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// change event\n\t\treturn !_isEqual(this.props.serialized, nextProps.serialized);\n\t}\n\n\trender() {\n\t\treturn this.props.children();\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash/intersection\");","import { CanvasEngine } from '../CanvasEngine';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\nimport { SyntheticEvent } from 'react';\nimport _intersection from 'lodash/intersection';\n\nexport interface StateOptions {\n\tname: string;\n}\n\nexport abstract class State<E extends CanvasEngine = CanvasEngine> {\n\tprotected engine: E;\n\tprotected actions: Action[];\n\tprotected keys: string[];\n\tprotected options: StateOptions;\n\tprotected childStates: State[];\n\n\tprivate handler1;\n\tprivate handler2;\n\n\tconstructor(options: StateOptions) {\n\t\tthis.actions = [];\n\t\tthis.keys = [];\n\t\tthis.childStates = [];\n\t\tthis.options = options;\n\t}\n\n\tsetEngine(engine: E) {\n\t\tthis.engine = engine;\n\t}\n\n\tgetOptions() {\n\t\treturn this.options;\n\t}\n\n\teject() {\n\t\tthis.engine.getStateMachine().popState();\n\t}\n\n\ttransitionWithEvent(state: State, event: ActionEvent<SyntheticEvent>) {\n\t\tthis.engine.getStateMachine().pushState(state);\n\t\tthis.engine.getActionEventBus().fireAction(event);\n\t}\n\n\tregisterAction(action: Action) {\n\t\tthis.actions.push(action);\n\t}\n\n\ttryActivateParentState(keys: string[]) {\n\t\tif (this.keys.length > 0 && !this.isKeysFullfilled(keys)) {\n\t\t\tthis.eject();\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttryActivateChildState(keys: string[]) {\n\t\tconst state = this.findStateToActivate(keys);\n\t\tif (state) {\n\t\t\tthis.engine.getStateMachine().pushState(state);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tfindStateToActivate(keys: string[]) {\n\t\tfor (let child of this.childStates) {\n\t\t\tif (child.isKeysFullfilled(keys)) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisKeysFullfilled(keys: string[]) {\n\t\treturn _intersection(this.keys, keys).length === this.keys.length;\n\t}\n\n\tactivated(previous: State) {\n\t\tconst keys = this.engine.getActionEventBus().getKeys();\n\n\t\tif (this.tryActivateParentState(keys) || this.tryActivateChildState(keys)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// perhaps we need to pop again?\n\t\tthis.handler1 = this.engine.getActionEventBus().registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.KEY_DOWN,\n\t\t\t\tfire: () => {\n\t\t\t\t\tthis.tryActivateChildState(this.engine.getActionEventBus().getKeys());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tthis.handler2 = this.engine.getActionEventBus().registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.KEY_UP,\n\t\t\t\tfire: () => {\n\t\t\t\t\tthis.tryActivateParentState(this.engine.getActionEventBus().getKeys());\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tfor (let action of this.actions) {\n\t\t\tthis.engine.getActionEventBus().registerAction(action);\n\t\t}\n\t}\n\n\tdeactivated(next: State) {\n\t\tif (this.handler1) {\n\t\t\tthis.handler1();\n\t\t}\n\t\tif (this.handler2) {\n\t\t\tthis.handler2();\n\t\t}\n\t\t// if this happens, we are going into heirachial state machine mode\n\t\tfor (let action of this.actions) {\n\t\t\tthis.engine.getActionEventBus().deregisterAction(action);\n\t\t}\n\t}\n}\n","import { State, StateOptions } from './State';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\nimport { CanvasEngine } from '../CanvasEngine';\n\nexport interface AbstractDisplacementStateEvent {\n\tdisplacementX: number;\n\tdisplacementY: number;\n\tvirtualDisplacementX: number;\n\tvirtualDisplacementY: number;\n\tevent: React.MouseEvent | React.TouchEvent;\n}\n\nexport abstract class AbstractDisplacementState<E extends CanvasEngine = CanvasEngine> extends State<E> {\n\tinitialX: number;\n\tinitialY: number;\n\tinitialXRelative: number;\n\tinitialYRelative: number;\n\n\tconstructor(options: StateOptions) {\n\t\tsuper(options);\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_DOWN,\n\t\t\t\tfire: (actionEvent: ActionEvent<React.MouseEvent>) => {\n\t\t\t\t\tconst { clientX, clientY } = actionEvent.event;\n\t\t\t\t\tthis.handleMoveStart(clientX, clientY);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_MOVE,\n\t\t\t\tfire: (actionEvent: ActionEvent<React.MouseEvent>) => {\n\t\t\t\t\tconst { event } = actionEvent;\n\n\t\t\t\t\tif (event.buttons === 0) {\n\t\t\t\t\t\t// If buttons is 0, it means the mouse is not down, the user may have released it\n\t\t\t\t\t\t// outside of the canvas, then we eject the state\n\t\t\t\t\t\tthis.eject();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { clientX, clientY } = event;\n\t\t\t\t\tthis.handleMove(clientX, clientY, event);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_UP,\n\t\t\t\tfire: () => this.handleMoveEnd()\n\t\t\t})\n\t\t);\n\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.TOUCH_START,\n\t\t\t\tfire: (actionEvent: ActionEvent<React.TouchEvent>) => {\n\t\t\t\t\tconst { clientX, clientY } = actionEvent.event.touches[0];\n\t\t\t\t\tthis.handleMoveStart(clientX, clientY);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.TOUCH_MOVE,\n\t\t\t\tfire: (actionEvent: ActionEvent<React.TouchEvent>) => {\n\t\t\t\t\tconst { event } = actionEvent;\n\t\t\t\t\tconst { clientX, clientY } = event.touches[0];\n\t\t\t\t\tthis.handleMove(clientX, clientY, event);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.TOUCH_END,\n\t\t\t\tfire: () => this.handleMoveEnd()\n\t\t\t})\n\t\t);\n\t}\n\n\tprotected handleMoveStart(x: number, y: number): void {\n\t\tthis.initialX = x;\n\t\tthis.initialY = y;\n\t\tconst rel = this.engine.getRelativePoint(x, y);\n\t\tthis.initialXRelative = rel.x;\n\t\tthis.initialYRelative = rel.y;\n\t}\n\n\tprotected handleMove(x: number, y: number, event: React.MouseEvent | React.TouchEvent): void {\n\t\tthis.fireMouseMoved({\n\t\t\tdisplacementX: x - this.initialX,\n\t\t\tdisplacementY: y - this.initialY,\n\t\t\tvirtualDisplacementX: (x - this.initialX) / (this.engine.getModel().getZoomLevel() / 100.0),\n\t\t\tvirtualDisplacementY: (y - this.initialY) / (this.engine.getModel().getZoomLevel() / 100.0),\n\t\t\tevent\n\t\t});\n\t}\n\n\tprotected handleMoveEnd(): void {\n\t\tthis.eject();\n\t}\n\n\tabstract fireMouseMoved(event: AbstractDisplacementStateEvent);\n}\n","import { CanvasEngine } from '../CanvasEngine';\nimport { AbstractDisplacementState, AbstractDisplacementStateEvent } from '../core-state/AbstractDisplacementState';\nimport { State } from '../core-state/State';\n\nexport interface DragCanvasStateOptions {\n\t/**\n\t * If enabled, the canvas is available to drag\n\t */\n\tallowDrag?: boolean;\n}\n\nexport class DragCanvasState<E extends CanvasEngine = CanvasEngine> extends AbstractDisplacementState<E> {\n\t// store this as we drag the canvas\n\tinitialCanvasX: number;\n\tinitialCanvasY: number;\n\tconfig: DragCanvasStateOptions;\n\n\tconstructor(options: DragCanvasStateOptions = {}) {\n\t\tsuper({\n\t\t\tname: 'drag-canvas'\n\t\t});\n\t\tthis.config = {\n\t\t\tallowDrag: true,\n\t\t\t...options\n\t\t};\n\t}\n\n\tasync activated(prev) {\n\t\tsuper.activated(prev);\n\t\tthis.engine.getModel().clearSelection();\n\t\tawait this.engine.repaintCanvas(true);\n\n\t\t// we can block layer rendering because we are only targeting the transforms\n\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\tlayer.allowRepaint(false);\n\t\t}\n\n\t\tthis.initialCanvasX = this.engine.getModel().getOffsetX();\n\t\tthis.initialCanvasY = this.engine.getModel().getOffsetY();\n\t}\n\n\tdeactivated(next: State) {\n\t\tsuper.deactivated(next);\n\t\tfor (let layer of this.engine.getModel().getLayers()) {\n\t\t\tlayer.allowRepaint(true);\n\t\t}\n\t}\n\n\tfireMouseMoved(event: AbstractDisplacementStateEvent) {\n\t\tif (this.config.allowDrag) {\n\t\t\tthis.engine\n\t\t\t\t.getModel()\n\t\t\t\t.setOffset(this.initialCanvasX + event.displacementX, this.initialCanvasY + event.displacementY);\n\t\t\tthis.engine.repaintCanvas();\n\t\t}\n\t}\n}\n","import { AbstractDisplacementState, AbstractDisplacementStateEvent } from '../core-state/AbstractDisplacementState';\nimport { State } from '../core-state/State';\nimport { SelectionLayerModel } from '../entities/selection/SelectionLayerModel';\nimport { Point, Rectangle } from '@projectstorm/geometry';\nimport { BasePositionModel } from '../core-models/BasePositionModel';\nimport { ModelGeometryInterface } from '../core/ModelGeometryInterface';\nimport { CanvasEngine } from '../CanvasEngine';\n\nexport interface SimpleClientRect {\n\tleft: number;\n\tright: number;\n\twidth: number;\n\theight: number;\n\ttop: number;\n\tbottom: number;\n}\n\nexport class SelectionBoxState<E extends CanvasEngine = CanvasEngine> extends AbstractDisplacementState<E> {\n\tlayer: SelectionLayerModel;\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'selection-box'\n\t\t});\n\t}\n\n\tactivated(previous: State) {\n\t\tsuper.activated(previous);\n\t\tthis.layer = new SelectionLayerModel();\n\t\tthis.engine.getModel().addLayer(this.layer);\n\t}\n\n\tdeactivated(next: State) {\n\t\tsuper.deactivated(next);\n\t\tthis.layer.remove();\n\t\tthis.engine.repaintCanvas();\n\t}\n\n\tgetBoxDimensions(event: AbstractDisplacementStateEvent): SimpleClientRect {\n\t\tlet rel: Point;\n\n\t\tif ('touches' in event.event) {\n\t\t\tconst touch = event.event.touches[0];\n\t\t\trel = this.engine.getRelativePoint(touch.clientX, touch.clientY);\n\t\t} else {\n\t\t\trel = this.engine.getRelativePoint(event.event.clientX, event.event.clientY);\n\t\t}\n\n\t\treturn {\n\t\t\tleft: rel.x > this.initialXRelative ? this.initialXRelative : rel.x,\n\t\t\ttop: rel.y > this.initialYRelative ? this.initialYRelative : rel.y,\n\t\t\twidth: Math.abs(rel.x - this.initialXRelative),\n\t\t\theight: Math.abs(rel.y - this.initialYRelative),\n\t\t\tright: rel.x < this.initialXRelative ? this.initialXRelative : rel.x,\n\t\t\tbottom: rel.y < this.initialYRelative ? this.initialYRelative : rel.y\n\t\t};\n\t}\n\n\tfireMouseMoved(event: AbstractDisplacementStateEvent) {\n\t\tthis.layer.setBox(this.getBoxDimensions(event));\n\n\t\tconst relative = this.engine.getRelativeMousePoint({\n\t\t\tclientX: this.initialX,\n\t\t\tclientY: this.initialY\n\t\t});\n\t\tif (event.virtualDisplacementX < 0) {\n\t\t\trelative.x -= Math.abs(event.virtualDisplacementX);\n\t\t}\n\t\tif (event.virtualDisplacementY < 0) {\n\t\t\trelative.y -= Math.abs(event.virtualDisplacementY);\n\t\t}\n\t\tconst rect = Rectangle.fromPointAndSize(\n\t\t\trelative,\n\t\t\tMath.abs(event.virtualDisplacementX),\n\t\t\tMath.abs(event.virtualDisplacementY)\n\t\t);\n\n\t\tfor (let model of this.engine.getModel().getSelectionEntities()) {\n\t\t\tif ((model as unknown as ModelGeometryInterface).getBoundingBox) {\n\t\t\t\tconst bounds = (model as unknown as ModelGeometryInterface).getBoundingBox();\n\t\t\t\tif (rect.containsPoint(bounds.getTopLeft()) && rect.containsPoint(bounds.getBottomRight())) {\n\t\t\t\t\tmodel.setSelected(true);\n\t\t\t\t} else {\n\t\t\t\t\tmodel.setSelected(false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.engine.repaintCanvas();\n\t}\n}\n","import { State } from '../core-state/State';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\nimport { SelectionBoxState } from './SelectionBoxState';\nimport { MouseEvent } from 'react';\nimport { CanvasEngine } from '../CanvasEngine';\n\nexport class SelectingState<E extends CanvasEngine = CanvasEngine> extends State<E> {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'selecting'\n\t\t});\n\t\tthis.keys = ['shift'];\n\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_DOWN,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent>) => {\n\t\t\t\t\tconst element = this.engine.getActionEventBus().getModelForEvent(event);\n\n\t\t\t\t\t// go into a selection box on the canvas state\n\t\t\t\t\tif (!element) {\n\t\t\t\t\t\tthis.transitionWithEvent(new SelectionBoxState(), event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.setSelected(true);\n\t\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","import { AbstractDisplacementState, AbstractDisplacementStateEvent } from '../core-state/AbstractDisplacementState';\nimport { State } from '../core-state/State';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\nimport { BasePositionModel } from '../core-models/BasePositionModel';\nimport { Point } from '@projectstorm/geometry';\nimport { CanvasEngine } from '../CanvasEngine';\n\nexport class MoveItemsState<E extends CanvasEngine = CanvasEngine> extends AbstractDisplacementState<E> {\n\tinitialPositions: {\n\t\t[id: string]: {\n\t\t\tpoint: Point;\n\t\t\titem: BasePositionModel;\n\t\t};\n\t};\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'move-items'\n\t\t});\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_DOWN,\n\t\t\t\tfire: (event: ActionEvent<React.MouseEvent>) => {\n\t\t\t\t\tconst element = this.engine.getActionEventBus().getModelForEvent(event);\n\t\t\t\t\tif (!element) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (!element.isSelected()) {\n\t\t\t\t\t\tthis.engine.getModel().clearSelection();\n\t\t\t\t\t}\n\t\t\t\t\telement.setSelected(true);\n\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\n\tactivated(previous: State) {\n\t\tsuper.activated(previous);\n\t\tthis.initialPositions = {};\n\t}\n\n\tfireMouseMoved(event: AbstractDisplacementStateEvent) {\n\t\tconst items = this.engine.getModel().getSelectedEntities();\n\t\tconst model = this.engine.getModel();\n\t\tfor (let item of items) {\n\t\t\tif (item instanceof BasePositionModel) {\n\t\t\t\tif (item.isLocked()) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (!this.initialPositions[item.getID()]) {\n\t\t\t\t\tthis.initialPositions[item.getID()] = {\n\t\t\t\t\t\tpoint: item.getPosition(),\n\t\t\t\t\t\titem: item\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tconst pos = this.initialPositions[item.getID()].point;\n\t\t\t\titem.setPosition(\n\t\t\t\t\tmodel.getGridPosition(pos.x + event.virtualDisplacementX),\n\t\t\t\t\tmodel.getGridPosition(pos.y + event.virtualDisplacementY)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tthis.engine.repaintCanvas();\n\t}\n}\n","import { State } from '../core-state/State';\nimport { Action, ActionEvent, InputType } from '../core-actions/Action';\nimport { MouseEvent, TouchEvent } from 'react';\nimport { DragCanvasState } from './DragCanvasState';\nimport { SelectingState } from './SelectingState';\nimport { MoveItemsState } from './MoveItemsState';\n\nexport class DefaultState extends State {\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'default'\n\t\t});\n\t\tthis.childStates = [new SelectingState()];\n\n\t\t// determine what was clicked on\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_DOWN,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent>) => {\n\t\t\t\t\tconst element = this.engine.getActionEventBus().getModelForEvent(event);\n\n\t\t\t\t\t// the canvas was clicked on, transition to the dragging canvas state\n\t\t\t\t\tif (!element) {\n\t\t\t\t\t\tthis.transitionWithEvent(new DragCanvasState(), event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.transitionWithEvent(new MoveItemsState(), event);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\t// touch drags the canvas\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.TOUCH_START,\n\t\t\t\tfire: (event: ActionEvent<TouchEvent>) => {\n\t\t\t\t\tthis.transitionWithEvent(new DragCanvasState(), event);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","require","Toolkit","UID","TESTING","TESTING_UID","replace","c","r","Math","random","toString","closest","element","selector","Element","s","el","this","matches","parentElement","parentNode","nodeType","BaseObserver","constructor","listeners","fireEventInternal","fire","k","event","iterateListeners","listener","firing","fireEvent","stopPropagation","function","cb","id","getListenerHandle","deregister","registerListener","deregisterListener","handle","FactoryBank","super","factories","getFactories","clearFactories","deregisterFactory","getFactory","type","Error","registerFactory","setFactoryBank","getType","InputType","Action","options","setEngine","engine","ActionEventBus","actions","keys","getKeys","registerAction","action","deregisterAction","getActionsForType","getModelForEvent","actionEvent","model","getMouseElement","getActionsForEvent","MOUSE_DOWN","MOUSE_UP","toLowerCase","KEY_DOWN","KEY_UP","MOUSE_MOVE","MOUSE_WHEEL","TOUCH_START","TOUCH_END","TOUCH_MOVE","fireAction","PanAndZoomCanvasAction","layer","getModel","getLayers","allowRepaint","ctrlKey","oldZoomFactor","getZoomLevel","scrollDelta","inverseZoom","deltaY","setZoomLevel","zoomFactor","boundingRect","currentTarget","getBoundingClientRect","clientWidth","width","clientHeight","height","widthDiff","heightDiff","clientX","left","clientY","top","xFactor","getOffsetX","yFactor","getOffsetY","setOffset","yDelta","xDelta","deltaX","repaintCanvas","ZoomCanvasAction","DeleteItemsAction","keyCodes","modifiers","shiftKey","altKey","metaKey","keyCode","indexOf","getSelectedEntities","isLocked","remove","StateMachine","stateStack","getCurrentState","currentState","pushState","state","push","setState","popState","pop","deactivated","old","activated","newState","CanvasEngine","eventBus","stateMachine","layerFactories","registerFactoryBank","registerDefaultDeleteItemsAction","registerDefaultZoomCanvasAction","repaintDebounceMs","registerDefaultPanAndZoomCanvasAction","getStateMachine","getRelativeMousePoint","point","getRelativePoint","Point","x","y","canvasRect","canvas","factoryAdded","setDiagramEngine","factoryRemoved","getActionEventBus","getLayerFactories","getFactoryForLayer","setModel","requestAnimationFrame","promise","repaint","repaintFn","Promise","resolve","l","rendered","setCanvas","getCanvas","zoomToFit","scrollWidth","scrollHeight","BaseEntity","getOptions","getID","doClone","lookupTable","clone","clearListeners","deserialize","data","locked","serialize","entity","setLocked","CanvasModel","zoom","gridSize","offsetX","offsetY","layers","getSelectionEntities","ob","isSelected","clearSelection","setSelected","getModels","addLayer","setParent","entityRemoved","removeLayer","index","splice","setGridSize","size","getGridPosition","pos","floor","deserializeModel","models","promises","resolvers","registerModel","layerOb","generateModel","initialConfig","setOffsetX","setOffsetY","AbstractFactory","bank","AbstractModelFactory","AbstractReactFactory","BaseModel","performanceTune","getParentCanvasModel","parent","getParent","selected","extras","BasePositionModel","position","setPosition","getBoundingBox","Rectangle","fromPointAndSize","getPosition","getX","getY","S","shared","css","DivLayer","SvgLayer","TransformLayerWidget","props","getTransform","getTransformStyle","transformed","transform","render","isSvg","style","children","SmartLayerWidget","shouldComponentUpdate","isRepaintEnabled","generateReactWidget","Canvas","CanvasWidget","ref","diagramEngineListener","componentWillUnmount","canvasListener","document","removeEventListener","keyUp","keyDown","registerCanvas","current","list","componentDidUpdate","componentDidMount","forceUpdate","addEventListener","className","onWheel","onMouseDown","onMouseUp","onMouseMove","onTouchStart","onTouchEnd","onTouchMove","map","LayerModel","repaintEnabled","modelOb","getChildModelFactoryBank","addModel","allow","removeModel","_id","SelectionLayerModel","setBox","rect","box","Container","SelectionBoxWidget","SelectionBoxLayerFactory","PeformanceWidget","nextProps","nextState","nextContext","serialized","State","childStates","eject","transitionWithEvent","tryActivateParentState","length","isKeysFullfilled","tryActivateChildState","findStateToActivate","child","previous","handler1","handler2","next","AbstractDisplacementState","handleMoveStart","buttons","handleMove","handleMoveEnd","touches","initialX","initialY","rel","initialXRelative","initialYRelative","fireMouseMoved","displacementX","displacementY","virtualDisplacementX","virtualDisplacementY","DragCanvasState","name","config","allowDrag","prev","initialCanvasX","initialCanvasY","SelectionBoxState","getBoxDimensions","touch","abs","right","bottom","relative","bounds","containsPoint","getTopLeft","getBottomRight","SelectingState","MoveItemsState","initialPositions","items","item","DefaultState"],"sourceRoot":""}