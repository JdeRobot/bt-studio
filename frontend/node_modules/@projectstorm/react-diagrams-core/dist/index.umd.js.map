{"version":3,"file":"index.umd.js","mappings":"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","sources":["webpack://projectstorm/react-canvas-core/webpack/universalModuleDefinition","webpack://projectstorm/react-canvas-core/webpack/bootstrap","webpack://projectstorm/react-canvas-core/webpack/runtime/compat get default export","webpack://projectstorm/react-canvas-core/webpack/runtime/define property getters","webpack://projectstorm/react-canvas-core/webpack/runtime/hasOwnProperty shorthand","webpack://projectstorm/react-canvas-core/webpack/runtime/make namespace object","webpack://projectstorm/react-canvas-core/external commonjs \"lodash\"","webpack://projectstorm/react-canvas-core/external commonjs \"@projectstorm/react-canvas-core\"","webpack://projectstorm/react-canvas-core/./src/entities/link/PointModel.ts","webpack://projectstorm/react-canvas-core/external commonjs \"@projectstorm/geometry\"","webpack://projectstorm/react-canvas-core/./src/entities/link/LinkModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/node/NodeModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/node-layer/NodeLayerModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/link-layer/LinkLayerModel.ts","webpack://projectstorm/react-canvas-core/./src/models/DiagramModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/label/LabelModel.ts","webpack://projectstorm/react-canvas-core/external commonjs \"react\"","webpack://projectstorm/react-canvas-core/external commonjs \"@emotion/styled\"","webpack://projectstorm/react-canvas-core/./src/entities/label/LabelWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/link-layer/LinkLayerWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/link/LinkWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/link-layer/LinkLayerFactory.tsx","webpack://projectstorm/react-canvas-core/external commonjs \"resize-observer-polyfill\"","webpack://projectstorm/react-canvas-core/./src/entities/node/NodeWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/port/PortModel.ts","webpack://projectstorm/react-canvas-core/./src/entities/node-layer/NodeLayerWidget.tsx","webpack://projectstorm/react-canvas-core/./src/entities/node-layer/NodeLayerFactory.tsx","webpack://projectstorm/react-canvas-core/./src/entities/port/PortWidget.tsx","webpack://projectstorm/react-canvas-core/./src/states/DragNewLinkState.ts","webpack://projectstorm/react-canvas-core/./src/states/DragDiagramItemsState.ts","webpack://projectstorm/react-canvas-core/./src/states/DefaultDiagramState.ts","webpack://projectstorm/react-canvas-core/./src/DiagramEngine.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"projectstorm/react-canvas-core\"] = factory();\n\telse\n\t\troot[\"projectstorm/react-canvas-core\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"lodash\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@projectstorm/react-canvas-core\");","import { LinkModel } from './LinkModel';\nimport {\n\tBaseModelListener,\n\tBasePositionModel,\n\tBasePositionModelGenerics,\n\tBasePositionModelOptions\n} from '@projectstorm/react-canvas-core';\n\nexport interface PointModelOptions extends Omit<BasePositionModelOptions, 'type'> {\n\tlink: LinkModel;\n}\n\nexport interface PointModelGenerics {\n\tPARENT: LinkModel;\n\tOPTIONS: PointModelOptions;\n\tLISTENER: BaseModelListener;\n}\n\nexport class PointModel<G extends PointModelGenerics = PointModelGenerics> extends BasePositionModel<\n\tG & BasePositionModelGenerics\n> {\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\ttype: 'point'\n\t\t});\n\t\tthis.parent = options.link;\n\t}\n\n\tisConnectedToPort(): boolean {\n\t\treturn this.parent.getPortForPoint(this) !== null;\n\t}\n\n\tgetLink(): LinkModel {\n\t\treturn this.getParent();\n\t}\n\n\tremove() {\n\t\t//clear references\n\t\tif (this.parent) {\n\t\t\tthis.parent.removePoint(this);\n\t\t}\n\t\tsuper.remove();\n\t}\n\n\tisLocked() {\n\t\treturn super.isLocked() || this.getParent().isLocked();\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@projectstorm/geometry\");","import { PortModel } from '../port/PortModel';\nimport { PointModel } from './PointModel';\nimport * as _ from 'lodash';\nimport { LabelModel } from '../label/LabelModel';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { DiagramModel } from '../../models/DiagramModel';\nimport { boundingBoxFromPoints, Point, Rectangle } from '@projectstorm/geometry';\nimport {\n\tBaseEntityEvent,\n\tBaseModel,\n\tBaseModelGenerics,\n\tBaseModelListener,\n\tDeserializeEvent,\n\tModelGeometryInterface\n} from '@projectstorm/react-canvas-core';\n\nexport interface LinkModelListener extends BaseModelListener {\n\tsourcePortChanged?(event: BaseEntityEvent<LinkModel> & { port: null | PortModel }): void;\n\n\ttargetPortChanged?(event: BaseEntityEvent<LinkModel> & { port: null | PortModel }): void;\n}\n\nexport interface LinkModelGenerics extends BaseModelGenerics {\n\tLISTENER: LinkModelListener;\n\tPARENT: DiagramModel;\n}\n\nexport class LinkModel<G extends LinkModelGenerics = LinkModelGenerics>\n\textends BaseModel<G>\n\timplements ModelGeometryInterface\n{\n\tprotected sourcePort: PortModel | null;\n\tprotected targetPort: PortModel | null;\n\n\tprotected labels: LabelModel[];\n\tprotected points: PointModel[];\n\n\tprotected renderedPaths: SVGPathElement[];\n\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper(options);\n\t\tthis.points = [\n\t\t\tnew PointModel({\n\t\t\t\tlink: this\n\t\t\t}),\n\t\t\tnew PointModel({\n\t\t\t\tlink: this\n\t\t\t})\n\t\t];\n\t\tthis.sourcePort = null;\n\t\tthis.targetPort = null;\n\t\tthis.renderedPaths = [];\n\t\tthis.labels = [];\n\t}\n\n\tgetBoundingBox(): Rectangle {\n\t\treturn new Rectangle(\n\t\t\tboundingBoxFromPoints(\n\t\t\t\t_.map(this.points, (point: PointModel) => {\n\t\t\t\t\treturn point.getPosition();\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t}\n\n\tgetSelectionEntities(): Array<BaseModel> {\n\t\tif (this.getTargetPort() && this.getSourcePort()) {\n\t\t\treturn super.getSelectionEntities().concat(_.slice(this.points, 1, this.points.length - 1));\n\t\t}\n\t\t// allow selection of the first point\n\t\tif (!this.getSourcePort()) {\n\t\t\treturn super.getSelectionEntities().concat(_.slice(this.points, 0, this.points.length - 1));\n\t\t}\n\t\t// allow selection of the last point\n\t\tif (!this.getTargetPort()) {\n\t\t\treturn super.getSelectionEntities().concat(_.slice(this.points, 1, this.points.length));\n\t\t}\n\t\treturn super.getSelectionEntities().concat(this.points);\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.points = _.map(event.data.points || [], (point) => {\n\t\t\tvar p = new PointModel({\n\t\t\t\tlink: this,\n\t\t\t\tposition: new Point(point.x, point.y)\n\t\t\t});\n\t\t\tp.deserialize({\n\t\t\t\t...event,\n\t\t\t\tdata: point\n\t\t\t});\n\t\t\treturn p;\n\t\t});\n\n\t\t//deserialize labels\n\t\t_.forEach(event.data.labels || [], (label: any) => {\n\t\t\tlet labelOb = (event.engine as DiagramEngine).getFactoryForLabel(label.type).generateModel({});\n\t\t\tlabelOb.deserialize({\n\t\t\t\t...event,\n\t\t\t\tdata: label\n\t\t\t});\n\t\t\tthis.addLabel(labelOb);\n\t\t});\n\n\t\t// these happen async, so we use the promises for these (they need to be done like this without the async keyword\n\t\t// because we need the deserailize method to finish for other methods while this happen\n\t\tif (event.data.target) {\n\t\t\tevent.getModel(event.data.targetPort).then((model: PortModel) => {\n\t\t\t\tthis.setTargetPort(model);\n\t\t\t});\n\t\t}\n\t\tif (event.data.source) {\n\t\t\tevent.getModel(event.data.sourcePort).then((model: PortModel) => {\n\t\t\t\tthis.setSourcePort(model);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetRenderedPath(): SVGPathElement[] {\n\t\treturn this.renderedPaths;\n\t}\n\n\tsetRenderedPaths(paths: SVGPathElement[]) {\n\t\tthis.renderedPaths = paths;\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\tsource: this.sourcePort ? this.sourcePort.getParent().getID() : null,\n\t\t\tsourcePort: this.sourcePort ? this.sourcePort.getID() : null,\n\t\t\ttarget: this.targetPort ? this.targetPort.getParent().getID() : null,\n\t\t\ttargetPort: this.targetPort ? this.targetPort.getID() : null,\n\t\t\tpoints: _.map(this.points, (point) => {\n\t\t\t\treturn point.serialize();\n\t\t\t}),\n\t\t\tlabels: _.map(this.labels, (label) => {\n\t\t\t\treturn label.serialize();\n\t\t\t})\n\t\t};\n\t}\n\n\tdoClone(lookupTable = {}, clone) {\n\t\tclone.setPoints(\n\t\t\t_.map(this.getPoints(), (point: PointModel) => {\n\t\t\t\treturn point.clone(lookupTable);\n\t\t\t})\n\t\t);\n\t\tif (this.sourcePort) {\n\t\t\tclone.setSourcePort(this.sourcePort.clone(lookupTable));\n\t\t}\n\t\tif (this.targetPort) {\n\t\t\tclone.setTargetPort(this.targetPort.clone(lookupTable));\n\t\t}\n\t}\n\n\tclearPort(port: PortModel) {\n\t\tif (this.sourcePort === port) {\n\t\t\tthis.setSourcePort(null);\n\t\t} else if (this.targetPort === port) {\n\t\t\tthis.setTargetPort(null);\n\t\t}\n\t}\n\n\tremove() {\n\t\tif (this.sourcePort) {\n\t\t\tthis.sourcePort.removeLink(this);\n\t\t\tdelete this.sourcePort;\n\t\t}\n\t\tif (this.targetPort) {\n\t\t\tthis.targetPort.removeLink(this);\n\t\t\tdelete this.targetPort;\n\t\t}\n\t\tsuper.remove();\n\t}\n\n\tisLastPoint(point: PointModel) {\n\t\tvar index = this.getPointIndex(point);\n\t\treturn index === this.points.length - 1;\n\t}\n\n\tgetPointIndex(point: PointModel) {\n\t\treturn this.points.indexOf(point);\n\t}\n\n\tgetPointModel(id: string): PointModel | null {\n\t\tfor (var i = 0; i < this.points.length; i++) {\n\t\t\tif (this.points[i].getID() === id) {\n\t\t\t\treturn this.points[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetPortForPoint(point: PointModel): PortModel {\n\t\tif (this.sourcePort !== null && this.getFirstPoint().getID() === point.getID()) {\n\t\t\treturn this.sourcePort;\n\t\t}\n\t\tif (this.targetPort !== null && this.getLastPoint().getID() === point.getID()) {\n\t\t\treturn this.targetPort;\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetPointForPort(port: PortModel): PointModel {\n\t\tif (this.sourcePort !== null && this.sourcePort.getID() === port.getID()) {\n\t\t\treturn this.getFirstPoint();\n\t\t}\n\t\tif (this.targetPort !== null && this.targetPort.getID() === port.getID()) {\n\t\t\treturn this.getLastPoint();\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetFirstPoint(): PointModel {\n\t\treturn this.points[0];\n\t}\n\n\tgetLastPoint(): PointModel {\n\t\treturn this.points[this.points.length - 1];\n\t}\n\n\tsetSourcePort(port: PortModel | null) {\n\t\tif (port !== null) {\n\t\t\tport.addLink(this);\n\t\t}\n\t\tif (this.sourcePort !== null) {\n\t\t\tthis.sourcePort.removeLink(this);\n\t\t}\n\t\tthis.sourcePort = port;\n\t\tthis.fireEvent({ port }, 'sourcePortChanged');\n\t\tif (port?.reportedPosition) {\n\t\t\tthis.getPointForPort(port).setPosition(port.getCenter());\n\t\t}\n\t}\n\n\tgetSourcePort(): PortModel {\n\t\treturn this.sourcePort;\n\t}\n\n\tgetTargetPort(): PortModel {\n\t\treturn this.targetPort;\n\t}\n\n\tsetTargetPort(port: PortModel | null) {\n\t\tif (port !== null) {\n\t\t\tport.addLink(this);\n\t\t}\n\t\tif (this.targetPort !== null) {\n\t\t\tthis.targetPort.removeLink(this);\n\t\t}\n\t\tthis.targetPort = port;\n\t\tthis.fireEvent({ port }, 'targetPortChanged');\n\t\tif (port?.reportedPosition) {\n\t\t\tthis.getPointForPort(port).setPosition(port.getCenter());\n\t\t}\n\t}\n\n\tpoint(x: number, y: number, index: number = 1): PointModel {\n\t\treturn this.addPoint(this.generatePoint(x, y), index);\n\t}\n\n\taddLabel(label: LabelModel) {\n\t\tlabel.setParent(this);\n\t\tthis.labels.push(label);\n\t}\n\n\tgetPoints(): PointModel[] {\n\t\treturn this.points;\n\t}\n\n\tgetLabels() {\n\t\treturn this.labels;\n\t}\n\n\tsetPoints(points: PointModel[]) {\n\t\t_.forEach(points, (point) => {\n\t\t\tpoint.setParent(this);\n\t\t});\n\t\tthis.points = points;\n\t}\n\n\tremovePoint(pointModel: PointModel) {\n\t\tif (this.isLastPoint(pointModel)) this.remove();\n\t\tthis.points.splice(this.getPointIndex(pointModel), 1);\n\t}\n\n\tremovePointsBefore(pointModel: PointModel) {\n\t\tthis.points.splice(0, this.getPointIndex(pointModel));\n\t}\n\n\tremovePointsAfter(pointModel: PointModel) {\n\t\tthis.points.splice(this.getPointIndex(pointModel) + 1);\n\t}\n\n\tremoveMiddlePoints() {\n\t\tif (this.points.length > 2) {\n\t\t\tthis.points.splice(1, this.points.length - 2);\n\t\t}\n\t}\n\n\taddPoint<P extends PointModel>(pointModel: P, index = 1): P {\n\t\tpointModel.setParent(this);\n\t\tthis.points.splice(index, 0, pointModel);\n\t\treturn pointModel;\n\t}\n\n\tgeneratePoint(x: number = 0, y: number = 0): PointModel {\n\t\treturn new PointModel({\n\t\t\tlink: this,\n\t\t\tposition: new Point(x, y)\n\t\t});\n\t}\n}\n","import * as _ from 'lodash';\nimport { DiagramModel } from '../../models/DiagramModel';\nimport { PortModel } from '../port/PortModel';\nimport { LinkModel } from '../link/LinkModel';\nimport { Point, Rectangle } from '@projectstorm/geometry';\nimport {\n\tBaseEntityEvent,\n\tBaseModelListener,\n\tBasePositionModel,\n\tBasePositionModelGenerics,\n\tDeserializeEvent\n} from '@projectstorm/react-canvas-core';\nimport { DiagramEngine } from '../../DiagramEngine';\n\nexport interface NodeModelListener extends BaseModelListener {\n\tpositionChanged?(event: BaseEntityEvent<NodeModel>): void;\n}\n\nexport interface NodeModelGenerics extends BasePositionModelGenerics {\n\tLISTENER: NodeModelListener;\n\tPARENT: DiagramModel;\n}\n\nexport class NodeModel<G extends NodeModelGenerics = NodeModelGenerics> extends BasePositionModel<G> {\n\tprotected ports: { [s: string]: PortModel };\n\n\t// calculated post rendering so routing can be done correctly\n\twidth: number;\n\theight: number;\n\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper(options);\n\t\tthis.ports = {};\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t}\n\n\tgetBoundingBox(): Rectangle {\n\t\treturn Rectangle.fromPointAndSize(this.getPosition(), this.width, this.height);\n\t}\n\n\tsetPosition(point: Point): void;\n\tsetPosition(x: number, y: number): void;\n\tsetPosition(x: number | Point, y?: number): void {\n\t\tconst old = this.position;\n\n\t\tif (x instanceof Point) {\n\t\t\tsuper.setPosition(x);\n\t\t} else {\n\t\t\tsuper.setPosition(x, y);\n\t\t}\n\n\t\t//also update the port co-ordinates (for make glorious speed)\n\t\t_.forEach(this.ports, (port) => {\n\t\t\tport.setPosition(port.getX() + this.position.x - old.x, port.getY() + this.position.y - old.y);\n\t\t});\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\n\t\t//deserialize ports\n\t\t_.forEach(event.data.ports, (port: any) => {\n\t\t\tlet portOb = (event.engine as DiagramEngine).getFactoryForPort(port.type).generateModel({});\n\t\t\tportOb.deserialize({\n\t\t\t\t...event,\n\t\t\t\tdata: port\n\t\t\t});\n\t\t\t// the links need these\n\t\t\tevent.registerModel(portOb);\n\t\t\tthis.addPort(portOb);\n\t\t});\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\tports: _.map(this.ports, (port) => {\n\t\t\t\treturn port.serialize();\n\t\t\t})\n\t\t};\n\t}\n\n\tdoClone(lookupTable = {}, clone) {\n\t\t// also clone the ports\n\t\tclone.ports = {};\n\t\t_.forEach(this.ports, (port) => {\n\t\t\tclone.addPort(port.clone(lookupTable));\n\t\t});\n\t}\n\n\tremove() {\n\t\tsuper.remove();\n\t\t_.forEach(this.ports, (port) => {\n\t\t\t_.forEach(port.getLinks(), (link) => {\n\t\t\t\tlink.remove();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPortFromID(id): PortModel | null {\n\t\tfor (var i in this.ports) {\n\t\t\tif (this.ports[i].getID() === id) {\n\t\t\t\treturn this.ports[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetLink(id: string): LinkModel {\n\t\tfor (let portID in this.ports) {\n\t\t\tconst links = this.ports[portID].getLinks();\n\t\t\tif (links[id]) {\n\t\t\t\treturn links[id];\n\t\t\t}\n\t\t}\n\t}\n\n\tgetPort(name: string): PortModel | null {\n\t\treturn this.ports[name];\n\t}\n\n\tgetPorts(): { [s: string]: PortModel } {\n\t\treturn this.ports;\n\t}\n\n\tremovePort(port: PortModel) {\n\t\t// clear the port from the links\n\t\tfor (let link of _.values(port.getLinks())) {\n\t\t\tlink.clearPort(port);\n\t\t}\n\t\t//clear the parent node reference\n\t\tif (this.ports[port.getName()]) {\n\t\t\tthis.ports[port.getName()].setParent(null);\n\t\t\tdelete this.ports[port.getName()];\n\t\t}\n\t}\n\n\taddPort(port: PortModel): PortModel {\n\t\tport.setParent(this);\n\t\tthis.ports[port.getName()] = port;\n\t\treturn port;\n\t}\n\n\tupdateDimensions({ width, height }: { width: number; height: number }) {\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t}\n}\n","import { LayerModel, LayerModelGenerics } from '@projectstorm/react-canvas-core';\nimport { NodeModel } from '../node/NodeModel';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { DiagramModel } from '../../models/DiagramModel';\n\nexport interface NodeLayerModelGenerics extends LayerModelGenerics {\n\tCHILDREN: NodeModel;\n\tENGINE: DiagramEngine;\n}\n\nexport class NodeLayerModel<G extends NodeLayerModelGenerics = NodeLayerModelGenerics> extends LayerModel<G> {\n\tconstructor() {\n\t\tsuper({\n\t\t\ttype: 'diagram-nodes',\n\t\t\tisSvg: false,\n\t\t\ttransformed: true\n\t\t});\n\t}\n\n\taddModel(model: G['CHILDREN']): void {\n\t\tif (!(model instanceof NodeModel)) {\n\t\t\tthrow new Error('Can only add nodes to this layer');\n\t\t}\n\t\tmodel.registerListener({\n\t\t\tentityRemoved: () => {\n\t\t\t\t(this.getParent() as DiagramModel).removeNode(model);\n\t\t\t}\n\t\t});\n\t\tsuper.addModel(model);\n\t}\n\n\tgetChildModelFactoryBank(engine: G['ENGINE']) {\n\t\treturn engine.getNodeFactories();\n\t}\n\n\tgetNodes() {\n\t\treturn this.getModels();\n\t}\n}\n","import { LayerModel, LayerModelGenerics } from '@projectstorm/react-canvas-core';\nimport { LinkModel } from '../link/LinkModel';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { DiagramModel } from '../../models/DiagramModel';\n\nexport interface LinkLayerModelGenerics extends LayerModelGenerics {\n\tCHILDREN: LinkModel;\n\tENGINE: DiagramEngine;\n}\n\nexport class LinkLayerModel<G extends LinkLayerModelGenerics = LinkLayerModelGenerics> extends LayerModel<G> {\n\tconstructor() {\n\t\tsuper({\n\t\t\ttype: 'diagram-links',\n\t\t\tisSvg: true,\n\t\t\ttransformed: true\n\t\t});\n\t}\n\n\taddModel(model: G['CHILDREN']): void {\n\t\tif (!(model instanceof LinkModel)) {\n\t\t\tthrow new Error('Can only add links to this layer');\n\t\t}\n\t\tmodel.registerListener({\n\t\t\tentityRemoved: () => {\n\t\t\t\t(this.getParent() as DiagramModel).removeLink(model);\n\t\t\t}\n\t\t});\n\t\tsuper.addModel(model);\n\t}\n\n\tgetLinks() {\n\t\treturn this.getModels();\n\t}\n\n\tgetChildModelFactoryBank(engine: G['ENGINE']) {\n\t\treturn engine.getLinkFactories();\n\t}\n}\n","import * as _ from 'lodash';\nimport { LinkModel } from '../entities/link/LinkModel';\nimport { NodeModel } from '../entities/node/NodeModel';\nimport {\n\tBaseEntityEvent,\n\tBaseEntityListener,\n\tBaseModel,\n\tCanvasModel,\n\tCanvasModelGenerics,\n\tLayerModel,\n\tDeserializeEvent\n} from '@projectstorm/react-canvas-core';\nimport { NodeLayerModel } from '../entities/node-layer/NodeLayerModel';\nimport { LinkLayerModel } from '../entities/link-layer/LinkLayerModel';\n\nexport interface DiagramListener extends BaseEntityListener {\n\tnodesUpdated?(event: BaseEntityEvent & { node: NodeModel; isCreated: boolean }): void;\n\n\tlinksUpdated?(event: BaseEntityEvent & { link: LinkModel; isCreated: boolean }): void;\n}\n\nexport interface DiagramModelGenerics extends CanvasModelGenerics {\n\tLISTENER: DiagramListener;\n}\n\nexport class DiagramModel<G extends DiagramModelGenerics = DiagramModelGenerics> extends CanvasModel<G> {\n\tprotected activeNodeLayer: NodeLayerModel;\n\tprotected activeLinkLayer: LinkLayerModel;\n\n\tconstructor(options: G['OPTIONS'] = {}) {\n\t\tsuper(options);\n\t\tthis.addLayer(new LinkLayerModel());\n\t\tthis.addLayer(new NodeLayerModel());\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tthis.layers = [];\n\t\tsuper.deserialize(event);\n\t}\n\n\taddLayer(layer: LayerModel): void {\n\t\tsuper.addLayer(layer);\n\t\tif (layer instanceof NodeLayerModel) {\n\t\t\tthis.activeNodeLayer = layer;\n\t\t}\n\t\tif (layer instanceof LinkLayerModel) {\n\t\t\tthis.activeLinkLayer = layer;\n\t\t}\n\t}\n\n\tgetLinkLayers(): LinkLayerModel[] {\n\t\treturn _.filter(this.layers, (layer) => {\n\t\t\treturn layer instanceof LinkLayerModel;\n\t\t}) as LinkLayerModel[];\n\t}\n\n\tgetNodeLayers(): NodeLayerModel[] {\n\t\treturn _.filter(this.layers, (layer) => {\n\t\t\treturn layer instanceof NodeLayerModel;\n\t\t}) as NodeLayerModel[];\n\t}\n\n\tgetActiveNodeLayer(): NodeLayerModel {\n\t\tif (!this.activeNodeLayer) {\n\t\t\tconst layers = this.getNodeLayers();\n\t\t\tif (layers.length === 0) {\n\t\t\t\tthis.addLayer(new NodeLayerModel());\n\t\t\t} else {\n\t\t\t\tthis.activeNodeLayer = layers[0];\n\t\t\t}\n\t\t}\n\t\treturn this.activeNodeLayer;\n\t}\n\n\tgetActiveLinkLayer(): LinkLayerModel {\n\t\tif (!this.activeLinkLayer) {\n\t\t\tconst layers = this.getLinkLayers();\n\t\t\tif (layers.length === 0) {\n\t\t\t\tthis.addLayer(new LinkLayerModel());\n\t\t\t} else {\n\t\t\t\tthis.activeLinkLayer = layers[0];\n\t\t\t}\n\t\t}\n\t\treturn this.activeLinkLayer;\n\t}\n\n\tgetNode(node: string): NodeModel {\n\t\tfor (const layer of this.getNodeLayers()) {\n\t\t\tconst model = layer.getModel(node);\n\t\t\tif (model) {\n\t\t\t\treturn model;\n\t\t\t}\n\t\t}\n\t}\n\n\tgetLink(link: string): LinkModel {\n\t\tfor (const layer of this.getLinkLayers()) {\n\t\t\tconst model = layer.getModel(link);\n\t\t\tif (model) {\n\t\t\t\treturn model;\n\t\t\t}\n\t\t}\n\t}\n\n\taddAll(...models: BaseModel[]): BaseModel[] {\n\t\t_.forEach(models, (model) => {\n\t\t\tif (model instanceof LinkModel) {\n\t\t\t\tthis.addLink(model);\n\t\t\t} else if (model instanceof NodeModel) {\n\t\t\t\tthis.addNode(model);\n\t\t\t}\n\t\t});\n\t\treturn models;\n\t}\n\n\taddLink(link: LinkModel): LinkModel {\n\t\tthis.getActiveLinkLayer().addModel(link);\n\t\tthis.fireEvent(\n\t\t\t{\n\t\t\t\tlink,\n\t\t\t\tisCreated: true\n\t\t\t},\n\t\t\t'linksUpdated'\n\t\t);\n\t\treturn link;\n\t}\n\n\taddNode(node: NodeModel): NodeModel {\n\t\tthis.getActiveNodeLayer().addModel(node);\n\t\tthis.fireEvent({ node, isCreated: true }, 'nodesUpdated');\n\t\treturn node;\n\t}\n\n\tremoveLink(link: LinkModel) {\n\t\tconst removed = _.some(this.getLinkLayers(), (layer) => {\n\t\t\treturn layer.removeModel(link);\n\t\t});\n\t\tif (removed) {\n\t\t\tthis.fireEvent({ link, isCreated: false }, 'linksUpdated');\n\t\t}\n\t}\n\n\tremoveNode(node: NodeModel) {\n\t\tconst removed = _.some(this.getNodeLayers(), (layer) => {\n\t\t\treturn layer.removeModel(node);\n\t\t});\n\t\tif (removed) {\n\t\t\tthis.fireEvent({ node, isCreated: false }, 'nodesUpdated');\n\t\t}\n\t}\n\n\tgetLinks(): LinkModel[] {\n\t\treturn _.flatMap(this.getLinkLayers(), (layer) => {\n\t\t\treturn _.values(layer.getModels());\n\t\t});\n\t}\n\n\tgetNodes(): NodeModel[] {\n\t\treturn _.flatMap(this.getNodeLayers(), (layer) => {\n\t\t\treturn _.values(layer.getModels());\n\t\t});\n\t}\n}\n","import { LinkModel } from '../link/LinkModel';\nimport { BaseModel, BaseModelGenerics, BaseModelOptions, DeserializeEvent } from '@projectstorm/react-canvas-core';\n\nexport interface LabelModelOptions extends BaseModelOptions {\n\toffsetX?: number;\n\toffsetY?: number;\n}\n\nexport interface LabelModelGenerics extends BaseModelGenerics {\n\tPARENT: LinkModel;\n\tOPTIONS: LabelModelOptions;\n}\n\nexport class LabelModel<G extends LabelModelGenerics = LabelModelGenerics> extends BaseModel<G> {\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper({\n\t\t\t...options,\n\t\t\toffsetX: options.offsetX || 0,\n\t\t\toffsetY: options.offsetY || 0\n\t\t});\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.options.offsetX = event.data.offsetX;\n\t\tthis.options.offsetY = event.data.offsetY;\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\toffsetX: this.options.offsetX,\n\t\t\toffsetY: this.options.offsetY\n\t\t};\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"react\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@emotion/styled\");","import * as React from 'react';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { LabelModel } from './LabelModel';\nimport styled from '@emotion/styled';\n\nexport interface LabelWidgetProps {\n\tengine: DiagramEngine;\n\tlabel: LabelModel;\n\tindex: number;\n}\n\nnamespace S {\n\texport const Label = styled.div`\n\t\tdisplay: inline-block;\n\t\tposition: absolute;\n\t`;\n\n\texport const Foreign = styled.foreignObject`\n\t\tpointer-events: none;\n\t\toverflow: visible;\n\t`;\n}\n\nexport class LabelWidget extends React.Component<LabelWidgetProps> {\n\tref: React.RefObject<HTMLDivElement>;\n\n\tconstructor(props: LabelWidgetProps) {\n\t\tsuper(props);\n\t\tthis.ref = React.createRef();\n\t}\n\n\tcomponentDidUpdate() {\n\t\twindow.requestAnimationFrame(this.calculateLabelPosition);\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.requestAnimationFrame(this.calculateLabelPosition);\n\t}\n\n\tfindPathAndRelativePositionToRenderLabel = (index: number): { path: SVGPathElement; position: number } => {\n\t\t// an array to hold all path lengths, making sure we hit the DOM only once to fetch this information\n\t\tconst link = this.props.label.getParent();\n\t\tconst lengths = link.getRenderedPath().map((path) => path.getTotalLength());\n\n\t\t// calculate the point where we want to display the label\n\t\tlet labelPosition =\n\t\t\tlengths.reduce((previousValue, currentValue) => previousValue + currentValue, 0) *\n\t\t\t(index / (link.getLabels().length + 1));\n\n\t\t// find the path where the label will be rendered and calculate the relative position\n\t\tlet pathIndex = 0;\n\t\twhile (pathIndex < link.getRenderedPath().length) {\n\t\t\tif (labelPosition - lengths[pathIndex] < 0) {\n\t\t\t\treturn {\n\t\t\t\t\tpath: link.getRenderedPath()[pathIndex],\n\t\t\t\t\tposition: labelPosition\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// keep searching\n\t\t\tlabelPosition -= lengths[pathIndex];\n\t\t\tpathIndex++;\n\t\t}\n\t};\n\n\tcalculateLabelPosition = () => {\n\t\tconst found = this.findPathAndRelativePositionToRenderLabel(this.props.index + 1);\n\t\tif (!found) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { path, position } = found;\n\n\t\tconst labelDimensions = {\n\t\t\twidth: this.ref.current.offsetWidth,\n\t\t\theight: this.ref.current.offsetHeight\n\t\t};\n\n\t\tconst pathCentre = path.getPointAtLength(position);\n\n\t\tconst labelCoordinates = {\n\t\t\tx: pathCentre.x - labelDimensions.width / 2 + this.props.label.getOptions().offsetX,\n\t\t\ty: pathCentre.y - labelDimensions.height / 2 + this.props.label.getOptions().offsetY\n\t\t};\n\n\t\tthis.ref.current.style.transform = `translate(${labelCoordinates.x}px, ${labelCoordinates.y}px)`;\n\t};\n\n\trender() {\n\t\tconst canvas = this.props.engine.getCanvas();\n\n\t\treturn (\n\t\t\t<S.Foreign key={this.props.label.getID()} width={canvas?.offsetWidth} height={canvas?.offsetHeight}>\n\t\t\t\t<S.Label ref={this.ref}>\n\t\t\t\t\t{this.props.engine.getFactoryForLabel(this.props.label).generateReactWidget({ model: this.props.label })}\n\t\t\t\t</S.Label>\n\t\t\t</S.Foreign>\n\t\t);\n\t}\n}\n","import * as React from 'react';\nimport styled from '@emotion/styled';\nimport * as _ from 'lodash';\nimport { LinkWidget } from '../link/LinkWidget';\nimport { LinkLayerModel } from './LinkLayerModel';\nimport { DiagramEngine } from '../../DiagramEngine';\n\nexport interface LinkLayerWidgetProps {\n\tlayer: LinkLayerModel;\n\tengine: DiagramEngine;\n}\n\nnamespace S {\n\texport const Container = styled.div``;\n}\n\nexport class LinkLayerWidget extends React.Component<LinkLayerWidgetProps> {\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{\n\t\t\t\t\t//only perform these actions when we have a diagram\n\t\t\t\t\t_.map(this.props.layer.getLinks(), (link) => {\n\t\t\t\t\t\treturn <LinkWidget key={link.getID()} link={link} diagramEngine={this.props.engine} />;\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</>\n\t\t);\n\t}\n}\n","import * as React from 'react';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { LinkModel } from './LinkModel';\nimport { PointModel } from './PointModel';\nimport * as _ from 'lodash';\nimport { LabelWidget } from '../label/LabelWidget';\nimport { BaseEntityEvent, BasePositionModel, ListenerHandle, PeformanceWidget } from '@projectstorm/react-canvas-core';\nimport { PortModel } from '../port/PortModel';\n\nexport interface LinkProps {\n\tlink: LinkModel;\n\tdiagramEngine: DiagramEngine;\n}\n\nexport interface LinkState {\n\tsourcePort: PortModel;\n\ttargetPort: PortModel;\n}\n\nexport class LinkWidget extends React.Component<LinkProps, LinkState> {\n\tsourceListener: ListenerHandle;\n\ttargetListener: ListenerHandle;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tsourcePort: null,\n\t\t\ttargetPort: null\n\t\t};\n\t}\n\n\tcomponentWillUnmount(): void {\n\t\tif (this.sourceListener) {\n\t\t\tthis.sourceListener.deregister();\n\t\t}\n\t\tif (this.targetListener) {\n\t\t\tthis.targetListener.deregister();\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps(nextProps: LinkProps, prevState: LinkState): LinkState {\n\t\treturn {\n\t\t\tsourcePort: nextProps.link.getSourcePort(),\n\t\t\ttargetPort: nextProps.link.getTargetPort()\n\t\t};\n\t}\n\n\tinstallTarget() {\n\t\tthis.targetListener && this.targetListener.deregister();\n\n\t\tif (!this.props.link.getTargetPort()) return;\n\t\tthis.targetListener = this.props.link.getTargetPort().registerListener({\n\t\t\treportInitialPosition: (event: BaseEntityEvent<BasePositionModel>) => {\n\t\t\t\tthis.forceUpdate();\n\t\t\t}\n\t\t});\n\t}\n\n\tinstallSource() {\n\t\tthis.sourceListener && this.sourceListener.deregister();\n\n\t\tif (!this.props.link.getSourcePort()) return;\n\t\tthis.sourceListener = this.props.link.getSourcePort().registerListener({\n\t\t\treportInitialPosition: (event: BaseEntityEvent<BasePositionModel>) => {\n\t\t\t\tthis.forceUpdate();\n\t\t\t}\n\t\t});\n\t}\n\n\tcomponentDidUpdate(prevProps: Readonly<LinkProps>, prevState: Readonly<LinkState>, snapshot) {\n\t\tif (prevState.sourcePort !== this.state.sourcePort) {\n\t\t\tthis.installSource();\n\t\t}\n\t\tif (prevState.targetPort !== this.state.targetPort) {\n\t\t\tthis.installTarget();\n\t\t}\n\t}\n\n\tpublic static generateLinePath(firstPoint: PointModel, lastPoint: PointModel): string {\n\t\treturn `M${firstPoint.getX()},${firstPoint.getY()} L ${lastPoint.getX()},${lastPoint.getY()}`;\n\t}\n\n\tcomponentDidMount(): void {\n\t\tif (this.props.link.getSourcePort()) {\n\t\t\tthis.installSource();\n\t\t}\n\t\tif (this.props.link.getTargetPort()) {\n\t\t\tthis.installTarget();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { link } = this.props;\n\n\t\t// only draw the link when we have reported positions\n\t\tif (link.getSourcePort() && !link.getSourcePort().reportedPosition) {\n\t\t\treturn null;\n\t\t}\n\t\tif (link.getTargetPort() && !link.getTargetPort().reportedPosition) {\n\t\t\treturn null;\n\t\t}\n\n\t\t//generate links\n\t\treturn (\n\t\t\t<PeformanceWidget model={this.props.link} serialized={this.props.link.serialize()}>\n\t\t\t\t{() => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<g data-linkid={this.props.link.getID()}>\n\t\t\t\t\t\t\t{this.props.diagramEngine.generateWidgetForLink(link)}\n\t\t\t\t\t\t\t{_.map(this.props.link.getLabels(), (labelModel, index) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<LabelWidget\n\t\t\t\t\t\t\t\t\t\tkey={labelModel.getID()}\n\t\t\t\t\t\t\t\t\t\tengine={this.props.diagramEngine}\n\t\t\t\t\t\t\t\t\t\tlabel={labelModel}\n\t\t\t\t\t\t\t\t\t\tindex={index}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</g>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t</PeformanceWidget>\n\t\t);\n\t}\n}\n","import * as React from 'react';\nimport { AbstractReactFactory, GenerateModelEvent, GenerateWidgetEvent } from '@projectstorm/react-canvas-core';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { LinkLayerModel } from './LinkLayerModel';\nimport { LinkLayerWidget } from './LinkLayerWidget';\n\nexport class LinkLayerFactory extends AbstractReactFactory<LinkLayerModel, DiagramEngine> {\n\tconstructor() {\n\t\tsuper('diagram-links');\n\t}\n\n\tgenerateModel(event: GenerateModelEvent): LinkLayerModel {\n\t\treturn new LinkLayerModel();\n\t}\n\n\tgenerateReactWidget(event: GenerateWidgetEvent<LinkLayerModel>): JSX.Element {\n\t\treturn <LinkLayerWidget layer={event.model} engine={this.engine} />;\n\t}\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"resize-observer-polyfill\");","import * as React from 'react';\nimport * as _ from 'lodash';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { NodeModel } from './NodeModel';\nimport { BaseEntityEvent, BaseModel, ListenerHandle, PeformanceWidget } from '@projectstorm/react-canvas-core';\nimport styled from '@emotion/styled';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nexport interface NodeProps {\n\tnode: NodeModel;\n\tchildren?: any;\n\tdiagramEngine: DiagramEngine;\n}\n\nnamespace S {\n\texport const Node = styled.div`\n\t\tposition: absolute;\n\t\t-webkit-touch-callout: none; /* iOS Safari */\n\t\t-webkit-user-select: none; /* Chrome/Safari/Opera */\n\t\tuser-select: none;\n\t\tcursor: move;\n\t\tpointer-events: all;\n\t`;\n}\n\nexport class NodeWidget extends React.Component<NodeProps> {\n\tob: any;\n\tref: React.RefObject<HTMLDivElement>;\n\tlistener: ListenerHandle;\n\n\tconstructor(props: NodeProps) {\n\t\tsuper(props);\n\t\tthis.ref = React.createRef();\n\t}\n\n\tcomponentWillUnmount(): void {\n\t\tthis.ob.disconnect();\n\t\tthis.ob = null;\n\n\t\tthis.listener?.deregister();\n\t\tthis.listener = null;\n\t}\n\n\tcomponentDidUpdate(prevProps: Readonly<NodeProps>, prevState: Readonly<any>, snapshot?: any): void {\n\t\tif (this.listener && this.props.node !== prevProps.node) {\n\t\t\tthis.listener.deregister();\n\t\t\tthis.installSelectionListener();\n\t\t}\n\t}\n\n\tinstallSelectionListener() {\n\t\tthis.listener = this.props.node.registerListener({\n\t\t\tselectionChanged: (event: BaseEntityEvent<BaseModel> & { isSelected: boolean }) => {\n\t\t\t\tthis.forceUpdate();\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateSize(width: number, height: number) {\n\t\tthis.props.node.updateDimensions({ width, height });\n\n\t\t//now mark the links as dirty\n\t\ttry {\n\t\t\t_.forEach(this.props.node.getPorts(), (port) => {\n\t\t\t\tport.updateCoords(this.props.diagramEngine.getPortCoords(port));\n\t\t\t});\n\t\t} catch (ex) {}\n\t}\n\n\tcomponentDidMount(): void {\n\t\t// @ts-ignore\n\t\tthis.ob = new ResizeObserver((entities) => {\n\t\t\tconst bounds = entities[0].contentRect;\n\t\t\tthis.updateSize(bounds.width, bounds.height);\n\t\t});\n\n\t\tconst b = this.ref.current.getBoundingClientRect();\n\t\tthis.updateSize(b.width, b.height);\n\t\tthis.ob.observe(this.ref.current);\n\t\tthis.installSelectionListener();\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<PeformanceWidget model={this.props.node} serialized={this.props.node.serialize()}>\n\t\t\t\t{() => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<S.Node\n\t\t\t\t\t\t\tclassName=\"node\"\n\t\t\t\t\t\t\tref={this.ref}\n\t\t\t\t\t\t\tdata-nodeid={this.props.node.getID()}\n\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\ttop: this.props.node.getY(),\n\t\t\t\t\t\t\t\tleft: this.props.node.getX()\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{this.props.diagramEngine.generateWidgetForNode(this.props.node)}\n\t\t\t\t\t\t</S.Node>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t</PeformanceWidget>\n\t\t);\n\t}\n}\n","import { NodeModel } from '../node/NodeModel';\nimport { LinkModel } from '../link/LinkModel';\nimport * as _ from 'lodash';\nimport { Point, Rectangle } from '@projectstorm/geometry';\nimport {\n\tBaseEntityEvent,\n\tBaseModelOptions,\n\tBasePositionModel,\n\tBasePositionModelGenerics,\n\tBasePositionModelListener,\n\tDeserializeEvent\n} from '@projectstorm/react-canvas-core';\n\nexport enum PortModelAlignment {\n\tTOP = 'top',\n\tLEFT = 'left',\n\tBOTTOM = 'bottom',\n\tRIGHT = 'right'\n}\n\nexport interface PortModelListener extends BasePositionModelListener {\n\t/**\n\t * fires when it first receives positional information\n\t */\n\treportInitialPosition?: (event: BaseEntityEvent<PortModel>) => void;\n}\n\nexport interface PortModelOptions extends BaseModelOptions {\n\talignment?: PortModelAlignment;\n\tmaximumLinks?: number;\n\tname: string;\n}\n\nexport interface PortModelGenerics extends BasePositionModelGenerics {\n\tOPTIONS: PortModelOptions;\n\tPARENT: NodeModel;\n\tLISTENER: PortModelListener;\n}\n\nexport class PortModel<G extends PortModelGenerics = PortModelGenerics> extends BasePositionModel<G> {\n\tlinks: { [id: string]: LinkModel };\n\n\t// calculated post rendering so routing can be done correctly\n\twidth: number;\n\theight: number;\n\treportedPosition: boolean;\n\n\tconstructor(options: G['OPTIONS']) {\n\t\tsuper(options);\n\t\tthis.links = {};\n\t\tthis.reportedPosition = false;\n\t}\n\n\tdeserialize(event: DeserializeEvent<this>) {\n\t\tsuper.deserialize(event);\n\t\tthis.reportedPosition = false;\n\t\tthis.options.name = event.data.name;\n\t\tthis.options.alignment = event.data.alignment;\n\t}\n\n\tserialize() {\n\t\treturn {\n\t\t\t...super.serialize(),\n\t\t\tname: this.options.name,\n\t\t\talignment: this.options.alignment,\n\t\t\tparentNode: this.parent.getID(),\n\t\t\tlinks: _.map(this.links, (link) => {\n\t\t\t\treturn link.getID();\n\t\t\t})\n\t\t};\n\t}\n\n\tsetPosition(point: Point);\n\tsetPosition(x: number, y: number);\n\tsetPosition(x, y?) {\n\t\tlet old = this.position;\n\t\tsuper.setPosition(x, y);\n\t\t_.forEach(this.getLinks(), (link) => {\n\t\t\tlet point = link.getPointForPort(this);\n\t\t\tpoint.setPosition(point.getX() + x - old.x, point.getY() + y - old.y);\n\t\t});\n\t}\n\n\tdoClone(lookupTable = {}, clone: PortModel) {\n\t\tclone.links = {};\n\t\tclone.parent = this.getParent().clone(lookupTable);\n\t}\n\n\tgetNode(): NodeModel {\n\t\treturn this.getParent();\n\t}\n\n\tgetName(): string {\n\t\treturn this.options.name;\n\t}\n\n\tgetMaximumLinks(): number {\n\t\treturn this.options.maximumLinks;\n\t}\n\n\tsetMaximumLinks(maximumLinks: number) {\n\t\tthis.options.maximumLinks = maximumLinks;\n\t}\n\n\tremoveLink(link: LinkModel) {\n\t\tdelete this.links[link.getID()];\n\t}\n\n\taddLink(link: LinkModel) {\n\t\tthis.links[link.getID()] = link;\n\t}\n\n\tgetLinks(): { [id: string]: LinkModel } {\n\t\treturn this.links;\n\t}\n\n\tpublic createLinkModel(): LinkModel | null {\n\t\tif (_.isFinite(this.options.maximumLinks)) {\n\t\t\tvar numberOfLinks: number = _.size(this.links);\n\t\t\tif (this.options.maximumLinks === 1 && numberOfLinks >= 1) {\n\t\t\t\treturn _.values(this.links)[0];\n\t\t\t} else if (numberOfLinks >= this.options.maximumLinks) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\treportPosition() {\n\t\t_.forEach(this.getLinks(), (link) => {\n\t\t\tlink.getPointForPort(this).setPosition(this.getCenter());\n\t\t});\n\t\tthis.fireEvent(\n\t\t\t{\n\t\t\t\tentity: this\n\t\t\t},\n\t\t\t'reportInitialPosition'\n\t\t);\n\t}\n\n\tgetCenter(): Point {\n\t\treturn new Point(this.getX() + this.width / 2, this.getY() + this.height / 2);\n\t}\n\n\tgetBoundingBox(): Rectangle {\n\t\treturn Rectangle.fromPointAndSize(this.position, this.width, this.height);\n\t}\n\n\tupdateCoords(coords: Rectangle) {\n\t\tthis.width = coords.getWidth();\n\t\tthis.height = coords.getHeight();\n\t\tthis.setPosition(coords.getTopLeft());\n\t\tthis.reportedPosition = true;\n\t\tthis.reportPosition();\n\t}\n\n\tcanLinkToPort(port: PortModel): boolean {\n\t\treturn true;\n\t}\n\n\tisLocked() {\n\t\treturn super.isLocked() || this.getParent().isLocked();\n\t}\n}\n","import * as React from 'react';\nimport * as _ from 'lodash';\nimport { NodeModel } from '../node/NodeModel';\nimport { NodeWidget } from '../node/NodeWidget';\nimport { NodeLayerModel } from './NodeLayerModel';\nimport { DiagramEngine } from '../../DiagramEngine';\n\nexport interface NodeLayerWidgetProps {\n\tlayer: NodeLayerModel;\n\tengine: DiagramEngine;\n}\n\nexport class NodeLayerWidget extends React.Component<NodeLayerWidgetProps> {\n\trender() {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{_.map(this.props.layer.getNodes(), (node: NodeModel) => {\n\t\t\t\t\treturn <NodeWidget key={node.getID()} diagramEngine={this.props.engine} node={node} />;\n\t\t\t\t})}\n\t\t\t</>\n\t\t);\n\t}\n}\n","import * as React from 'react';\nimport { AbstractReactFactory, GenerateModelEvent, GenerateWidgetEvent } from '@projectstorm/react-canvas-core';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { NodeLayerModel } from './NodeLayerModel';\nimport { NodeLayerWidget } from './NodeLayerWidget';\n\nexport class NodeLayerFactory extends AbstractReactFactory<NodeLayerModel, DiagramEngine> {\n\tconstructor() {\n\t\tsuper('diagram-nodes');\n\t}\n\n\tgenerateModel(event: GenerateModelEvent): NodeLayerModel {\n\t\treturn new NodeLayerModel();\n\t}\n\n\tgenerateReactWidget(event: GenerateWidgetEvent<NodeLayerModel>): JSX.Element {\n\t\treturn <NodeLayerWidget layer={event.model} engine={this.engine} />;\n\t}\n}\n","import * as React from 'react';\nimport * as _ from 'lodash';\nimport { PortModel } from './PortModel';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { ListenerHandle, Toolkit } from '@projectstorm/react-canvas-core';\n\nexport interface PortProps {\n\tport: PortModel;\n\tengine: DiagramEngine;\n\tclassName?;\n\tstyle?;\n}\n\nexport class PortWidget extends React.Component<React.PropsWithChildren<PortProps>> {\n\tref: React.RefObject<HTMLDivElement>;\n\tengineListenerHandle: ListenerHandle;\n\n\tconstructor(props: PortProps) {\n\t\tsuper(props);\n\t\tthis.ref = React.createRef();\n\t}\n\n\treport() {\n\t\tthis.props.port.updateCoords(this.props.engine.getPortCoords(this.props.port, this.ref.current));\n\t}\n\n\tcomponentWillUnmount(): void {\n\t\tthis.engineListenerHandle && this.engineListenerHandle.deregister();\n\t}\n\n\tcomponentDidUpdate(prevProps: Readonly<PortProps>, prevState, snapshot?: any): void {\n\t\tif (!this.props.port.reportedPosition) {\n\t\t\tthis.report();\n\t\t}\n\t}\n\n\tcomponentDidMount(): void {\n\t\tthis.engineListenerHandle = this.props.engine.registerListener({\n\t\t\tcanvasReady: () => {\n\t\t\t\tthis.report();\n\t\t\t}\n\t\t});\n\t\tif (this.props.engine.getCanvas()) {\n\t\t\tthis.report();\n\t\t}\n\t}\n\n\tgetExtraProps() {\n\t\tif (Toolkit.TESTING) {\n\t\t\tconst links = _.keys(this.props.port.getNode().getPort(this.props.port.getName()).links).join(',');\n\t\t\treturn {\n\t\t\t\t'data-links': links\n\t\t\t};\n\t\t}\n\t\treturn {};\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tstyle={this.props.style}\n\t\t\t\tref={this.ref}\n\t\t\t\tclassName={`port ${this.props.className || ''}`}\n\t\t\t\tdata-name={this.props.port.getName()}\n\t\t\t\tdata-nodeid={this.props.port.getNode().getID()}\n\t\t\t\t{...this.getExtraProps()}\n\t\t\t>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t);\n\t}\n}\n","import {\n\tAbstractDisplacementState,\n\tAbstractDisplacementStateEvent,\n\tAction,\n\tActionEvent,\n\tInputType\n} from '@projectstorm/react-canvas-core';\nimport { PortModel } from '../entities/port/PortModel';\nimport { MouseEvent } from 'react';\nimport { LinkModel } from '../entities/link/LinkModel';\nimport { DiagramEngine } from '../DiagramEngine';\n\nexport interface DragNewLinkStateOptions {\n\t/**\n\t * If enabled, the links will stay on the canvas if they dont connect to a port\n\t * when dragging finishes\n\t */\n\tallowLooseLinks?: boolean;\n\t/**\n\t * If enabled, then a link can still be drawn from the port even if it is locked\n\t */\n\tallowLinksFromLockedPorts?: boolean;\n}\n\nexport class DragNewLinkState extends AbstractDisplacementState<DiagramEngine> {\n\tport: PortModel;\n\tlink: LinkModel;\n\tconfig: DragNewLinkStateOptions;\n\n\tconstructor(options: DragNewLinkStateOptions = {}) {\n\t\tsuper({ name: 'drag-new-link' });\n\n\t\tthis.config = {\n\t\t\tallowLooseLinks: true,\n\t\t\tallowLinksFromLockedPorts: false,\n\t\t\t...options\n\t\t};\n\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_DOWN,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent, PortModel>) => {\n\t\t\t\t\tthis.port = this.engine.getMouseElement(event.event) as PortModel;\n\t\t\t\t\tif (!this.config.allowLinksFromLockedPorts && this.port.isLocked()) {\n\t\t\t\t\t\tthis.eject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.link = this.port.createLinkModel();\n\n\t\t\t\t\t// if no link is given, just eject the state\n\t\t\t\t\tif (!this.link) {\n\t\t\t\t\t\tthis.eject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.link.setSelected(true);\n\t\t\t\t\tthis.link.setSourcePort(this.port);\n\t\t\t\t\tthis.engine.getModel().addLink(this.link);\n\t\t\t\t\tthis.port.reportPosition();\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_UP,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent>) => {\n\t\t\t\t\tconst model = this.engine.getMouseElement(event.event);\n\t\t\t\t\t// check to see if we connected to a new port\n\t\t\t\t\tif (model instanceof PortModel) {\n\t\t\t\t\t\tif (this.port.canLinkToPort(model)) {\n\t\t\t\t\t\t\tthis.link.setTargetPort(model);\n\t\t\t\t\t\t\tmodel.reportPosition();\n\t\t\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.link.remove();\n\t\t\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.config.allowLooseLinks) {\n\t\t\t\t\t\tthis.link.remove();\n\t\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\n\t/**\n\t * Calculates the link's far-end point position on mouse move.\n\t * In order to be as precise as possible the mouse initialXRelative & initialYRelative are taken into account as well\n\t * as the possible engine offset\n\t */\n\tfireMouseMoved(event: AbstractDisplacementStateEvent): any {\n\t\tconst portPos = this.port.getPosition();\n\t\tconst zoomLevelPercentage = this.engine.getModel().getZoomLevel() / 100;\n\t\tconst engineOffsetX = this.engine.getModel().getOffsetX() / zoomLevelPercentage;\n\t\tconst engineOffsetY = this.engine.getModel().getOffsetY() / zoomLevelPercentage;\n\t\tconst initialXRelative = this.initialXRelative / zoomLevelPercentage;\n\t\tconst initialYRelative = this.initialYRelative / zoomLevelPercentage;\n\t\tconst linkNextX = portPos.x - engineOffsetX + (initialXRelative - portPos.x) + event.virtualDisplacementX;\n\t\tconst linkNextY = portPos.y - engineOffsetY + (initialYRelative - portPos.y) + event.virtualDisplacementY;\n\n\t\tthis.link.getLastPoint().setPosition(linkNextX, linkNextY);\n\t\tthis.engine.repaintCanvas();\n\t}\n}\n","import { Action, ActionEvent, InputType, MoveItemsState } from '@projectstorm/react-canvas-core';\nimport * as _ from 'lodash';\nimport { PointModel } from '../entities/link/PointModel';\nimport { DiagramEngine } from '../DiagramEngine';\nimport { PortModel } from '../entities/port/PortModel';\nimport { MouseEvent } from 'react';\nimport { LinkModel } from '../entities/link/LinkModel';\n\nexport class DragDiagramItemsState extends MoveItemsState<DiagramEngine> {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_UP,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent>) => {\n\t\t\t\t\tconst item = this.engine.getMouseElement(event.event);\n\t\t\t\t\tif (item instanceof PortModel) {\n\t\t\t\t\t\t_.forEach(this.initialPositions, (position) => {\n\t\t\t\t\t\t\tif (position.item instanceof PointModel) {\n\t\t\t\t\t\t\t\tconst link = position.item.getParent() as LinkModel;\n\n\t\t\t\t\t\t\t\t// only care about the last links\n\t\t\t\t\t\t\t\tif (link.getLastPoint() !== position.item) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (link.getSourcePort().canLinkToPort(item)) {\n\t\t\t\t\t\t\t\t\tlink.setTargetPort(item);\n\t\t\t\t\t\t\t\t\titem.reportPosition();\n\t\t\t\t\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","import { MouseEvent, TouchEvent } from 'react';\nimport {\n\tSelectingState,\n\tState,\n\tAction,\n\tInputType,\n\tActionEvent,\n\tDragCanvasState\n} from '@projectstorm/react-canvas-core';\nimport { PortModel } from '../entities/port/PortModel';\nimport { DragNewLinkState } from './DragNewLinkState';\nimport { DiagramEngine } from '../DiagramEngine';\nimport { DragDiagramItemsState } from './DragDiagramItemsState';\n\nexport class DefaultDiagramState extends State<DiagramEngine> {\n\tdragCanvas: DragCanvasState;\n\tdragNewLink: DragNewLinkState;\n\tdragItems: DragDiagramItemsState;\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tname: 'default-diagrams'\n\t\t});\n\t\tthis.childStates = [new SelectingState()];\n\t\tthis.dragCanvas = new DragCanvasState();\n\t\tthis.dragNewLink = new DragNewLinkState();\n\t\tthis.dragItems = new DragDiagramItemsState();\n\n\t\t// determine what was clicked on\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_DOWN,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent>) => {\n\t\t\t\t\tconst element = this.engine.getActionEventBus().getModelForEvent(event);\n\n\t\t\t\t\t// the canvas was clicked on, transition to the dragging canvas state\n\t\t\t\t\tif (!element) {\n\t\t\t\t\t\tthis.transitionWithEvent(this.dragCanvas, event);\n\t\t\t\t\t}\n\t\t\t\t\t// initiate dragging a new link\n\t\t\t\t\telse if (element instanceof PortModel) {\n\t\t\t\t\t\tthis.transitionWithEvent(this.dragNewLink, event);\n\t\t\t\t\t}\n\t\t\t\t\t// move the items (and potentially link points)\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.transitionWithEvent(this.dragItems, event);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\t// touch drags the canvas\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.TOUCH_START,\n\t\t\t\tfire: (event: ActionEvent<TouchEvent>) => {\n\t\t\t\t\tthis.transitionWithEvent(this.dragCanvas, event);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","import { NodeModel } from './entities/node/NodeModel';\nimport { PortModel } from './entities/port/PortModel';\nimport { LinkModel } from './entities/link/LinkModel';\nimport { LabelModel } from './entities/label/LabelModel';\nimport { boundingBoxFromPolygons, Point, Rectangle } from '@projectstorm/geometry';\nimport { MouseEvent } from 'react';\nimport {\n\tAbstractModelFactory,\n\tAbstractReactFactory,\n\tBaseModel,\n\tCanvasEngine,\n\tCanvasEngineListener,\n\tCanvasEngineOptions,\n\tFactoryBank,\n\tToolkit\n} from '@projectstorm/react-canvas-core';\nimport { DiagramModel } from './models/DiagramModel';\n\n/**\n * Passed as a parameter to the DiagramWidget\n */\nexport class DiagramEngine extends CanvasEngine<CanvasEngineListener, DiagramModel> {\n\tprotected nodeFactories: FactoryBank<AbstractReactFactory<NodeModel, DiagramEngine>>;\n\tprotected linkFactories: FactoryBank<AbstractReactFactory<LinkModel, DiagramEngine>>;\n\tprotected portFactories: FactoryBank<AbstractModelFactory<PortModel, DiagramEngine>>;\n\tprotected labelFactories: FactoryBank<AbstractReactFactory<LabelModel, DiagramEngine>>;\n\n\tmaxNumberPointsPerLink: number;\n\n\tconstructor(options: CanvasEngineOptions = {}) {\n\t\tsuper(options);\n\t\tthis.maxNumberPointsPerLink = 1000;\n\n\t\t// create banks for the different factory types\n\t\tthis.nodeFactories = new FactoryBank();\n\t\tthis.linkFactories = new FactoryBank();\n\t\tthis.portFactories = new FactoryBank();\n\t\tthis.labelFactories = new FactoryBank();\n\n\t\tconst setup = (factory: FactoryBank) => {\n\t\t\tfactory.registerListener({\n\t\t\t\tfactoryAdded: (event) => {\n\t\t\t\t\tevent.factory.setDiagramEngine(this);\n\t\t\t\t},\n\t\t\t\tfactoryRemoved: (event) => {\n\t\t\t\t\tevent.factory.setDiagramEngine(null);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tsetup(this.nodeFactories);\n\t\tsetup(this.linkFactories);\n\t\tsetup(this.portFactories);\n\t\tsetup(this.labelFactories);\n\t}\n\n\t/**\n\t * Gets a model and element under the mouse cursor\n\t */\n\tgetMouseElement(event: MouseEvent): BaseModel {\n\t\tvar target = event.target as Element;\n\t\tvar diagramModel = this.model;\n\n\t\t//is it a port\n\t\tvar element = Toolkit.closest(target, '.port[data-name]');\n\t\tif (element) {\n\t\t\tvar nodeElement = Toolkit.closest(target, '.node[data-nodeid]') as HTMLElement;\n\t\t\treturn diagramModel.getNode(nodeElement.getAttribute('data-nodeid')).getPort(element.getAttribute('data-name'));\n\t\t}\n\n\t\t//look for a point\n\t\telement = Toolkit.closest(target, '.point[data-id]');\n\t\tif (element) {\n\t\t\treturn diagramModel.getLink(element.getAttribute('data-linkid')).getPointModel(element.getAttribute('data-id'));\n\t\t}\n\n\t\t//look for a link\n\t\telement = Toolkit.closest(target, '[data-linkid]');\n\t\tif (element) {\n\t\t\treturn diagramModel.getLink(element.getAttribute('data-linkid'));\n\t\t}\n\n\t\t//look for a node\n\t\telement = Toolkit.closest(target, '.node[data-nodeid]');\n\t\tif (element) {\n\t\t\treturn diagramModel.getNode(element.getAttribute('data-nodeid'));\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t//!-------------- FACTORIES ------------\n\n\tgetNodeFactories() {\n\t\treturn this.nodeFactories;\n\t}\n\n\tgetLinkFactories() {\n\t\treturn this.linkFactories;\n\t}\n\n\tgetLabelFactories() {\n\t\treturn this.labelFactories;\n\t}\n\n\tgetPortFactories() {\n\t\treturn this.portFactories;\n\t}\n\n\tgetFactoryForNode<F extends AbstractReactFactory<NodeModel, DiagramEngine>>(node: NodeModel | string) {\n\t\tif (typeof node === 'string') {\n\t\t\treturn this.nodeFactories.getFactory(node);\n\t\t}\n\t\treturn this.nodeFactories.getFactory(node.getType());\n\t}\n\n\tgetFactoryForLink<F extends AbstractReactFactory<LinkModel, DiagramEngine>>(link: LinkModel | string) {\n\t\tif (typeof link === 'string') {\n\t\t\treturn this.linkFactories.getFactory<F>(link);\n\t\t}\n\t\treturn this.linkFactories.getFactory<F>(link.getType());\n\t}\n\n\tgetFactoryForLabel<F extends AbstractReactFactory<LabelModel, DiagramEngine>>(label: LabelModel) {\n\t\tif (typeof label === 'string') {\n\t\t\treturn this.labelFactories.getFactory(label);\n\t\t}\n\t\treturn this.labelFactories.getFactory(label.getType());\n\t}\n\n\tgetFactoryForPort<F extends AbstractModelFactory<PortModel, DiagramEngine>>(port: PortModel) {\n\t\tif (typeof port === 'string') {\n\t\t\treturn this.portFactories.getFactory<F>(port);\n\t\t}\n\t\treturn this.portFactories.getFactory<F>(port.getType());\n\t}\n\n\tgenerateWidgetForLink(link: LinkModel): JSX.Element {\n\t\treturn this.getFactoryForLink(link).generateReactWidget({ model: link });\n\t}\n\n\tgenerateWidgetForNode(node: NodeModel): JSX.Element {\n\t\treturn this.getFactoryForNode(node).generateReactWidget({ model: node });\n\t}\n\n\tgetNodeElement(node: NodeModel): Element {\n\t\tconst selector = this.canvas.querySelector(`.node[data-nodeid=\"${node.getID()}\"]`);\n\t\tif (selector === null) {\n\t\t\tthrow new Error('Cannot find Node element with nodeID: [' + node.getID() + ']');\n\t\t}\n\t\treturn selector;\n\t}\n\n\tgetNodePortElement(port: PortModel): any {\n\t\tvar selector = this.canvas.querySelector(\n\t\t\t`.port[data-name=\"${port.getName()}\"][data-nodeid=\"${port.getParent().getID()}\"]`\n\t\t);\n\t\tif (selector === null) {\n\t\t\tthrow new Error(\n\t\t\t\t'Cannot find Node Port element with nodeID: [' +\n\t\t\t\t\tport.getParent().getID() +\n\t\t\t\t\t'] and name: [' +\n\t\t\t\t\tport.getName() +\n\t\t\t\t\t']'\n\t\t\t);\n\t\t}\n\t\treturn selector;\n\t}\n\n\tgetPortCenter(port: PortModel): Point {\n\t\treturn this.getPortCoords(port).getOrigin();\n\t}\n\n\t/**\n\t * Calculate rectangular coordinates of the port passed in.\n\t */\n\tgetPortCoords(port: PortModel, element?: HTMLDivElement): Rectangle {\n\t\tif (!this.canvas) {\n\t\t\tthrow new Error('Canvas needs to be set first');\n\t\t}\n\t\tif (!element) {\n\t\t\telement = this.getNodePortElement(port);\n\t\t}\n\t\tconst sourceRect = element.getBoundingClientRect();\n\t\tconst point = this.getRelativeMousePoint({\n\t\t\tclientX: sourceRect.left,\n\t\t\tclientY: sourceRect.top\n\t\t});\n\t\tconst zoom = this.model.getZoomLevel() / 100.0;\n\t\treturn Rectangle.fromPointAndSize(point, sourceRect.width / zoom, sourceRect.height / zoom);\n\t}\n\n\t/**\n\t * Determine the width and height of the node passed in.\n\t * It currently assumes nodes have a rectangular shape, can be overriden for customised shapes.\n\t */\n\tgetNodeDimensions(node: NodeModel): { width: number; height: number } {\n\t\tif (!this.canvas) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t};\n\t\t}\n\n\t\tconst nodeElement = this.getNodeElement(node);\n\t\tconst nodeRect = nodeElement.getBoundingClientRect();\n\n\t\treturn {\n\t\t\twidth: nodeRect.width,\n\t\t\theight: nodeRect.height\n\t\t};\n\t}\n\n\tgetBoundingNodesRect(nodes: NodeModel[]): Rectangle {\n\t\tif (nodes) {\n\t\t\tif (nodes.length === 0) {\n\t\t\t\treturn new Rectangle();\n\t\t\t}\n\t\t\treturn new Rectangle(boundingBoxFromPolygons(nodes.map((node) => node.getBoundingBox())));\n\t\t}\n\t}\n\n\tzoomToFitSelectedNodes(options: { margin?: number; maxZoom?: number }) {\n\t\tconst nodes: NodeModel[] = this.model\n\t\t\t.getSelectedEntities()\n\t\t\t.filter((entity) => entity instanceof NodeModel) as NodeModel[];\n\t\tthis.zoomToFitNodes({\n\t\t\tmargin: options.margin,\n\t\t\tmaxZoom: options.maxZoom,\n\t\t\tnodes: nodes.length > 0 ? nodes : null\n\t\t});\n\t}\n\n\tzoomToFitNodes(options: { margin?: number; nodes?: NodeModel[]; maxZoom?: number });\n\t/**\n\t * @deprecated\n\t */\n\tzoomToFitNodes(margin: number);\n\tzoomToFitNodes(options) {\n\t\tlet margin = options || 0;\n\t\tlet nodes: NodeModel[] = [];\n\t\tlet maxZoom: number | null = null;\n\t\tif (!!options && typeof options == 'object') {\n\t\t\tmargin = options.margin || 0;\n\t\t\tnodes = options.nodes || [];\n\t\t\tmaxZoom = options.maxZoom || null;\n\t\t}\n\n\t\t// no node selected\n\t\tif (nodes.length === 0) {\n\t\t\tnodes = this.model.getNodes();\n\t\t}\n\t\tconst nodesRect = this.getBoundingNodesRect(nodes);\n\t\tif (nodesRect) {\n\t\t\t// there is something we should zoom on\n\t\t\tlet canvasRect = this.canvas.getBoundingClientRect();\n\n\t\t\tconst calculate = (margin: number = 0) => {\n\t\t\t\t// work out zoom\n\t\t\t\tconst xFactor = this.canvas.clientWidth / (nodesRect.getWidth() + margin * 2);\n\t\t\t\tconst yFactor = this.canvas.clientHeight / (nodesRect.getHeight() + margin * 2);\n\n\t\t\t\tlet zoomFactor = xFactor < yFactor ? xFactor : yFactor;\n\t\t\t\tif (maxZoom && zoomFactor > maxZoom) {\n\t\t\t\t\tzoomFactor = maxZoom;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tzoom: zoomFactor,\n\t\t\t\t\tx:\n\t\t\t\t\t\tcanvasRect.width / 2 -\n\t\t\t\t\t\t((nodesRect.getWidth() + margin * 2) / 2 + nodesRect.getTopLeft().x) * zoomFactor +\n\t\t\t\t\t\tmargin,\n\t\t\t\t\ty:\n\t\t\t\t\t\tcanvasRect.height / 2 -\n\t\t\t\t\t\t((nodesRect.getHeight() + margin * 2) / 2 + nodesRect.getTopLeft().y) * zoomFactor +\n\t\t\t\t\t\tmargin\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tlet params = calculate(0);\n\t\t\tif (margin) {\n\t\t\t\tif (params.x < margin || params.y < margin) {\n\t\t\t\t\tparams = calculate(margin);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// apply\n\t\t\tthis.model.setZoomLevel(params.zoom * 100);\n\t\t\tthis.model.setOffset(params.x, params.y);\n\t\t\tthis.repaintCanvas();\n\t\t}\n\t}\n\n\tgetMaxNumberPointsPerLink(): number {\n\t\treturn this.maxNumberPointsPerLink;\n\t}\n\n\tsetMaxNumberPointsPerLink(max: number) {\n\t\tthis.maxNumberPointsPerLink = max;\n\t}\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","require","PointModel","BasePositionModel","constructor","options","super","type","this","parent","link","isConnectedToPort","getPortForPoint","getLink","getParent","remove","removePoint","isLocked","LinkModel","BaseModel","points","sourcePort","targetPort","renderedPaths","labels","getBoundingBox","Rectangle","boundingBoxFromPoints","point","getPosition","getSelectionEntities","getTargetPort","getSourcePort","concat","length","deserialize","event","data","p","position","Point","x","y","label","labelOb","engine","getFactoryForLabel","generateModel","addLabel","target","getModel","then","model","setTargetPort","source","setSourcePort","getRenderedPath","setRenderedPaths","paths","serialize","getID","doClone","lookupTable","clone","setPoints","getPoints","clearPort","port","removeLink","isLastPoint","getPointIndex","indexOf","getPointModel","id","i","getFirstPoint","getLastPoint","getPointForPort","addLink","fireEvent","reportedPosition","setPosition","getCenter","index","addPoint","generatePoint","setParent","push","getLabels","pointModel","splice","removePointsBefore","removePointsAfter","removeMiddlePoints","NodeModel","ports","width","height","fromPointAndSize","old","getX","getY","portOb","getFactoryForPort","registerModel","addPort","getLinks","getPortFromID","portID","links","getPort","name","getPorts","removePort","getName","updateDimensions","NodeLayerModel","LayerModel","isSvg","transformed","addModel","Error","registerListener","entityRemoved","removeNode","getChildModelFactoryBank","getNodeFactories","getNodes","getModels","LinkLayerModel","getLinkFactories","DiagramModel","CanvasModel","addLayer","layers","layer","activeNodeLayer","activeLinkLayer","getLinkLayers","getNodeLayers","getActiveNodeLayer","getActiveLinkLayer","getNode","node","addAll","models","addNode","isCreated","removeModel","LabelModel","offsetX","offsetY","S","Label","Foreign","LabelWidget","props","findPathAndRelativePositionToRenderLabel","lengths","map","path","getTotalLength","labelPosition","reduce","previousValue","currentValue","pathIndex","calculateLabelPosition","found","labelDimensions","ref","current","offsetWidth","offsetHeight","pathCentre","getPointAtLength","labelCoordinates","getOptions","style","transform","componentDidUpdate","window","requestAnimationFrame","componentDidMount","render","canvas","getCanvas","generateReactWidget","LinkWidget","state","componentWillUnmount","sourceListener","deregister","targetListener","getDerivedStateFromProps","nextProps","prevState","installTarget","reportInitialPosition","forceUpdate","installSource","prevProps","snapshot","generateLinePath","firstPoint","lastPoint","PeformanceWidget","serialized","diagramEngine","generateWidgetForLink","labelModel","Container","LinkLayerWidget","LinkLayerFactory","AbstractReactFactory","PortModelAlignment","Node","NodeWidget","ob","disconnect","listener","installSelectionListener","selectionChanged","updateSize","updateCoords","getPortCoords","ex","entities","bounds","contentRect","b","getBoundingClientRect","observe","className","top","left","generateWidgetForNode","NodeLayerWidget","NodeLayerFactory","PortModel","alignment","parentNode","getMaximumLinks","maximumLinks","setMaximumLinks","createLinkModel","numberOfLinks","reportPosition","entity","coords","getWidth","getHeight","getTopLeft","canLinkToPort","PortWidget","report","engineListenerHandle","canvasReady","getExtraProps","Toolkit","TESTING","join","children","DragNewLinkState","AbstractDisplacementState","config","allowLooseLinks","allowLinksFromLockedPorts","registerAction","Action","InputType","MOUSE_DOWN","fire","getMouseElement","setSelected","eject","MOUSE_UP","repaintCanvas","fireMouseMoved","portPos","zoomLevelPercentage","getZoomLevel","engineOffsetX","getOffsetX","engineOffsetY","getOffsetY","initialXRelative","initialYRelative","linkNextX","virtualDisplacementX","linkNextY","virtualDisplacementY","DragDiagramItemsState","MoveItemsState","item","initialPositions","DefaultDiagramState","State","childStates","SelectingState","dragCanvas","DragCanvasState","dragNewLink","dragItems","element","getActionEventBus","getModelForEvent","transitionWithEvent","TOUCH_START","DiagramEngine","CanvasEngine","maxNumberPointsPerLink","nodeFactories","FactoryBank","linkFactories","portFactories","labelFactories","setup","factoryAdded","setDiagramEngine","factoryRemoved","diagramModel","closest","nodeElement","getAttribute","getLabelFactories","getPortFactories","getFactoryForNode","getFactory","getType","getFactoryForLink","getNodeElement","selector","querySelector","getNodePortElement","getPortCenter","getOrigin","sourceRect","getRelativeMousePoint","clientX","clientY","zoom","getNodeDimensions","nodeRect","getBoundingNodesRect","nodes","boundingBoxFromPolygons","zoomToFitSelectedNodes","getSelectedEntities","filter","zoomToFitNodes","margin","maxZoom","nodesRect","canvasRect","calculate","xFactor","clientWidth","yFactor","clientHeight","zoomFactor","params","setZoomLevel","setOffset","getMaxNumberPointsPerLink","setMaxNumberPointsPerLink","max"],"sourceRoot":""}