composition_tree_content = """{
    "id": "fa2362dc-cffa-4764-9b70-90d475be0c02",
    "offsetX": 61.67634402521469,
    "offsetY": -11.923703733601997,
    "zoom": 93.24819279191733,
    "gridSize": 0,
    "layers": [
        {
            "id": "1d9af8b5-858e-4253-9057-fbf3c9f2442d",
            "type": "diagram-links",
            "isSvg": true,
            "transformed": true,
            "models": {
                "921aa417-c096-4c55-916d-a629c815110a": {
                    "id": "921aa417-c096-4c55-916d-a629c815110a",
                    "type": "default",
                    "selected": false,
                    "source": "94891f48-9deb-4724-a39d-3551b000dcf6",
                    "sourcePort": "d988236c-73d4-423a-8acc-05911daede71",
                    "target": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
                    "targetPort": "3fc29d39-66c3-44f5-a05b-d5bfc2f0939f",
                    "points": [
                        {
                            "id": "fe88f2a7-cba9-41bc-9a23-e13852600f1c",
                            "type": "point",
                            "x": 271.45309848133024,
                            "y": 123.2812525974364
                        },
                        {
                            "id": "9e7b046e-0959-466e-b647-06e37e3012f3",
                            "type": "point",
                            "x": 362.65624734633343,
                            "y": 238.42188004084605
                        }
                    ],
                    "labels": [],
                    "width": 3,
                    "color": "gray",
                    "curvyness": 50,
                    "selectedColor": "rgb(0,192,255)"
                },
                "6435c701-6951-42f8-a11c-9541679a3d3d": {
                    "id": "6435c701-6951-42f8-a11c-9541679a3d3d",
                    "type": "default",
                    "selected": false,
                    "source": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
                    "sourcePort": "6d7a00c6-ec6f-4120-9ef5-2669c0f2075b",
                    "target": "7f7095b5-22b1-43d0-9987-d899675c810e",
                    "targetPort": "4d9bbb8d-b6c6-412f-a12c-eb415b7e918f",
                    "points": [
                        {
                            "id": "0edfd606-c080-413d-9ffe-d9e57dcab922",
                            "type": "point",
                            "x": 515.8281349866311,
                            "y": 238.42188004084605
                        },
                        {
                            "id": "1524a3db-7b04-4015-a5fd-d5feb662b8ca",
                            "type": "point",
                            "x": 561.7187565758979,
                            "y": 307.34375420844935
                        }
                    ],
                    "labels": [],
                    "width": 3,
                    "color": "gray",
                    "curvyness": 50,
                    "selectedColor": "rgb(0,192,255)"
                },
                "d18f0bc1-a43b-4125-8685-afa2a9c85bfb": {
                    "id": "d18f0bc1-a43b-4125-8685-afa2a9c85bfb",
                    "type": "default",
                    "selected": false,
                    "source": "d7455f63-5709-4f5e-b78d-7b83c86b0782",
                    "sourcePort": "7daad588-665d-48c9-9136-5ccd451e86df",
                    "target": "7f7095b5-22b1-43d0-9987-d899675c810e",
                    "targetPort": "781c6047-7814-4652-a54b-d061f7a9e05d",
                    "points": [
                        {
                            "id": "d235870c-4110-4534-b141-f2bb96efa6db",
                            "type": "point",
                            "x": 496.9531461954,
                            "y": 385.21875932962496
                        },
                        {
                            "id": "7f04ff81-8948-43eb-a563-c33d394e320b",
                            "type": "point",
                            "selected": true,
                            "x": 562.7187707201595,
                            "y": 331.343750034502
                        }
                    ],
                    "labels": [],
                    "width": 3,
                    "color": "gray",
                    "curvyness": 50,
                    "selectedColor": "rgb(0,192,255)"
                },
                "3560c997-d411-4951-ac25-80e5cdf6fcb9": {
                    "id": "3560c997-d411-4951-ac25-80e5cdf6fcb9",
                    "type": "default",
                    "selected": false,
                    "source": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
                    "sourcePort": "6d7a00c6-ec6f-4120-9ef5-2669c0f2075b",
                    "target": "89dda0e0-a452-40f7-9cab-d8fdbf2b4cbd",
                    "targetPort": "1c027e66-eb9b-4db3-aa02-755ddbc0ee39",
                    "points": [
                        {
                            "id": "57c8a0b2-a55d-4c6a-9f87-38e7f1ae7e49",
                            "type": "point",
                            "x": 515.8281349866311,
                            "y": 238.42188004084605
                        },
                        {
                            "id": "f519575f-8d3f-4c00-8bdb-b9f184a0d8e1",
                            "type": "point",
                            "x": 563.2499995979463,
                            "y": 177.34374818097868
                        }
                    ],
                    "labels": [],
                    "width": 3,
                    "color": "gray",
                    "curvyness": 50,
                    "selectedColor": "rgb(0,192,255)"
                }
            }
        },
        {
            "id": "fed3b351-5f1a-4cad-9f61-031f8a6af57e",
            "type": "diagram-nodes",
            "isSvg": false,
            "transformed": true,
            "models": {
                "94891f48-9deb-4724-a39d-3551b000dcf6": {
                    "id": "94891f48-9deb-4724-a39d-3551b000dcf6",
                    "type": "basic",
                    "selected": false,
                    "x": 179.38945802191407,
                    "y": 101.79682939853167,
                    "ports": [
                        {
                            "id": "d988236c-73d4-423a-8acc-05911daede71",
                            "type": "children",
                            "x": 266.45309321454147,
                            "y": 118.2812555124625,
                            "name": "children",
                            "alignment": "right",
                            "parentNode": "94891f48-9deb-4724-a39d-3551b000dcf6",
                            "links": [
                                "921aa417-c096-4c55-916d-a629c815110a"
                            ],
                            "in": false,
                            "label": "children"
                        }
                    ],
                    "name": "Tree Root",
                    "color": "rgb(0,204,0)",
                    "is_selected": false
                },
                "ae350d90-0f61-4345-aa50-f6d36bc58b44": {
                    "id": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
                    "type": "basic",
                    "selected": false,
                    "x": 360.66273678167516,
                    "y": 216.9298918417072,
                    "ports": [
                        {
                            "id": "3fc29d39-66c3-44f5-a05b-d5bfc2f0939f",
                            "type": "parent",
                            "x": 357.6562420795446,
                            "y": 233.42187477405724,
                            "name": "parent",
                            "alignment": "left",
                            "parentNode": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
                            "links": [
                                "921aa417-c096-4c55-916d-a629c815110a"
                            ],
                            "in": true,
                            "label": "parent"
                        },
                        {
                            "id": "6d7a00c6-ec6f-4120-9ef5-2669c0f2075b",
                            "type": "children",
                            "x": 510.82819517436144,
                            "y": 233.42187477405724,
                            "name": "children",
                            "alignment": "right",
                            "parentNode": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
                            "links": [
                                "6435c701-6951-42f8-a11c-9541679a3d3d",
                                "3560c997-d411-4951-ac25-80e5cdf6fcb9"
                            ],
                            "in": false,
                            "label": "children"
                        }
                    ],
                    "name": "ReactiveSequence",
                    "color": "rgb(0,128,255)",
                    "is_selected": false,
                    "is_subtree": false
                },
                "7f7095b5-22b1-43d0-9987-d899675c810e": {
                    "id": "7f7095b5-22b1-43d0-9987-d899675c810e",
                    "type": "basic",
                    "selected": false,
                    "x": 559.7321581575138,
                    "y": 285.8485220635546,
                    "ports": [
                        {
                            "id": "4d9bbb8d-b6c6-412f-a12c-eb415b7e918f",
                            "type": "parent",
                            "x": 556.718751309109,
                            "y": 302.3437489416605,
                            "name": "parent",
                            "alignment": "left",
                            "parentNode": "7f7095b5-22b1-43d0-9987-d899675c810e",
                            "links": [
                                "6435c701-6951-42f8-a11c-9541679a3d3d"
                            ],
                            "in": true,
                            "label": "parent"
                        },
                        {
                            "id": "781c6047-7814-4652-a54b-d061f7a9e05d",
                            "type": "input",
                            "x": 557.7187654533707,
                            "y": 326.343761131343,
                            "name": "speed",
                            "alignment": "left",
                            "parentNode": "7f7095b5-22b1-43d0-9987-d899675c810e",
                            "links": [
                                "d18f0bc1-a43b-4125-8685-afa2a9c85bfb"
                            ],
                            "in": true,
                            "label": "input"
                        }
                    ],
                    "name": "Forward",
                    "color": "rgb(128,0,128)",
                    "is_selected": false,
                    "is_subtree": false
                },
                "d7455f63-5709-4f5e-b78d-7b83c86b0782": {
                    "id": "d7455f63-5709-4f5e-b78d-7b83c86b0782",
                    "type": "tag",
                    "selected": false,
                    "x": 458.75298848789356,
                    "y": 368.732174805295,
                    "ports": [
                        {
                            "id": "7daad588-665d-48c9-9136-5ccd451e86df",
                            "type": "tag output",
                            "x": 491.95320638313035,
                            "y": 380.2187540628362,
                            "name": "tag output",
                            "alignment": "right",
                            "parentNode": "d7455f63-5709-4f5e-b78d-7b83c86b0782",
                            "links": [
                                "d18f0bc1-a43b-4125-8685-afa2a9c85bfb"
                            ],
                            "in": false,
                            "label": "tag output"
                        }
                    ],
                    "name": "0.4",
                    "color": "var(--bt-tag-normal-background)",
                    "is_selected": false,
                    "is_blackboard": false
                },
                "89dda0e0-a452-40f7-9cab-d8fdbf2b4cbd": {
                    "id": "89dda0e0-a452-40f7-9cab-d8fdbf2b4cbd",
                    "type": "basic",
                    "selected": false,
                    "x": 561.2538423415775,
                    "y": 155.84578603225927,
                    "ports": [
                        {
                            "id": "1c027e66-eb9b-4db3-aa02-755ddbc0ee39",
                            "type": "parent",
                            "x": 558.2499943311575,
                            "y": 172.34374291418987,
                            "name": "parent",
                            "alignment": "left",
                            "parentNode": "89dda0e0-a452-40f7-9cab-d8fdbf2b4cbd",
                            "links": [
                                "3560c997-d411-4951-ac25-80e5cdf6fcb9"
                            ],
                            "in": true,
                            "label": "parent"
                        }
                    ],
                    "name": "AvoidObstacle",
                    "color": "rgb(179,89,0)",
                    "is_selected": false,
                    "is_subtree": true
                }
            }
        }
    ]
}"""

composition_tree_structure = {
    "name": "ReactiveSequence",
    "id": "ae350d90-0f61-4345-aa50-f6d36bc58b44",
    "childs": [
        {
            "name": "AvoidObstacle",
            "id": "89dda0e0-a452-40f7-9cab-d8fdbf2b4cbd",
            "childs": [],
        },
        {"name": "Forward", "id": "7f7095b5-22b1-43d0-9987-d899675c810e", "childs": []},
    ],
}

composition_subtree_avoid_content = """{
  "id": "fa2362dc-cffa-4764-9b70-90d475be0c02",
  "offsetX": -160.75059116868545,
  "offsetY": -134.77566727635997,
  "zoom": 135.83290727377067,
  "gridSize": 0,
  "layers": [
    {
      "id": "1d9af8b5-858e-4253-9057-fbf3c9f2442d",
      "type": "diagram-links",
      "isSvg": true,
      "transformed": true,
      "models": {
        "eb88f36e-a257-43c7-a1fd-1348357a5fd9": {
          "id": "eb88f36e-a257-43c7-a1fd-1348357a5fd9",
          "type": "default",
          "selected": false,
          "source": "94891f48-9deb-4724-a39d-3551b000dcf6",
          "sourcePort": "d988236c-73d4-423a-8acc-05911daede71",
          "target": "0239a95a-3e34-4646-87b7-068399dfbcaf",
          "targetPort": "7464cfcd-687e-4029-9689-c5de78f8941d",
          "points": [
            {
              "id": "b6b61e69-bd73-4ad2-bd99-1f2bbcdd0855",
              "type": "point",
              "x": 296.6406276758578,
              "y": 220.99999743995457
            },
            {
              "id": "fe9be6be-0f2d-43fd-a6e5-4f50fc11cb7b",
              "type": "point",
              "x": 355.4530754973805,
              "y": 211.9843726193415
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        },
        "08532d6f-1ff2-4dda-bb9b-c7d9b65fce83": {
          "id": "08532d6f-1ff2-4dda-bb9b-c7d9b65fce83",
          "type": "default",
          "selected": false,
          "source": "0239a95a-3e34-4646-87b7-068399dfbcaf",
          "sourcePort": "8dec155c-00f7-4aa9-9df8-0b236b55e6a9",
          "target": "470234b7-2d6e-4ffd-8b66-a3c90cd47a79",
          "targetPort": "e734da51-37ac-4ca0-97c4-ff6bed4f0a74",
          "points": [
            {
              "id": "8e28b3b3-7d47-4681-88ea-185d2737c097",
              "type": "point",
              "x": 504.85933880051334,
              "y": 211.9843726193415
            },
            {
              "id": "850a5c92-8acf-4df2-b9bd-240e002305ce",
              "type": "point",
              "x": 549.5781032521462,
              "y": 288.89061820772883
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        },
        "463ccbab-540b-41ba-880f-215f906fa7d1": {
          "id": "463ccbab-540b-41ba-880f-215f906fa7d1",
          "type": "default",
          "selected": false,
          "source": "0239a95a-3e34-4646-87b7-068399dfbcaf",
          "sourcePort": "8dec155c-00f7-4aa9-9df8-0b236b55e6a9",
          "target": "d02a2c76-47c5-4617-9109-a94a75ea02e1",
          "targetPort": "eac9bc0c-4c97-45a3-a1da-ebc7efee40d3",
          "points": [
            {
              "id": "a77168bb-e8d5-4b1f-94b2-4e45dc67f3bb",
              "type": "point",
              "x": 504.85933880051334,
              "y": 211.9843726193415
            },
            {
              "id": "7be384e6-8bb3-4362-bd5e-c5e07f4317d8",
              "type": "point",
              "x": 550.4843770639296,
              "y": 157.03124974460908
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        },
        "79483a7f-3f1d-497e-ad39-df77cd941c13": {
          "id": "79483a7f-3f1d-497e-ad39-df77cd941c13",
          "type": "default",
          "selected": false,
          "source": "d43b79b9-3d6f-4dfd-87fc-3ae50e91670d",
          "sourcePort": "f6a1e5fb-9300-421b-9636-1e49ee9ec253",
          "target": "d02a2c76-47c5-4617-9109-a94a75ea02e1",
          "targetPort": "4a66fc35-00b3-4136-bfe8-133ce8f28b53",
          "points": [
            {
              "id": "142e4342-3f9c-4c1a-a415-9585fe84b964",
              "type": "point",
              "x": 697.1249527714816,
              "y": 147.5000016767135
            },
            {
              "id": "4b93f5ea-26d1-4f1f-8255-81010dbaeea9",
              "type": "point",
              "x": 632.2655570622627,
              "y": 157.03124974460908
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        }
      }
    },
    {
      "id": "fed3b351-5f1a-4cad-9f61-031f8a6af57e",
      "type": "diagram-nodes",
      "isSvg": false,
      "transformed": true,
      "models": {
        "94891f48-9deb-4724-a39d-3551b000dcf6": {
          "id": "94891f48-9deb-4724-a39d-3551b000dcf6",
          "type": "basic",
          "selected": false,
          "x": 200,
          "y": 200,
          "ports": [
            {
              "id": "d988236c-73d4-423a-8acc-05911daede71",
              "type": "children",
              "x": 291.6405970146351,
              "y": 216.00000047923058,
              "name": "children",
              "alignment": "right",
              "parentNode": "94891f48-9deb-4724-a39d-3551b000dcf6",
              "links": ["eb88f36e-a257-43c7-a1fd-1348357a5fd9"],
              "in": false,
              "label": "children"
            }
          ],
          "name": "Tree Root",
          "color": "rgb(0,204,0)",
          "is_selected": false
        },
        "0239a95a-3e34-4646-87b7-068399dfbcaf": {
          "id": "0239a95a-3e34-4646-87b7-068399dfbcaf",
          "type": "basic",
          "selected": false,
          "x": 353.4656799986767,
          "y": 190.99678526531693,
          "ports": [
            {
              "id": "7464cfcd-687e-4029-9689-c5de78f8941d",
              "type": "parent",
              "x": 350.4530897701561,
              "y": 206.98437565861752,
              "name": "parent",
              "alignment": "left",
              "parentNode": "0239a95a-3e34-4646-87b7-068399dfbcaf",
              "links": ["eb88f36e-a257-43c7-a1fd-1348357a5fd9"],
              "in": true,
              "label": "parent"
            },
            {
              "id": "8dec155c-00f7-4aa9-9df8-0b236b55e6a9",
              "type": "children",
              "x": 499.8593530732889,
              "y": 206.98437565861752,
              "name": "children",
              "alignment": "right",
              "parentNode": "0239a95a-3e34-4646-87b7-068399dfbcaf",
              "links": [
                "08532d6f-1ff2-4dda-bb9b-c7d9b65fce83",
                "463ccbab-540b-41ba-880f-215f906fa7d1"
              ],
              "in": false,
              "label": "children"
            }
          ],
          "name": "ReactiveFallback",
          "color": "rgb(255,0,0)",
          "is_selected": false,
          "is_subtree": false
        },
        "470234b7-2d6e-4ffd-8b66-a3c90cd47a79": {
          "id": "470234b7-2d6e-4ffd-8b66-a3c90cd47a79",
          "type": "basic",
          "selected": false,
          "x": 547.5808736932645,
          "y": 267.8974824665873,
          "ports": [
            {
              "id": "e734da51-37ac-4ca0-97c4-ff6bed4f0a74",
              "type": "parent",
              "x": 544.5781175249218,
              "y": 283.89062124700484,
              "name": "parent",
              "alignment": "left",
              "parentNode": "470234b7-2d6e-4ffd-8b66-a3c90cd47a79",
              "links": ["08532d6f-1ff2-4dda-bb9b-c7d9b65fce83"],
              "in": true,
              "label": "parent"
            }
          ],
          "name": "Turn",
          "color": "rgb(128,0,128)",
          "is_selected": false,
          "is_subtree": false
        },
        "d02a2c76-47c5-4617-9109-a94a75ea02e1": {
          "id": "d02a2c76-47c5-4617-9109-a94a75ea02e1",
          "type": "basic",
          "selected": false,
          "x": 548.4975967274108,
          "y": 136.03159277445585,
          "ports": [
            {
              "id": "eac9bc0c-4c97-45a3-a1da-ebc7efee40d3",
              "type": "parent",
              "x": 545.4843464027069,
              "y": 152.0312527838851,
              "name": "parent",
              "alignment": "left",
              "parentNode": "d02a2c76-47c5-4617-9109-a94a75ea02e1",
              "links": ["463ccbab-540b-41ba-880f-215f906fa7d1"],
              "in": true,
              "label": "parent"
            },
            {
              "id": "4a66fc35-00b3-4136-bfe8-133ce8f28b53",
              "type": "children",
              "x": 627.2655713350383,
              "y": 152.0312527838851,
              "name": "children",
              "alignment": "right",
              "parentNode": "d02a2c76-47c5-4617-9109-a94a75ea02e1",
              "links": ["79483a7f-3f1d-497e-ad39-df77cd941c13"],
              "in": false,
              "label": "children"
            }
          ],
          "name": "Inverter",
          "color": "rgb(255,153,51)",
          "is_selected": false,
          "is_subtree": false
        },
        "d43b79b9-3d6f-4dfd-87fc-3ae50e91670d": {
          "id": "d43b79b9-3d6f-4dfd-87fc-3ae50e91670d",
          "type": "basic",
          "selected": false,
          "x": 695.1328745519899,
          "y": 126.50932748311547,
          "ports": [
            {
              "id": "f6a1e5fb-9300-421b-9636-1e49ee9ec253",
              "type": "parent",
              "x": 692.1249221102589,
              "y": 142.49999909923974,
              "name": "parent",
              "alignment": "left",
              "parentNode": "d43b79b9-3d6f-4dfd-87fc-3ae50e91670d",
              "links": ["79483a7f-3f1d-497e-ad39-df77cd941c13"],
              "in": true,
              "label": "parent"
            }
          ],
          "name": "ObstacleDetection",
          "color": "rgb(179,89,0)",
          "is_selected": false,
          "is_subtree": true
        }
      }
    }
  ]
}
"""

composition_subtree_avoid_structure = {
    "name": "ReactiveFallback",
    "id": "0239a95a-3e34-4646-87b7-068399dfbcaf",
    "childs": [
        {
            "name": "Inverter",
            "id": "d02a2c76-47c5-4617-9109-a94a75ea02e1",
            "childs": [
                {
                    "name": "ObstacleDetection",
                    "id": "d43b79b9-3d6f-4dfd-87fc-3ae50e91670d",
                    "childs": [],
                }
            ],
        },
        {"name": "Turn", "id": "470234b7-2d6e-4ffd-8b66-a3c90cd47a79", "childs": []},
    ],
}

composition_subtree_obstacle_content = """{
  "id": "fa2362dc-cffa-4764-9b70-90d475be0c02",
  "offsetX": -112.03742592618858,
  "offsetY": -81.85840512126316,
  "zoom": 136.0682448315521,
  "gridSize": 0,
  "layers": [
    {
      "id": "1d9af8b5-858e-4253-9057-fbf3c9f2442d",
      "type": "diagram-links",
      "isSvg": true,
      "transformed": true,
      "models": {
        "4ea193f3-e2a3-4950-ac0e-913c924abdf6": {
          "id": "4ea193f3-e2a3-4950-ac0e-913c924abdf6",
          "type": "default",
          "selected": false,
          "source": "94891f48-9deb-4724-a39d-3551b000dcf6",
          "sourcePort": "d988236c-73d4-423a-8acc-05911daede71",
          "target": "7fbad7c8-0553-4cd7-8996-fd88e4c295b2",
          "targetPort": "39a81e3f-a122-4527-9fce-90ea315d46ef",
          "points": [
            {
              "id": "3c9add18-2b52-4665-90c1-9b38f18ae7ad",
              "type": "point",
              "x": 305.5937496138324,
              "y": 167.95312932635392
            },
            {
              "id": "6d0495a3-1b86-4997-9290-103e39ea70c5",
              "type": "point",
              "x": 392.81252952475097,
              "y": 146.42187824654525
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        },
        "ea893d26-7706-4f55-a723-fcbdd21ffa0b": {
          "id": "ea893d26-7706-4f55-a723-fcbdd21ffa0b",
          "type": "default",
          "selected": false,
          "source": "7fbad7c8-0553-4cd7-8996-fd88e4c295b2",
          "sourcePort": "cee881c8-58b1-4bb4-aa5f-516fd1952cc0",
          "target": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
          "targetPort": "3063ffb8-d61c-476c-8ec0-834325285870",
          "points": [
            {
              "id": "cb0060c1-b8e4-4b5b-a6ad-73603222bf7b",
              "type": "point",
              "x": 486.2812698406922,
              "y": 146.42187824654525
            },
            {
              "id": "27d1b6dc-9324-4a68-9625-33c6a4439cfb",
              "type": "point",
              "x": 640.5000397655033,
              "y": 113.48438102173947
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        },
        "6818d1c3-5b51-487c-b2e9-3a0d94694d25": {
          "id": "6818d1c3-5b51-487c-b2e9-3a0d94694d25",
          "type": "default",
          "selected": false,
          "source": "ce150c68-2dc1-4228-9785-61292509ef84",
          "sourcePort": "a9404ba5-6927-43ce-aaeb-efeb2e72ff33",
          "target": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
          "targetPort": "3b15617d-ed8e-4bcf-8106-a4d89199f7dd",
          "points": [
            {
              "id": "5678ab21-de46-4fe6-9d0f-717e6925eae6",
              "type": "point",
              "x": 528.6718921733725,
              "y": 201.7187632380718
            },
            {
              "id": "e2dcdc31-1698-45da-ae24-81bd27b67c38",
              "type": "point",
              "x": 641.5000208705478,
              "y": 136.48437257244706
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        },
        "ec7c359a-1415-4463-8643-982460a14890": {
          "id": "ec7c359a-1415-4463-8643-982460a14890",
          "type": "default",
          "selected": false,
          "source": "bed3db79-1ed5-47bd-a17b-64367416751f",
          "sourcePort": "6353ad76-15bf-4994-b587-2bb419a7d8e2",
          "target": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
          "targetPort": "b315b244-9b78-44ba-a917-b74bcbc1a6ca",
          "points": [
            {
              "id": "0a0bcc10-34e0-4dcd-92dd-a8ac7bc1106d",
              "type": "point",
              "x": 533.7031522400398,
              "y": 254.2968865211114
            },
            {
              "id": "43cde0d2-baa0-484c-b5c8-fa974d93ad04",
              "type": "point",
              "x": 641.5000208705478,
              "y": 159.4843753372253
            }
          ],
          "labels": [],
          "width": 3,
          "color": "gray",
          "curvyness": 50,
          "selectedColor": "rgb(0,192,255)"
        }
      }
    },
    {
      "id": "fed3b351-5f1a-4cad-9f61-031f8a6af57e",
      "type": "diagram-nodes",
      "isSvg": false,
      "transformed": true,
      "models": {
        "94891f48-9deb-4724-a39d-3551b000dcf6": {
          "id": "94891f48-9deb-4724-a39d-3551b000dcf6",
          "type": "basic",
          "selected": false,
          "x": 208.96367945847655,
          "y": 146.9648965373471,
          "ports": [
            {
              "id": "d988236c-73d4-423a-8acc-05911daede71",
              "type": "children",
              "x": 300.59375437604484,
              "y": 162.95312287449573,
              "name": "children",
              "alignment": "right",
              "parentNode": "94891f48-9deb-4724-a39d-3551b000dcf6",
              "links": ["4ea193f3-e2a3-4950-ac0e-913c924abdf6"],
              "in": false,
              "label": "children"
            }
          ],
          "name": "Tree Root",
          "color": "rgb(0,204,0)",
          "is_selected": false
        },
        "7fbad7c8-0553-4cd7-8996-fd88e4c295b2": {
          "id": "7fbad7c8-0553-4cd7-8996-fd88e4c295b2",
          "type": "basic",
          "selected": false,
          "x": 390.82427115413583,
          "y": 125.43470124414453,
          "ports": [
            {
              "id": "39a81e3f-a122-4527-9fce-90ea315d46ef",
              "type": "parent",
              "x": 387.81257914324584,
              "y": 141.42188300875765,
              "name": "parent",
              "alignment": "left",
              "parentNode": "7fbad7c8-0553-4cd7-8996-fd88e4c295b2",
              "links": ["4ea193f3-e2a3-4950-ac0e-913c924abdf6"],
              "in": true,
              "label": "parent"
            },
            {
              "id": "cee881c8-58b1-4bb4-aa5f-516fd1952cc0",
              "type": "children",
              "x": 481.2812297466221,
              "y": 141.42188300875765,
              "name": "children",
              "alignment": "right",
              "parentNode": "7fbad7c8-0553-4cd7-8996-fd88e4c295b2",
              "links": ["ea893d26-7706-4f55-a723-fcbdd21ffa0b"],
              "in": false,
              "label": "children"
            }
          ],
          "name": "Sequence",
          "color": "rgb(0,128,255)",
          "is_selected": false,
          "is_subtree": false
        },
        "cd38d649-173f-494b-97e1-2e50ca2eb46f": {
          "id": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
          "type": "basic",
          "selected": false,
          "x": 638.5009250542528,
          "y": 92.4965301618108,
          "ports": [
            {
              "id": "3063ffb8-d61c-476c-8ec0-834325285870",
              "type": "parent",
              "x": 635.4999996714332,
              "y": 108.48438578395188,
              "name": "parent",
              "alignment": "left",
              "parentNode": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
              "links": ["ea893d26-7706-4f55-a723-fcbdd21ffa0b"],
              "in": true,
              "label": "parent"
            },
            {
              "id": "3b15617d-ed8e-4bcf-8106-a4d89199f7dd",
              "type": "input",
              "x": 636.5000256327602,
              "y": 131.48437733465948,
              "name": "amplitude",
              "alignment": "left",
              "parentNode": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
              "links": ["6818d1c3-5b51-487c-b2e9-3a0d94694d25"],
              "in": true,
              "label": "input"
            },
            {
              "id": "b315b244-9b78-44ba-a917-b74bcbc1a6ca",
              "type": "input",
              "x": 636.5000256327602,
              "y": 154.4843688853671,
              "name": "obs_dist",
              "alignment": "left",
              "parentNode": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
              "links": ["ec7c359a-1415-4463-8643-982460a14890"],
              "in": true,
              "label": "input"
            }
          ],
          "name": "CheckObstacle",
          "color": "rgb(128,0,128)",
          "is_selected": false,
          "is_subtree": false
        },
        "ce150c68-2dc1-4228-9785-61292509ef84": {
          "id": "ce150c68-2dc1-4228-9785-61292509ef84",
          "type": "tag",
          "selected": false,
          "x": 494.6114369501465,
          "y": 185.72825024437927,
          "ports": [
            {
              "id": "a9404ba5-6927-43ce-aaeb-efeb2e72ff33",
              "type": "tag output",
              "x": 523.6718520793024,
              "y": 196.71875678621362,
              "name": "tag output",
              "alignment": "right",
              "parentNode": "ce150c68-2dc1-4228-9785-61292509ef84",
              "links": ["6818d1c3-5b51-487c-b2e9-3a0d94694d25"],
              "in": false,
              "label": "tag output"
            }
          ],
          "name": "20",
          "color": "var(--bt-tag-normal-background)",
          "is_selected": false,
          "is_blackboard": false
        },
        "bed3db79-1ed5-47bd-a17b-64367416751f": {
          "id": "bed3db79-1ed5-47bd-a17b-64367416751f",
          "type": "tag",
          "selected": false,
          "x": 495.7274356467904,
          "y": 238.29830563701535,
          "ports": [
            {
              "id": "6353ad76-15bf-4994-b587-2bb419a7d8e2",
              "type": "tag output",
              "x": 528.7031121459697,
              "y": 249.2968912833238,
              "name": "tag output",
              "alignment": "right",
              "parentNode": "bed3db79-1ed5-47bd-a17b-64367416751f",
              "links": ["ec7c359a-1415-4463-8643-982460a14890"],
              "in": false,
              "label": "tag output"
            }
          ],
          "name": "1.0",
          "color": "var(--bt-tag-normal-background)",
          "is_selected": false,
          "is_blackboard": false
        }
      }
    }
  ]
}
"""

composition_subtree_obstacle_structure = {
    "name": "Sequence",
    "id": "7fbad7c8-0553-4cd7-8996-fd88e4c295b2",
    "childs": [
        {
            "name": "CheckObstacle",
            "id": "cd38d649-173f-494b-97e1-2e50ca2eb46f",
            "childs": [],
        }
    ],
}

composition_action_obstacle_code = """import py_trees
import sensor_msgs
import tree_tools


def check_obstacle_in_laser(laser_measures, amplitude):

    relevant_measures = laser_measures[:amplitude] + laser_measures[-amplitude:]

    for measure in relevant_measures:

        if measure < 1:
            return True

    return False


class CheckObstacle(py_trees.behaviour.Behaviour):
    def __init__(self, name, ports=None):

        # Configure the name of the behaviour
        super().__init__(name)
        self.logger.debug("%s.__init__()" % (self.__class__.__name__))

        # Get the ports
        self.ports = ports

    def setup(self, **kwargs: int) -> None:

        # Get the node passed from the tree (needed for interaction with ROS)
        try:
            self.node = kwargs["node"]
        except KeyError as e:
            error_message = "Couldn't find the tree node"
            raise KeyError(error_message) from e

        # Setup the subscription to the laser
        self.subscription = self.node.create_subscription(
            sensor_msgs.msg.LaserScan, "/scan", self.listener_callback, 10
        )

        self.last_scan_ = sensor_msgs.msg.LaserScan()

    def listener_callback(self, msg) -> None:
        self.last_scan_ = msg

    def initialise(self) -> None:

        # Debugging
        self.logger.debug("%s.initialise()" % (self.__class__.__name__))

    def update(self) -> py_trees.common.Status:

        # Check the laser measures
        if len(self.last_scan_.ranges) == 0:
            new_status = py_trees.common.Status.INVALID

        # Get params from ports
        amplitude = int(tree_tools.get_port_content(self.ports["amplitude"]))
        obs_dist = float(tree_tools.get_port_content(self.ports["obs_dist"]))

        # Check if there is an obstacle
        obstacle = check_obstacle_in_laser(self.last_scan_.ranges, amplitude)
        if obstacle:
            new_status = py_trees.common.Status.SUCCESS
        else:
            new_status = py_trees.common.Status.FAILURE

        return new_status

    def terminate(self, new_status: py_trees.common.Status) -> None:

        # Debugging
        self.logger.debug(
            "%s.terminate()[%s->%s]"
            % (self.__class__.__name__, self.status, new_status)
        )
"""

composition_action_forward_code = """import py_trees
import geometry_msgs
import tree_tools


class Forward(py_trees.behaviour.Behaviour):
    def __init__(self, name, ports=None):

        # Configure the name of the behaviour
        super().__init__(name)
        self.logger.debug("%s.__init__()" % (self.__class__.__name__))

        # Get the ports
        self.ports = ports

    def setup(self, **kwargs) -> None:

        # Get the node passed from the tree (needed for interaction with ROS)
        try:
            self.node = kwargs["node"]
        except KeyError as e:
            error_message = "Couldn't find the tree node"
            raise KeyError(error_message) from e

        # Setup the publisher for the robot speed
        self.publisher = self.node.create_publisher(
            msg_type=geometry_msgs.msg.Twist, topic="/cmd_vel", qos_profile=10
        )

    def initialise(self) -> None:

        # Debugging
        self.logger.debug("%s.initialise()" % (self.__class__.__name__))

    def update(self) -> py_trees.common.Status:

        # Publish the speed msg
        msg = geometry_msgs.msg.Twist()
        msg.linear.x = float(tree_tools.get_port_content(self.ports["speed"]))
        self.publisher.publish(msg)
        print("Forward")

        return py_trees.common.Status.RUNNING

    def terminate(self, new_status: py_trees.common.Status) -> None:

        # Stop the robot
        msg = geometry_msgs.msg.Twist()
        msg.linear.x = 0.0
        self.publisher.publish(msg)

        # Debugging
        self.logger.debug(
            "%s.terminate()[%s->%s]"
            % (self.__class__.__name__, self.status, new_status)
        )
"""

composition_action_turn_code = """import py_trees
import geometry_msgs


class Turn(py_trees.behaviour.Behaviour):
    def __init__(self, name, ports=None):

        # Configure the name of the behavioure
        super().__init__(name)
        self.logger.debug("%s.__init__()" % (self.__class__.__name__))

        # Get the ports
        self.ports = ports

    def setup(self, **kwargs: int) -> None:

        # Get the node passed from the tree (needed for interaction with ROS)
        try:
            self.node = kwargs["node"]
        except KeyError as e:
            error_message = "Couldn't find the tree node"
            raise KeyError(error_message) from e

        # Setup the publisher for the robot speed
        self.publisher = self.node.create_publisher(
            msg_type=geometry_msgs.msg.Twist, topic="/cmd_vel", qos_profile=10
        )

    def initialise(self) -> None:

        # Debugging
        self.logger.debug("%s.initialise()" % (self.__class__.__name__))

    def update(self) -> py_trees.common.Status:

        # Publish the speed msg
        msg = geometry_msgs.msg.Twist()
        msg.angular.z = 0.4
        self.publisher.publish(msg)
        print("Turning")

        return py_trees.common.Status.RUNNING

    def terminate(self, new_status: py_trees.common.Status) -> None:

        # Stop the robot
        msg = geometry_msgs.msg.Twist()
        msg.linear.x = 0.0
        self.publisher.publish(msg)

        # Debugging
        self.logger.debug(
            "%s.terminate()[%s->%s]"
            % (self.__class__.__name__, self.status, new_status)
        )
"""

composition_deps_list = ["py_trees", "tree_tools", "geometry_msgs", "sensor_msgs"]

composition_xml = """<?xml version="1.0" ?>
<Root name="Tree Root">
  
  
  <BehaviorTree>
    
    
    <ReactiveSequence name="ReactiveSequence">
      
      
      <ReactiveFallback name="ReactiveFallback">
        
      
        <Inverter name="Inverter">
          
        
          <ObstacleDetection name="ObstacleDetection"/>
          
      
        </Inverter>
        
      
        <Turn name="Turn"/>
        
    
      </ReactiveFallback>
      
  
      <Forward name="Forward" speed="0.4"/>
      
    
    </ReactiveSequence>
    
  
  </BehaviorTree>
  

  <Code>
    <Forward>
      import py_trees
      import geometry_msgs
      import tree_tools
      
      
      class Forward(py_trees.behaviour.Behaviour):
          def __init__(self, name, ports=None):
      
              # Configure the name of the behaviour
              super().__init__(name)
              self.logger.debug(&quot;%s.__init__()&quot; % (self.__class__.__name__))
      
              # Get the ports
              self.ports = ports
      
          def setup(self, **kwargs) -&gt; None:
      
              # Get the node passed from the tree (needed for interaction with ROS)
              try:
                  self.node = kwargs[&quot;node&quot;]
              except KeyError as e:
                  error_message = &quot;Couldn't find the tree node&quot;
                  raise KeyError(error_message) from e
      
              # Setup the publisher for the robot speed
              self.publisher = self.node.create_publisher(
                  msg_type=geometry_msgs.msg.Twist, topic=&quot;/cmd_vel&quot;, qos_profile=10
              )
      
          def initialise(self) -&gt; None:
      
              # Debugging
              self.logger.debug(&quot;%s.initialise()&quot; % (self.__class__.__name__))
      
          def update(self) -&gt; py_trees.common.Status:
      
              # Publish the speed msg
              msg = geometry_msgs.msg.Twist()
              msg.linear.x = float(tree_tools.get_port_content(self.ports[&quot;speed&quot;]))
              self.publisher.publish(msg)
              print(&quot;Forward&quot;)
      
              return py_trees.common.Status.RUNNING
      
          def terminate(self, new_status: py_trees.common.Status) -&gt; None:
      
              # Stop the robot
              msg = geometry_msgs.msg.Twist()
              msg.linear.x = 0.0
              self.publisher.publish(msg)
      
              # Debugging
              self.logger.debug(
                  &quot;%s.terminate()[%s-&gt;%s]&quot;
                  % (self.__class__.__name__, self.status, new_status)
              )
      
</Forward>
    <Turn>
      import py_trees
      import geometry_msgs
      
      
      class Turn(py_trees.behaviour.Behaviour):
          def __init__(self, name, ports=None):
      
              # Configure the name of the behavioure
              super().__init__(name)
              self.logger.debug(&quot;%s.__init__()&quot; % (self.__class__.__name__))
      
              # Get the ports
              self.ports = ports
      
          def setup(self, **kwargs: int) -&gt; None:
      
              # Get the node passed from the tree (needed for interaction with ROS)
              try:
                  self.node = kwargs[&quot;node&quot;]
              except KeyError as e:
                  error_message = &quot;Couldn't find the tree node&quot;
                  raise KeyError(error_message) from e
      
              # Setup the publisher for the robot speed
              self.publisher = self.node.create_publisher(
                  msg_type=geometry_msgs.msg.Twist, topic=&quot;/cmd_vel&quot;, qos_profile=10
              )
      
          def initialise(self) -&gt; None:
      
              # Debugging
              self.logger.debug(&quot;%s.initialise()&quot; % (self.__class__.__name__))
      
          def update(self) -&gt; py_trees.common.Status:
      
              # Publish the speed msg
              msg = geometry_msgs.msg.Twist()
              msg.angular.z = 0.4
              self.publisher.publish(msg)
              print(&quot;Turning&quot;)
      
              return py_trees.common.Status.RUNNING
      
          def terminate(self, new_status: py_trees.common.Status) -&gt; None:
      
              # Stop the robot
              msg = geometry_msgs.msg.Twist()
              msg.linear.x = 0.0
              self.publisher.publish(msg)
      
              # Debugging
              self.logger.debug(
                  &quot;%s.terminate()[%s-&gt;%s]&quot;
                  % (self.__class__.__name__, self.status, new_status)
              )
      
</Turn>
  </Code>
</Root>
"""
